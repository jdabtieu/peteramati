!function(){"use strict";let t=function(){return!1};try{window.localStorage&&window.JSON&&(t=function(t,e,n){try{var a=t?window.sessionStorage:window.localStorage;return void 0===e?!!a:void 0===n?a.getItem(e):null===n?a.removeItem(e):"object"==typeof n?a.setItem(e,JSON.stringify(n)):a.setItem(e,n)}catch(t){return!1}})}catch(t){}function e(t){var e,n,a,s,i,r,o=t.split(/(%(?:%|-?(?:\d*|\*?)(?:\.\d*)?[sdefgroxX]))/),l="";for(e=0,s=1;e!=o.length;++e)if("%"!=(n=o[e]).charAt(0))l+=n;else if("%"==n.charAt(1))l+="%";else{if(a=arguments[s],++s,"*"==(i=n.match(/^%(-?)(\d*|\*?)(?:|[.](\d*))(\w)/))[2]&&(i[2]=a.toString(),a=arguments[s],++s),i[4]>="e"&&i[4]<="g"&&null==i[3]&&(i[3]=6),"g"===i[4]?a=(a=Number(a).toPrecision(i[3]).toString()).replace(/\.(\d*[1-9])?0+(|e.*)$/,(function(t,e,n){return(null==e?"":"."+e)+n})):"f"===i[4]?a=Number(a).toFixed(i[3]):"e"===i[4]?a=Number(a).toExponential(i[3]):"r"===i[4]?(a=Number(a).toFixed(+(i[3]||0)),+(i[3]||0)&&(a=a.replace(/\.?0*$/,""))):"d"===i[4]?a=Math.floor(a):"o"===i[4]?a=Math.floor(a).toString(8):"x"===i[4]?a=Math.floor(a).toString(16):"X"===i[4]&&(a=Math.floor(a).toString(16).toUpperCase()),a=a.toString(),""!==i[2]&&"0"!==i[2])for(r="0"===i[2].charAt(0)?"0":" ";a.length<parseInt(i[2],10);)a=i[1]?a+r:r+a;l+=a}return l}function n(t,e,n){return(e+=t.toString()).length<=n?e:e.substring(e.length-n)}function a(t,e,n){return n&&e&&!t.getSeconds()?i("%H:%M",t):n?i("%H:%M:%S",t):e&&t.getSeconds()?i("%#l:%M:%S%P",t):e&&t.getMinutes()?i("%#l:%M%P",t):i(e?"%#l%P":"%I:%M:%S %p",t)}t.json=function(e,n){var a=t(e,n);return!!a&&JSON.parse(a)},t.site=function(e,n,a){return"/"!==siteinfo.base&&(n=siteinfo.base+n),t(e,n,a)},t.site_json=function(e,n){return"/"!==siteinfo.base&&(n=siteinfo.base+n),t.json(e,n)};const s={a:function(t){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()]},A:function(t){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()]},d:function(t){return n(t.getDate(),"0",2)},e:function(t,e){return n(t.getDate(),e?"":" ",2)},u:function(t){return t.getDay()||7},w:function(t){return t.getDay()},b:function(t){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]},B:function(t){return["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]},h:function(t){return s.b(t)},m:function(t){return n(t.getMonth()+1,"0",2)},y:function(t){return t.getFullYear()%100},Y:function(t){return t.getFullYear()},H:function(t){return n(t.getHours(),"0",2)},k:function(t,e){return n(t.getHours(),e?"":" ",2)},I:function(t){return n(t.getHours()%12||12,"0",2)},l:function(t,e){return n(t.getHours()%12||12,e?"":" ",2)},M:function(t){return n(t.getMinutes(),"0",2)},X:function(t){return i("%#e %b %Y %#q",t)},p:function(t){return t.getHours()<12?"AM":"PM"},P:function(t){return t.getHours()<12?"am":"pm"},q:function(t,e){return a(t,e,i.is24)},r:function(t,e){return a(t,e,!1)},R:function(t,e){return a(t,e,!0)},S:function(t){return n(t.getSeconds(),"0",2)},T:function(t){return i("%H:%M:%S",t)},D:function(t){return i("%m/%d/%y",t)},F:function(t){return i("%Y-%m-%d",t)},s:function(t){return Math.floor(t.getTime()/1e3)},n:function(){return"\n"},t:function(){return"\t"},"%":function(){return"%"}};function i(t,e){var n,a,i,r,o=t.split(/(%#?\S)/),l="";for(null==e?e=new Date:"number"==typeof e&&(e=new Date(1e3*e)),n=0;n!=o.length;++n)i="#"==(a=o[n]).charAt(1),"%"==a.charAt(0)&&(r=s[a.charAt(1+i)])?l+=r(e,i):l+=a;return l}function r(t,e){if((t=Math.round(t))>-60&&t<60)return t+"s";let n=t<0?"-":"";if((t=Math.abs(t))>=3600)if(t%900==0&&"quarterhour"===e)n=n.concat(t/3600,"h"),t=0;else{const e=Math.floor(t/3600);n=n.concat(e,"h"),(t-=3600*e)<60&&(n+="0m")}if(t>=60){const e=Math.floor(t/60);n=n.concat(e,"m"),t-=60*e}return 0!==t&&(n=n.concat(t,"s")),n}window.JSON&&window.JSON.parse||(window.JSON={parse:$.parseJSON}),Element.prototype.closest||(Element.prototype.closest=function(t){return $(this).closest(t)[0]}),Element.prototype.replaceChildren||(Element.prototype.replaceChildren=function(){for(;this.lastChild;)this.removeChild(this.lastChild);for(let t=0;t!==arguments.length;++t)this.append(arguments[t])}),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=!e||e<0?0:+e,this.substring(e,e+t.length)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){return(void 0===e||e>this.length)&&(e=this.length),this.substring(e-t.length,e)===t}),String.prototype.trimStart||(String.prototype.trimStart=function(){return this.replace(/^[\s\uFEFF\xA0]+/,"")}),Object.hasOwn||Object.defineProperty(Object,"hasOwn",{value:Object.prototype.hasOwnProperty,configurable:!0,writable:!0});class o{constructor(t){this.value=t}then(t){try{const e=t(this.value);return e instanceof Promise||e instanceof o?e:new o(e)}catch(t){return Promise.reject(t)}}catch(){return this}finally(t){try{t()}catch(t){}return this}}function l(t,e){return t===e||(t=(null==t?"":t).replace(/\r\n?/g,"\n"))===(e=(null==e?"":e).replace(/\r\n?/g,"\n"))}function c(t,e){let n,a,s=0;for(;t&&e>0&&(n=t.match(/^([\x00-\x7F]*)([\u0080-\u07FF]*)([\u0800-\uD7FF\uE000-\uFFFF]*)((?:[\uD800-\uDBFF][\uDC00-\uDFFF])*)/),n);)n[1].length&&(a=Math.min(e,n[1].length),s+=a,e-=a),n[2].length&&(a=Math.min(e,2*n[2].length),s+=a/2,e-=a),n[3].length&&(a=Math.min(e,3*n[3].length),s+=a/3,e-=a),n[4].length&&(a=Math.min(e,2*n[4].length),s+=a/2,e-=a),t=t.substring(n[0].length);return s}let u,d,h,p,f;"classList"in document.createElement("span")&&!/MSIE|rv:11\.0/.test(navigator.userAgent||"")?(u=function(t,e){let n=t.classList;return n&&n.contains(e)},d=function(t,e){t.classList.add(e)},h=function(t,e){t.classList.remove(e)},p=function(t,e,n){t.classList.toggle(e,n)},f=function(t){return t.classList}):(u=function(t,e){return $(t).hasClass(e)},d=function(t,e){$(t).addClass(e)},h=function(t,e){$(t).removeClass(e)},p=function(t,e,n){$(t).toggleClass(e,n)},f=function(t){let e=$.trim(t.className);return""===e?[]:e.split(/\s+/)});const m={};function g(t,e,n){for(let a=0;a!==e.length;a+=3)if(!e[a]||e[a]===n){let n=t.length;for(;0!==n&&e[a+1]>t[n-2];)n-=2;t.splice(n,0,e[a+1],e[a+2])}}function b(t,e,n){for(let a=0;a!==t.length&&!n.isImmediatePropagationStopped();a+=2)t[a+1].call(e,n)}function _(t){let e=t.target;(e&&(u(e,"ui")||u(e,"uin"))||"A"===this.tagName&&u(this,"ui"))&&t.preventDefault();let n=f(this),a=null;for(let e=0;e<n.length;++e){let s=m[n[e]];s&&(a=a||[],g(a,s,t.type))}a&&a.length&&b(a,this,t)}_.on=function(t,e,n){let a=t.indexOf("."),s=null;a>=0&&(s=t.substring(0,a),t=t.substring(a+1)),m[t]=m[t]||[],m[t].push(s,n||0,e)},_.trigger=function(t,e){let n=m[t];if(n){"string"==typeof e&&(e=$.Event(e));let t=[];g(t,n,e.type),t.length&&b(t,this,e)}},$(document).on("click",".ui, .uic",_),$(document).on("change",".uich",_),$(document).on("error",".ui-error",_),$(document).on("input",".uii",_),$(document).on("keydown",".uikd",_),$(document).on("load",".ui-load",_),$(document).on("mouseup mousedown",".uim",_),$(document).on("unfold",".ui-unfold",_),$(document).on("focusin",".ui-focusin",_),$(document).on("focusout",".ui-focusout",_);let v=!1;function x(t,e,n){return null!=n&&(n=!n),p(t,"hidden",n),e&&$(e).find("span.foldarrow").html(u(t,"hidden")?"&#x25B6;":"&#x25BC;"),!1}function y(t){return"checkbox"===t.type||"radio"===t.type}function w(t){if(t.hasAttribute("data-default-value"))return t.getAttribute("data-default-value");if(y(t)){let e=t.defaultChecked;return t.hasAttribute("data-default-checked")&&(e="false"!==t.getAttribute("data-default-checked")),e?t.defaultValue:""}return t.defaultValue}function k(t,e){y(t)?(t.checked=t.checked,t.removeAttribute("data-default-checked"),t.removeAttribute("data-default-value"),null==e||""==e?t.defaultChecked=!1:e==t.value?t.defaultChecked=!0:t.setAttribute("data-default-value",e)):(t.value=t.value,"select"!==t.type?(t.removeAttribute("data-default-value"),t.defaultValue=e):t.setAttribute("data-default-value",e))}function C(t){const e=w(t);if(y(t)){return(t.checked?t.value:"")!==e}return"button"!==t.type&&"submit"!==t.type&&"reset"!==t.type&&((n=t.value)!==(a=e)&&(n=(null==n?"":n).replace(/\r\n?/g,"\n"),a=(null==a?"":a).replace(/\r\n?/g,"\n")),!(n===a));var n,a}$(document).on("keydown keyup",(function(t){"Tab"!==t.key||t.metaKey||(v="keydown"===t.type)})),$(document).on("focus","textarea.ta1",(function(){if(v){let t=this;setTimeout((function(){t.setSelectionRange(0,t.value.length)}),0)}}));class A{constructor(){this.clear()}clear(){return this.open=[],this.close=[],this.html="",this}push(t,e){return t&&e?(this.open.push(this.html+t),this.close.push(e),this.html="",this.open.length-1):(this.html+=t,this)}pop(t){let e=this.open.length;for(null==t&&(t=Math.max(0,e-1));e>t;)--e,this.html=this.open[e]+this.html+this.close[e],this.open.pop(),this.close.pop();return this}pop_n(t){return this.pop(Math.max(0,this.open.length-t))}push_pop(t){return this.html+=t,this.pop()}pop_push(t,e){return this.pop(),this.push(t,e)}pop_collapse(t){for(null==t&&(t=this.open.length?this.open.length-1:0);this.open.length>t;)""!==this.html&&(this.html=this.open[this.open.length-1]+this.html+this.close[this.open.length-1]),this.open.pop(),this.close.pop();return this}render(){return this.pop(0),this.html}}const E={Spacebar:" ",Esc:"Escape"},N={9:"Tab",13:"Enter",27:"Escape"},D={9:"Tab",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",20:"CapsLock",27:"Escape",33:"PageUp",34:"PageDown",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",91:"OSLeft",92:"OSRight",93:"OSRight",224:"OSLeft",225:"AltRight"},S={Alt:2,AltLeft:2,AltRight:2,CapsLock:2,Control:2,ControlLeft:2,ControlRight:2,Meta:2,OSLeft:2,OSRight:2,Shift:2,ShiftLeft:2,ShiftRight:2,ArrowLeft:1,ArrowRight:1,ArrowUp:1,ArrowDown:1,Backspace:1,Enter:1,Escape:1,PageUp:1,PageDown:1,Tab:1};function F(t){let e;return"string"==typeof t?t:null!=(e=t.key)?E[e]||e:(e=t.charCode)?N[e]||String.fromCharCode(e):(e=t.keyCode)?D[e]?D[e]:e>=48&&e<=57||e>=65&&e<=90?String.fromCharCode(e):void 0:""}function M(t){return(t.shiftKey?1:0)+(t.ctrlKey?2:0)+(t.altKey?4:0)+(t.metaKey?8:0)}F.printable=function(t){return!(S[F(t)]||"string"!=typeof t&&(t.ctrlKey||t.metaKey))},F.is_modifier=function(t){return S[F(t)]>1},F.is_default_a=function(t,e){return!(t.shiftKey||t.metaKey||t.ctrlKey||0!=t.button||e&&u("ui",e))},M.SHIFT=1,M.CTRL=2,M.ALT=4,M.META=8;let T,j={};function L(t,e){const n=window.getComputedStyle(t);let a="font-size:".concat(n.fontSize,";font-family:",n.fontFamily,";font-weight:",n.fontWeight,";font-style:",n.fontStyle,";line-height:",n.lineHeight,"px;position:absolute;top:-10000px;left:-10000px;resize:none;word-wrap:break-word;white-space:pre-wrap;");if("TEXTAREA"!==t.tagName){const s=parseFloat(n.paddingLeft),i=parseFloat(n.paddingRight),r=parseFloat(n.borderLeftWidth),o=parseFloat(n.borderRightWidth);a=a.concat("width:auto;display:table-cell;padding-left:",s,"px;padding-right:",s+i+r+o,"px;"),"0px"===n.minWidth&&e&&(t.style.minWidth=e+"px"),"none"!==n.maxWidth||t.classList.contains("wide")||(t.style.maxWidth="640px")}let s=j[a];return s||(s=j[a]={signature:a,elt:document.createElement("div"),refcount:0},s.elt.setAttribute("style",a),document.body.appendChild(s.elt)),++s.refcount,s}function z(){for(let t of T)t[1]()}function O(t,e){$(t).removeData("autogrower"),e&&(e instanceof Element?e.remove():0==--e.refcount&&(e.elt.remove(),delete j[e.signature])),T&&T.delete(t)}function B(t){return encodeURIComponent(t).replace(/%20/g,"+")}function I(t,e,n){if(!1!==t.first&&t.v.length){for(var a=0;a<t.v.length;++a){var s=e.exec(t.v[a]);if(s)return t.pt+=n+s[1]+"/",t.v.splice(a,1),void(t.first=s[1])}t.first=!1}}function P(t,e){if(!1!==t.last&&t.v.length){for(var n=0;n<t.v.length;++n){var a=e.exec(t.v[n]);if(a)return t.t+="/"+a[1],t.v.splice(n,1),void(t.last=a[1])}t.last=!1}}function R(t,e,n){const a=t.closest(".pa-psetinfo");let s,i;if((s=a.getAttribute("data-pa-user")||siteinfo.uservalue)&&n.push("u="+encodeURIComponent(s)),(s=a.getAttribute("data-pa-pset"))&&n.push("pset="+encodeURIComponent(s)),(s=a.getAttribute("data-pa-commit"))&&n.push("commit="+encodeURIComponent(s)),("api/grade"===e||"=api/grade"===e)&&(i=a.pa__gradesheet)){const t=[];for(let e in i.entries)t.push(e);n.push("knowngrades="+B(t.join(" ")))}}function q(t,e){let n,a,s,i,r,o="";if(null!=siteinfo.site_relative&&null!=siteinfo.suffix||(siteinfo.site_relative=siteinfo.suffix=""),"string"==typeof e)(s=e.match(/^(.*?)(#.*)$/))&&(e=s[1],o=s[2]),r=e.split(/&/);else for(n in r=[],e)a=e[n],null==a||("anchor"===n?o="#"+a:"psetinfo"===n&&a instanceof Element?R(a,t,r):r.push(encodeURIComponent(n).concat("=",B(a))));return t.startsWith("=")&&(r.push("post="+siteinfo.postvalue),t=t.substring(1)),i={pt:"",v:r,t:t+siteinfo.suffix},"help"===t?P(i,/^t=(\w+)$/):"api"===t.substr(0,3)?(t.length>3&&(i.t="api"+siteinfo.suffix,r.push("fn="+t.substr(4))),I(i,/^u=([^?&#]+)$/,"~"),P(i,/^fn=(\w+)$/)):"index"===t||"run"===t?I(i,/^u=([^?&#]+)$/,"~"):"pset"===t&&(I(i,/^u=([^?&#]+)$/,"~"),P(i,/^pset=([^?&#]+)$/),P(i,/^commit=([0-9A-Fa-f]+)$/)),siteinfo.defaults&&r.push(function(t){if("string"==typeof t)return t;if(t){var e,n,a=[""];for(e in t)null!=(n=t[e])&&a.push(encodeURIComponent(e),"=",B(n),"&");return a[a.length-1]="",a.join("")}return""}(siteinfo.defaults)),r.length&&(i.t+="?"+r.join("&")),siteinfo.site_relative+i.pt+i.t+o}function H(t,e){window.location=q(t,e)}function W(t,e,n){!e&&t instanceof Error?t={error:(e=t).toString()}:"string"==typeof t&&(t={error:t}),e&&e.fileName&&!t.url&&(t.url=e.fileName),e&&e.lineNumber&&!t.lineno&&(t.lineno=e.lineNumber),e&&e.columnNumber&&!t.colno&&(t.colno=e.columnNumber),e&&e.stack&&(t.stack=e.stack),$.ajax(q("=api/jserror"),{global:!1,method:"POST",cache:!1,data:t}),e&&!n&&"object"==typeof console&&console.error&&console.error(t.error)}$.fn.autogrow=function(){return this.each((function(){var t,e,n,a,s=$(this),i=s.data("autogrower");!i&&this.classList.contains("need-autogrow")&&(this.classList.remove("need-autogrow"),"TEXTAREA"===this.tagName?(t=this,i=function(s){if(!1===s)return O(t,e);var i=t.clientWidth;if(!(i<=0)){e||(e=L(t),n=t.clientHeight,e.elt.innerText="!",a=e.elt.clientHeight);var r=t.value;s&&"keydown"==s.type&&13===s.keyCode&&(r+="\n"),e.elt.style.width=i+"px",e.elt.innerText=r+"...";var o=Math.max($(window).height()-4*a,4*a);$(t).height(Math.min(o,Math.max(e.elt.clientHeight,n)))}}):"INPUT"===this.tagName&&"text"===this.type&&(i=function(t){var e,n,a;return function(s){if(!1===s)return O(t,e);var i=0;try{i=t.offsetWidth}catch(t){}if(i<=0)return;if(!e){e=L(t,i);let s=window.getComputedStyle(t);n=parseFloat(s.minWidth),a=parseFloat(s.maxWidth)}e.elt.innerText=t.value+"  ";let r=Math.min(e.elt.offsetWidth,$(window).width());a==a&&(r=Math.min(r,a)),$(t).outerWidth(Math.max(r,n))}}(this)),i&&(s.data("autogrower",i).on("change input",i),T||(T=new Map,$(window).resize(z)),T.set(this,i))),i&&""!==s.val()&&i()})),this},$.fn.unautogrow=function(){return this.each((function(){var t=$(this).data("autogrower");t&&t(!1)})),this},$((function(){$(".need-autogrow").autogrow()})),_.on("js-range-click",(function(t){if("change"!==t.type){var e=$(this).closest("form"),n=e[0].jsRangeClick||{},a=this.getAttribute("data-range-type")||this.name;e[0].jsRangeClick=n;var s=!1;if("keydown"!==t.type||M(t)||(s=F(t)),!(n.__clicking__||"updaterange"===t.type&&n["__update__"+a]||"keydown"===t.type&&"ArrowDown"!==s&&"ArrowUp"!==s)){var i=[],r=[];e.find("input.js-range-click").each((function(){var t=this.getAttribute("data-range-type")||this.name;a===t&&(i.push(this),u(this,"is-range-group")&&r.push(this))}));var o,l,c,d=n[a];for(c=0;c!==i.length;++c)i[c]===this&&(o=c),i[c]===d&&(l=c);if(s)return 0!==o&&"ArrowUp"===s?--o:o<i.length-1&&"ArrowDown"===s&&++o,$(i[o]).focus().scrollIntoView(),void t.preventDefault();var h,p=!1,f=!1;if("click"===t.type){for(n.__clicking__=!0,u(this,"is-range-group")?(c=0,h=i.length-1,p=this.getAttribute("data-range-group")):(n[a]=this,t.shiftKey&&d?l<=o?(c=l,h=o-1):(c=o+1,h=l):(c=1,h=0,f=this.getAttribute("data-range-group")));c<=h;)i[c].checked===this.checked||u(i[c],"is-range-group")||p&&i[c].getAttribute("data-range-group")!==p||$(i[c]).trigger("click"),++c;delete n.__clicking__}else"updaterange"===t.type&&(n["__updated__"+a]=!0);for(h=0;h!==r.length;++h){if(p=r[h].getAttribute("data-range-group"),f&&p!==f)continue;var m=null;for(c=0;c!==i.length;++c)if(i[c].getAttribute("data-range-group")===p&&!u(i[c],"is-range-group"))if(null===m)m=i[c].checked;else if(m!==i[c].checked){m="indeterminate";break}let n=!1;if("indeterminate"===m?(n=!r[h].indeterminate,r[h].indeterminate=!0,r[h].checked=!0):(n=r[h].indeterminate||r[h].checked!==m,r[h].indeterminate=!1,r[h].checked=m),n||r[h]===t.target){const t=new CustomEvent("rangechange",{bubbles:!0,cancelable:!0,detail:{rangeType:a,rangeGroup:p,newState:m}});e[0].dispatchEvent(t)}}}}}),-1),$((function(){$(".is-range-group").each((function(){_.trigger.call(this,"js-range-click","updaterange")}))}));let U=window.onerror,K=0;function Z(t,e,n){return"parsererror"===e?"<0>Internal error: bad response from server":n?"<0>"+n.toString():"timeout"===e?"<0>Connection timed out":e?"<0>Failed ["+e+"]":"<0>Failed"}function J(t,e){"object"==typeof t&&(t.message_list&&!$.isArray(t.message_list)?(W(e.url+": bad message_list"),t.message_list=[{message:"<0>Internal error",status:2}]):t.error&&!t.message_list?t.message_list=[{message:"<0>"+t.error,status:2}]:t.warning&&W(e.url+": `warning` obsolete"))}window.onerror=function(t,e,n,a,s){if((e||!n)&&t.indexOf("ResizeObserver loop limit exceeded")<0&&++K<=10){var i={error:t,url:e,lineno:n};a&&(i.colno=a),W(i,s,!0)}return!!U&&U.apply(this,arguments)},$(document).ajaxError((function(t,e,n,a){if(4!=e.readyState)return;let s;if(e.responseText&&"{"===e.responseText.charAt(0))try{s=JSON.parse(e.responseText)}catch(t){}if(J(s,n),502!==e.status){let t=new URL(n.url,document.baseURI).href+" API failure: ";siteinfo.user&&siteinfo.user.email&&(t+="user "+siteinfo.user.email+", "),t+=e.status,a&&(t+=", "+a),e.responseText&&(t+=", "+e.responseText.substring(0,100)),W(t)}}));let G=0,Y=[];function V(t){if(void 0===t)return G>0;G>0?Y.push(t):t()}$.ajaxPrefilter((function(t){if(!1===t.global)return;let e=t.success||[],n=t.error;$.isArray(e)||(e=[e]),t.success=[function(e){J(e,t),"object"!=typeof e||!e.sessioninfo||!t.url.startsWith(siteinfo.site_relative)||""===siteinfo.site_relative&&/^(?:[a-z][-a-z0-9+.]*:|\/|\.\.(?:\/|\z))/i.test(t.url)||function(t,e){siteinfo.user.cid==t.sessioninfo.cid?(siteinfo.postvalue=t.sessioninfo.postvalue,$("form").each((function(){var t=/^([^#]*[&?;]post=)([^&?;#]*)/.exec(this.action);t&&(this.action=t[1].concat(siteinfo.postvalue,this.action.substring(t[0].length))),this.elements.post&&(this.elements.post.value=siteinfo.postvalue)}))):$("form").each((function(){this.elements.sessionreport&&(this.elements.sessionreport=e.url.concat(": bad response ",JSON.stringify(t.sessioninfo),", current user ",JSON.stringify(siteinfo.user)))}))}(e,t)}],e.length&&Array.prototype.push.apply(t.success,e),t.error=[],n&&Array.prototype.push.apply(t.error,$.isArray(n)?n:[n]),t.error.push((function(n,a,s){let i;if(/application\/json/.test(n.getResponseHeader("Content-Type")||"")&&n.responseText)try{i=JSON.parse(n.responseText)}catch(t){}i&&"object"==typeof i&&!1===i.ok||(i={ok:!1}),J(i,t),i.message_list||(i.message_list=[{message:Z(0,a,s),status:2}]);for(let t=0;t!==e.length;++t)e[t](i,n,a)})),null==t.timeout&&(t.timeout=1e4),null==t.dataType&&(t.dataType="json"),t.trackOutstanding&&++G})),$(document).ajaxComplete((function(t,e,n){if(n.trackOutstanding&&0==--G)for(;Y.length;)Y.shift()()}));let X,Q=0,tt=[];function et(t,e,n){return"string"==typeof n&&(n={method:n}),new Promise((function(a){function s(){++Q,$.ajax(t,Object.assign({data:e,method:"POST",cache:!1,dataType:"json",success:function(t){a(t),--Q,tt.length&&tt.shift()()}},n||{}))}Q<5?s():tt.push(s)}))}function nt(e){for(var n="string"==typeof e?1:0,a=t.site_json(!1,"list_digests")||[],s=-1,i=(new Date).getTime(),r=0;r<a.length;++r){var o=a[r];o[n]===e?s=r:o[2]<i-3e4?(a.splice(r,1),--r):i<=o[0]&&(i=o[0]+1)}return s>=0?a[s][2]=i:n&&(a.push([i,e,i]),s=a.length-1),t.site(!1,"list_digests",a),s>=0&&a[s][1-n]}function at(t){var e,n;return(n=/^list(\d+)(?=\s|$)/.exec(t))&&(e=nt(+n[1]))?e:t}function st(t,e){var n=function(t){var e=nt(t);return e?"list"+e:t}(t=at(t));e&&/(?:^|\/)pset(?:|\.php)\//.test(e)&&(n+=function(t,e){var n,a,s=/(?:^|\/)(~[^\/]+)\/pset(?:|\.php)\/([^\/]+)((?:\/[0-9a-f]+)?)(?=[\/?#]|$)/.exec(e);if(s){if((t=JSON.parse(t)).pset){if(t.pset!==s[2])return"";n=a=s[1]}else n=(a=s[1]+"/pset/"+s[2])+s[3];var i=t.items.indexOf(n);if(i<0&&a!==n&&(i=t.items.indexOf(a)),i>=0)return" "+JSON.stringify({cur:s[1]+"/pset/"+s[2],prev:0===i?null:t.items[i-1],next:i===t.items.length-1?null:t.items[i+1]})}return""}(t,e)),X=(new Date).getTime();var a,s="; Max-Age=20";siteinfo.site_relative&&(a=/^[a-z]+:\/\/[^\/]*(\/.*)/.exec((siteinfo.absolute_base||(siteinfo.absolute_base=new URL(siteinfo.base,document.baseURI).href),siteinfo.absolute_base)))&&(s+="; Path="+a[1]),document.cookie="hotlist-info-".concat(X,"=",encodeURIComponent(n),siteinfo.cookie_params,s)}function it(t,e){let n,a;if(!(e&&e.startsWith(siteinfo.site_relative)&&function(t){return/(?:^|\/)pset(?:|\.php)(?:$|\/)/.test(t)}(a=e.substring(siteinfo.site_relative.length))&&(n=t.closest(".has-hotlist"))))return;let s=n.getAttribute("data-hotlist");if(!s){const t=new CustomEvent("pa-hotlist",{bubbles:!0,cancelable:!0,detail:{hotlist:null}});n.dispatchEvent(t),s=t.detail.hotlist,s&&"string"!=typeof s&&(s=JSON.stringify(s))}s&&st(s,a)}function rt(){var t,e=location.href;return location.hash&&(e=e.substring(0,e.length-location.hash.length)),this.href.substring(0,e.length+1)===e+"#"||!!V()&&(V((t=this,function(){window.location=t.href})),!0)}$(document).on("click","a",(function(t){u(this,"ui")||F.is_default_a(t)&&!this.target&&rt.call(this,t)||it(this,this.getAttribute("href"))})),$(document).on("submit","form",(function(t){u(this,"ui-submit")?(t.preventDefault(),_.call(this,t)):it(this,this.getAttribute("action"))})),$(window).on("beforeunload",(function(){var t=document.body.getAttribute("data-hotlist");t&&(!X||X+3<(new Date).getTime())&&st(t,location.href)})),$((function(){$(".has-hotlist").each((function(){var t=this.getAttribute("data-hotlist");t&&t.startsWith("list")&&(t=at(t))&&this.setAttribute("data-hotlist",t)}))}));const ot=/[&<>\"']/g,lt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function ct(t){return null!==t&&"number"!=typeof t?t.replace(ot,(function(t){return lt[t]})):t}function ut(t){return encodeURIComponent(t).replace(/[^-A-Za-z0-9_.%]|%../g,(function(t){return 1===t.length?"@"+t.charCodeAt(0).toString(16):"%2F"===t?"/":"@"+t.substring(1)}))}function dt(t){return decodeURIComponent(t.replace(/@/g,"%"))}const ht=["Top","Right","Bottom","Left"],pt=["top","right","bottom","left"],ft=["height","width"],mt=8;function gt(t,e){return"border"+ht[t]+e}function bt(t){return gt(t,"Color")}let _t=Math.round;var vt;function xt(t){const e=function(t){const e=document.createElement("div");e.className="bubble hidden"+t;const n=document.createElement("div");return n.className="bubtail bubtail0 nomargin"+t,e.appendChild(n),document.body.appendChild(e),e}(t),n=$(e).children(),a=[n.width(),n.height()],s=window.getComputedStyle(e);for(let t=0;4!==t;++t){let e=s["margin"+ht[t]];e&&(e=parseFloat(e))||(e=0),a[pt[t]]=e}return e.remove(),a}function yt(t,e){!e&&t&&"object"==typeof t?t=(e=t).content:e?"string"==typeof e&&(e={color:e}):e={};var n=null,a=e.dir,s=null,i=e.color?" "+e.color:"";let r=document.createElement("div");r.className="bubble nomargin"+i;{let t=document.createElement("div");t.className="bubtail bubtail0 nomargin"+i;let e=document.createElement("div"),n=document.createElement("div");n.className="bubtail bubtail1 nomargin"+i,r.append(t,e,n),t.style.width=t.style.height=n.style.width=n.style.height="0px"}document.body.appendChild(r),e["pointer-events"]&&$(r).css({"pointer-events":e["pointer-events"]});var o=r.childNodes,l=null,c=null;function u(){var t=[0,0,0,0],e=l[1],n=l[0]/2;(c=parseFloat($(r).css(gt(s,"Width"))))!=c&&(c=0),t[1^s]=t[3^s]=n+"px",t[2^s]=e+"px",o[0].style.borderWidth=t.join(" "),t[1^s]=t[3^s]=n+"px",t[2^s]=e+"px",o[2].style.borderWidth=t.join(" ");for(var a=1;a<=3;++a)o[0].style[pt[s^a]]=o[2].style[pt[s^a]]="";o[0].style[pt[s]]=-e-c+"px";var i=c/n*Math.sqrt(e*e+n*n);for(o[2].style[pt[s]]=-e-c+i+"px",a=0;a<3;a+=2)o[a].style.borderLeftColor=o[a].style.borderRightColor=o[a].style.borderTopColor=o[a].style.borderBottomColor="transparent";var u,d,h=(u=$(r).css("backgroundColor"),d=u.match(/^rgb\((.*)\)$/),d?"rgba("+d[1]+", 1)":u).replace(/([\d.]+)\)/,(function(t,e){return.75*e+.25+")"}));o[0].style[bt(2^s)]=$(r).css(bt(s)),o[2].style[bt(2^s)]=h}function d(t,e,n,a){var s=t[pt[n]],i=t[pt[2^n]],r=(1-a)*s+a*i;return r=Math.max(r,Math.min(i,e[pt[n]]+mt)),Math.min(r,Math.max(s,e[pt[2^n]]-mt))}function h(t,e,n,a,s,i){var r=e[pt[a]],o=e[pt[2^a]],c=n[ft[1&a]],u=t-s*c;return!i&&u<r+mt?u=Math.min(t-l[0],r+mt):!i&&u+c>o-mt&&(u=Math.max(t+l[0]-c,o-mt-c)),u}function p(t,e){var a=Math.max(3===e?0:n.left-t.left,1===e?0:t.right-n.right);return("h"===e||1===e||3===e)&&a>100?Math.min(t.width,a)-3*mt:t.width-3*mt}function f(t,e){var a=$(r);a.css("maxWidth","");var s=a.geometry(!0),i=p(t,e);i<s.width&&(a.css("maxWidth",i),s=a.geometry(!0));var o=[n.top-l.bottom-s.height-l[0],n.right+l.left+s.width+l[0],n.bottom+l.top+s.height+l[0],n.left-l.right-s.width-l[0]];return o.width=s.width,o.height=s.height,o.wconstraint=i,o}function m(t,e,n){var a=p(e,n);return(a<t.wconstraint&&a<t.width||a>t.wconstraint&&t.width>=t.wconstraint)&&(t=f(e,n)),t}function g(t,e){var n;return t.length>e&&(n="0123trblnesw".indexOf(t.charAt(e)))>=0?n%4:-1}function b(t,e){var n,a=$(r).css("border"+t+"Radius");return a?((n=a.indexOf(" "))>-1&&(a=e?a.substring(n+1):a.substring(0,n)),parseFloat(a)):0}function _(t,e,n){var a,s;return 1&n?(a=b(ht[0]+ht[n],1),s=b(ht[2]+ht[n],1)):(a=b(ht[n]+ht[3],1),s=b(ht[n]+ht[1],1)),Math.min(Math.max(t,a),e[ft[1&n^1]]-s-l[0])}function v(){l=l||xt(i),null==a&&(a="r");var t=/!/.test(a),e=/\*/.test(a),c=a.replace(/[^a0-3neswtrblhv]/,""),p=g(c,0),b=g(c,1);b=p>=0&&b>=0&&(1&b)!=(1&p)?1===b||2===b?1:0:.5,p<0&&(p=/^[ahv]$/.test(c)?c:"a");var v=$(window).geometry(),x=f(v,c);"a"===p&&(x.height+l[0]>Math.max(n.top-v.top,v.bottom-n.bottom)?x=m(x,v,p="h"):p="v");var y,w,k,C,A,E=[v.top+3*mt,v.right-3*mt,v.bottom-3*mt,v.left+3*mt];("v"===p||0===p||2===p)&&!t&&b<0&&x[2]>E[2]&&x[0]<E[0]&&(x[3]>=E[3]||x[1]<=E[1])&&(x=m(x,v,p="h")),x=m(x,v,p="v"===p&&x[2]>E[2]&&x[0]>E[0]||0===p&&!t&&x[2]>v.bottom&&v.top-x[0]<x[2]-v.bottom||2===p&&(t||x[0]>=v.top+mt)?2:"v"===p||0===p||2===p?0:"h"===p&&x[3]-v.left<v.right-x[1]||1===p&&!t&&x[3]<v.left||3===p&&(t||x[1]<=v.right-mt)?3:1),p!==s&&(s=p,u());var N=parseFloat($(r).css(gt(1&p?0:3,"Width")));1&p?(w=h(C=d(n,v,0,b),v,x,0,b,e),A=_(_t(C-w-l[0]/2-N),x,p),o[0].style.top=o[2].style.top=A+"px",y=1==p?n.left-l.right-x.width-l[1]-1:n.right+l.left+l[1]):(y=h(k=d(n,v,3,b),v,x,3,b,e),A=_(_t(k-y-l[0]/2-N),x,p),o[0].style.left=o[2].style.left=A+"px",w=0==p?n.bottom+l.top+l[1]:n.top-l.bottom-x.height-l[1]-1),r.style.left=_t(y)+"px",r.style.top=_t(w)+"px",r.style.visibility="visible"}function x(){r&&r.parentElement.removeChild(r),r=null}var y={near:function(t,e){("string"==typeof t||t.tagName||t.jquery)&&(t=$(t),null==a&&t[0]&&(a=t[0].getAttribute("data-tooltip-dir")),t=t.geometry(!0));for(let e=0;e<4;++e)!(pt[e]in t)&&pt[2^e]in t&&(t[pt[e]]=t[pt[2^e]]);var s,i;return e&&(e=$(e))&&e.length&&e[0]!=window&&(s=t,i=e.geometry(),(s=$.extend({},s)).top+=i.top,s.right+=i.left,s.bottom+=i.top,s.left+=i.left,t=s),n=t,v(),y},at:function(t,e,n){return y.near({top:e,left:t},n)},dir:function(t){return a=t,y},remove:x,color:function(t){return i!==(t=t?" "+t:"")&&(i=t,r.className="bubble"+i,o[0].className="bubtail bubtail0"+i,o[2].className="bubtail bubtail1"+i,s=l=null,n&&v()),y},html:function(t){var e=o[1];if(void 0===t)return e.innerHTML;if("string"==typeof t&&t===e.innerHTML&&"visible"===r.style.visibility)return y;if(n&&$(r).css({maxWidth:"",left:"",top:""}),"string"==typeof t)e.innerHTML=t;else{for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);t&&t.jquery?t.appendTo(e):e.appendChild(t)}return n&&v(),y},text:function(t){return void 0===t?$(o[1]).text():y.html(t?function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML}(t):t)},content_node:function(){return o[1].firstChild},hover:function(t,e){return $(r).hover(t,e),y},removeOn:function(t,e){return arguments.length>1?$(t).on(e,x):r&&$(r).on(t,x),y},self:function(){return r?$(r):null},outerHTML:function(){return r?r.outerHTML:null}};return t&&y.html(t),y}window.devicePixelRatio&&window.devicePixelRatio>1&&(vt=window.devicePixelRatio,_t=function(t){return Math.round(t*vt)/vt});let wt={};function kt(t){if(window.disable_tooltip)return null;const e=this;t=t&&"string"==typeof t?{builder:t}:Object.assign({},t||{}),(t=function(t,e){var n=t.getAttribute("data-tooltip-info");return n&&("string"==typeof n&&"{"===n.charAt(0)?n=JSON.parse(n):"string"==typeof n&&(n={builder:n}),e=$.extend(n,e)),e.builder&&wt[e.builder]&&(e=wt[e.builder].call(t,e)||e),(null==e.dir||t.hasAttribute("data-tooltip-dir"))&&(e.dir=t.getAttribute("data-tooltip-dir")||"v"),(null==e.type||t.hasAttribute("data-tooltip-type"))&&(e.type=t.getAttribute("data-tooltip-type")),(null==e.className||t.hasAttribute("data-tooltip-class"))&&(e.className=t.getAttribute("data-tooltip-class")||"tooltip dark"),t.hasAttribute("data-tooltip")?e.content=t.getAttribute("data-tooltip"):null==e.content&&(t.hasAttribute("aria-label")?e.content=t.getAttribute("aria-label"):t.hasAttribute("title")&&(e.content=t.getAttribute("title"))),t.hasAttribute("data-tooltip-delay")?e.delay=parseInt(t.getAttribute("data-tooltip-delay")):null!=e.delay||null!=e.type&&"hover"!==e.type||(e.delay=150),e}(e,t)).element=this;var n,a=null,s=null,i=null,r=null,o=1,l=t.content;function c(){s=clearTimeout(s),a&&a.remove(),$(e).removeData("tooltipState"),window.global_tooltip===n&&(window.global_tooltip=null)}function u(){r||0===o||(l?l instanceof Promise?l.then((function(t){l=t,u()})):a?a.html(l):(a=yt(l,{color:t.className,dir:t.dir}),i=t.near||t.element,a.near(i).hover(n.enter,n.exit)):(a&&a.remove(),a=i=null))}n={enter:function(){return s=clearTimeout(s),++o,n},exit:function(){var e="focus"===t.type?0:200;return s=clearTimeout(s),--o<=0&&"sticky"!==t.type&&(s=setTimeout(c,e)),n},erase:c,_element:e,html:function(t){return void 0===t?l:(l=t,u(),n)},text:function(t){return n.html(ct(t))},near:function(){return i},noDelayClass:function(){return t.noDelayClass}};{let s=window.global_tooltip;s&&s._element===t.element&&s.html()===l?n=s:(s&&s.erase(),$(e).data("tooltipState",n),!t.delay||t.noDelayClass&&s&&s.noDelayClass()===t.noDelayClass?u():r=setTimeout((function(){r=null,l&&!a&&u()}),t.delay),window.global_tooltip=n)}return n}function Ct(){const t=$(this).data("tooltipState");t?t.enter():kt.call(this)}function At(){var t=$(this).data("tooltipState");t&&t.exit()}function Et(){h(this,"need-tooltip"),"focus"===this.getAttribute("data-tooltip-type")?$(this).on("focus",Ct).on("blur",At):$(this).hover(Ct,At)}Et.erase=function(){var t=this===Et?window.global_tooltip:$(this).data("tooltipState");t&&t.erase()},Et.add_builder=function(t,e){wt[t]=e},Et.enter=function(t,e){const n=$(t).data("tooltipState");n?n.enter():kt.call(t,e)},Et.leave=function(t){At.call(t)},$((function(){$(".need-tooltip").each(Et)})),_.on("js-repo-copy",(function(){var t=document.createTextNode(this.getAttribute("data-pa-repo")),e=yt(t,{color:"tooltip",dir:"t"});e.near(this);var n=document.createRange();n.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(n);try{document.execCommand("copy")}catch(t){}window.getSelection().removeAllRanges(),e.remove(),window.global_tooltip&&window.global_tooltip.elt==this&&window.global_tooltip.text(this.getAttribute("data-pa-repo"))})),_.on("js-repo-list",(function(t){var e=this;$.ajax(q("=api/repositories",{u:this.getAttribute("data-pa-user")}),{method:"POST",cache:!1,success:function(t){var n="Error loading repositories";if(t.repositories&&t.repositories.length){n="Repositories: ";for(var a=0;a<t.repositories.length;++a){var s=t.repositories[a];a&&(n+=", "),n+='<a href="'+ct(s.url)+'">'+ct(s.name)+"</a>"}}else t.repositories&&(n="No repositories");$('<div style="font-size:medium;font-weight:normal"></div>').html(n).insertAfter(e)}}),t.preventDefault()})),_.on("js-pset-viewoptions",(function(){x(this.nextSibling,this.parentNode)})),_.on("js-pset-setgrader",(function(){var t=$(this.closest("form"));$.ajax(t[0].getAttribute("action"),{data:t.serializeWith({}),type:"POST",cache:!1,dataType:"json",success:function(e){var n;t.find(".ajaxsave61").html(e.ok?"Saved":"<span class='error'>Error: "+e.error+"</span>"),e.ok&&(n=t.find("a.actas")).length&&n.attr("href",n.attr("href").replace(/actas=[^&;]+/,"actas="+encodeURIComponent(e.grader_email)))},error:function(){t.find(".ajaxsave61").html("<span class='error'>Failed</span>")}})})),_.on("js-pset-setcommit",(function(){this.closest("form").submit()})),_.on("js-pset-flag",(function(){let t=this,e=t.closest("form");"flag"!==this.name||e.elements.flagreason?"flag"===this.name?$.post(q("=api/flag",{psetinfo:this,flagid:"new"}),{reason:e.elements.flagreason.value},(function(n){n&&n.ok?($(e).find(".flagreason").remove(),$(t).replaceWith("<strong>Flagged</strong>")):$(e).find(".ajaxsave61").html('<span class="error">Failed</span>')})):"resolveflag"==this.name&&$.post(q("=api/flag",{psetinfo:this,flagid:this.getAttribute("data-flagid"),resolve:1}),{},(function(n){n&&n.ok?$(t).replaceWith("<strong>Resolved</strong>"):$(e).find(".ajaxsave61").html('<span class="error">Failed</span>')})):($(t).before('<span class="flagreason">Why do you want to flag this commit? &nbsp;<input type="text" name="flagreason" value="" placeholder="Optional reason" class="need-autogrow"> &nbsp;</span>'),$(e.elements.flagreason).on("keypress",(function(e){M(e)||"Enter"!==F(e)||(e.preventDefault(),e.stopImmediatePropagation(),$(t).click())})).autogrow()[0].focus(),$(t).html("OK"))}));const $t=[];class Nt{constructor(t){if(t.nodeType!==Node.ELEMENT_NODE||!u(t,"pa-filediff"))throw new Error;this.element=t}static closest(t){const e=t.closest(".pa-filediff");return e?new Nt(e):null}static referenced(t){const e=t.closest(".pa-fileref");let n;return"A"===e.firstChild.tagName&&(n=Nt.by_hash(e.firstChild.hash)),n||Nt.closest(t)}static by_file(t){const e=document.getElementById("F"+ut(t));return e?new Nt(e):null}static by_hash(t){let e;return(t.startsWith("#F")||t.startsWith("#U"))&&(e=document.getElementById(t.substring(1))),e?new Nt(e):null}static add_decorator(t){$t.push(t)}load(){if(u(this.element,"need-load")){const t=this.element.closest(".pa-psetinfo"),e=u(this.element,"pa-wdiff");return h(this.element,"need-load"),new Promise((n=>{$.ajax(q("api/filediff",{psetinfo:t,wdiff:e?1:null}),{type:"GET",cache:!1,dataType:"json",data:{file:this.file,base_commit:t.getAttribute("data-pa-base-commit"),commit:t.getAttribute("data-pa-commit")},success:t=>{if(t.ok&&t.content_html){const e=$(t.content_html);$(this.element).html(e.children()),this.decorate()}n(this)}})}))}return new o(this)}decorate(){for(let t of $t)t(this)}static decorate_page(){$(".pa-filediff.need-decorate").each((function(){h(this,"need-decorate"),u(this,"need-load")||new Nt(this).decorate()}))}toggle(t){null==t&&(t=u(this.element,"hidden"));const e=this.element.previousSibling,n=e&&u(e,"pa-fileref")?Nt.referenced(e):null,a=n&&n.element===this.element;x(this.element,a?e:null,t)}toggle_show_left(t){null==t&&(t=u(this.element,"pa-hide-left")),p(this.element,"pa-hide-left",!t),$(this.element.previousSibling).find(".pa-diff-toggle-hide-left").toggleClass("btn-primary",t)}get file(){const t=this.element.id;if("U"===t.charAt(0)){const e=t.indexOf("/F");return dt(t.substring(e+2))}return dt(t.substring(1))}lineid_anchor(t){return"L".concat(t,this.element.id)}lines(){return Dt.all(this.element.firstChild)}line(t,e,n){return null==e&&(e=+t.substring(1),t="b"===t.charAt(0)),this.load().then((()=>{for(let a of Dt.all(n||this.element.firstChild)){if(a.base_contains(t,e))return a;if(a.expansion_contains(t,e))return a.expand().then((n=>this.line(t,e,n)))}throw null}))}get psetinfo(){return void 0===this._psetinfo&&(this._psetinfo=this.element.closest(".pa-psetinfo")),this._psetinfo}get pset(){return this.psetinfo.getAttribute("data-pa-pset")}get repourl(){return this.psetinfo.getAttribute("data-pa-repourl")}static define_method(t,e){Object.prototype.hasOwnProperty.call(Nt.prototype,t)||Object.defineProperty(Nt.prototype,t,{value:e,enumerable:!1,configurable:!0,writable:!0})}}class Dt{constructor(t){if(t.nodeType!==Node.ELEMENT_NODE||!u(t,"pa-dl"))throw new Error;this.element=t}static closest(t){const e=t.closest(".pa-dl");return e?new Dt(e):null}get filediff(){return void 0===this._filediff&&(this._filediff=Nt.closest(this.element)),this._filediff}get file(){return this.filediff.file}get note_lineid(){const t=this.element;let e,n,a;return t.hasAttribute("data-landmark")?t.getAttribute("data-landmark"):u(t,"pa-dlr")&&(e=t.lastChild.firstChild)&&(n=e.getAttribute("data-landmark"))&&(a=n.indexOf("-"))>=0?(u(t,"pa-gd")?"a":"b").concat(n.substring(a+1)):u(t,"pa-gd")?"a".concat(t.firstChild.getAttribute("data-landmark")):"b".concat(t.firstChild.nextSibling.getAttribute("data-landmark"))}get linea(){const t=this.element;return u(t,"pa-gc")||u(t,"pa-gd")&&!u(t,"pa-dlr")?+t.firstChild.getAttribute("data-landmark"):this.linea_within(1/0)}get lineb(){const t=this.note_lineid;return t.startsWith("b")?+t.substring(1):null}linea_within(t){let e=this.element;for(;e&&t>=0;){if(u(e,"pa-gc"))return+e.firstChild.getAttribute("data-landmark");e=e.previousSibling,--t}return 0}get psetinfo(){return this.filediff.psetinfo}get pset(){return this.filediff.pset}get repourl(){return this.filediff.repourl}get hash(){const t=this.element,e=this.filediff.element.id;return t.hasAttribute("data-landmark")?"#L".concat(t.getAttribute("data-landmark"),e):u(t,"pa-gd")?"#La".concat(t.firstChild.getAttribute("data-landmark"),e):u(t,"pa-gi")||u(t,"pa-gc")?"#Lb".concat(t.firstChild.nextSibling.getAttribute("data-landmark"),e):null}is_visible(){return!!this.element.offsetParent}visible_predecessor(){if(!this.element.offsetParent)for(let t=this.element.previousSibling;t;t=t.previousSibling)if(u(t,"pa-dlr"))return new Dt(t);return this}visible_source(){for(let t of Dt.all(this,1))if(t.is_visible()&&t.is_source())return t;return null}is_base(){return/^pa-dl pa-g[idc]/.test(this.element.className)}base_contains(t,e){const n=this.element;return/^pa-dl pa-g[idc]/.test(n.className)&&(t?n.firstChild.nextSibling:n.firstChild).getAttribute("data-landmark")==e}is_source(){return/ pa-g[idc]/.test(this.element.className)}is_expandable(){return this.element.hasAttribute("data-expandmark")}expansion_contains(t,e){const n=this.element.getAttribute("data-expandmark"),a=n?n.match(/^a(\d+)b(\d+)\+(\d*)$/):null;if(a){const n=a[t?2:1]-e;return n>=0&&(!a[3]||n<a[3])}return!1}expand(){const t=this.element,e=t.getAttribute("data-expandmark"),n=e?e.match(/^a(\d+)b(\d+)\+(\d*)$/):null;if(!n||"0"===n[3])return new o(this);t.removeAttribute("data-expandmark");const a=+n[1],s=+n[2],i={psetinfo:this.element,file:this.file,fromline:s};return""!==n[3]&&(i.linecount=+n[3]),new Promise((e=>{$.ajax(q("api/blob",i),{success:function(n){if(n.ok&&n.data){const i=n.data.replace(/\n$/,"").split("\n");for(let e=i.length-1;e>=0;--e){const n='<div class="pa-dl pa-gc"><div class="pa-da" data-landmark="'.concat(a+e,'"></div><div class="pa-db" data-landmark="',s+e,'"></div><div class="pa-dd"></div></div>');$(n).insertAfter(t).find(".pa-dd").text(i[e])}const r=t.nextSibling;$(t).remove();const o=Nt.closest(r);u(o.element,"pa-highlight")&&o.highlight(),e(new Dt(r))}}})}))}is_annotation(){return u(this.element,"pa-gn")}is_note(){return u(this.element,"pa-gw")}upper_bound(t,e){null==e&&(e=+t.substring(1),t="b"===t.charAt(0));let n=!1;for(let a of Dt.all(this)){const s=a.element;if(n&&(u(s,"pa-gx")||u(s,"pa-dlr")))return a;if(a.is_source()){const i=+(t?s.firstChild.nextSibling:s.firstChild).getAttribute("data-landmark");if(!i&&n||e<i)return a;e===i&&a.is_base()&&(n=!0)}else if(s.hasAttribute("data-landmark")){const n=s.getAttribute("data-landmark");if(n.charAt(0)===(t?"b":"a")&&e<+n.substring(1))return a}}return null}static get BACKWARD(){return 1}static get ANYFILE(){return 2}static*all(t,e){t instanceof Dt&&(t=t.element),e=e||0;let n=t.parentElement;const a=1&e?"previousSibling":"nextSibling";for(;;){for(;!t&&n;){if(!(2&e)&&u(n,"pa-filediff"))return;t=n[a],n=n.parentElement}if(!t)break;t.nodeType!==Node.ELEMENT_NODE?t=t[a]:u(t,"pa-dg")?(n=t,t=n[1&e?"lastChild":"firstChild"]):(u(t,"pa-dl")&&(yield new Dt(t)),t=t[a])}}static*range(t,e,n,a){let s=-1,i=-1;for(let r of Dt.all(t)){const t=r.element;if(!u(t,"pa-dlr")){const o=t.firstChild;if(u(o,"pa-da"))o.hasAttribute("data-landmark")&&(s=+o.getAttribute("data-landmark")),o.nextSibling.hasAttribute("data-landmark")&&(i=+o.getAttribute("data-landmark"));else if(t.hasAttribute("data-landmark")){const e=t.getAttribute("data-landmark");"a"===e.charAt(0)?s=+e.substring(1):i=+e.substring(1)}if(s>n)break;s>=e&&(!a||t.matches(a))&&(r.linea=s,r.lineb=i,yield r)}}}}function St(t){let e,n,a;(e=t.match(/^[^#]*(#(?:U[-A-Za-z0-9_.@]+\/|)F[-A-Za-z0-9_.@\/]+)$/))?a=Nt.by_hash(e[1]):(e=t.match(/^[^#]*#L([ab]\d+)((?:U[-A-Za-z0-9_.@]+\/|)F[-A-Za-z0-9_.@\/]+)$/))&&(a=Nt.by_hash("#"+e[2]),n=e[1]),a&&n?a.line(n).then((t=>{a.toggle(!0);const e=t.visible_predecessor().element;u(e,"pa-gd")&&a.toggle_show_left(!0),d(e,"pa-line-highlight"),window.scrollTo(0,Math.max($(e).geometry().top-Math.max(.1*window.innerHeight,24),0))})).catch(null):a&&(a.toggle(!0),window.scrollTo(0,Math.max($(a.element).geometry().top-Math.max(.1*window.innerHeight,24),0)))}function Ft(t,e,n){let a;for(;e!==n&&(32===(a=t.charCodeAt(e))||9===a);)++e;return e}function Mt(t,e,n,a){for(;e!==n;){const n=t.charCodeAt(e),s=32|n;if(s>=97&&s<=122);else if(a!==e||45!==n&&(n<48||n>57))break;++e}return e}function Tt(t,e,n){let a;const s={tag:null,ok:!1,open:null,close:null,attr:{},pos:e};if(60!==t.charCodeAt(e))return s;(e=Ft(t,e+1,n))!==n&&47===t.charCodeAt(e)&&(s.open=!1,s.close=!0,e=Ft(t,e+1,n));const i=e;if((e=Mt(t,e,n,e))===i)return s;for(null===s.open&&(s.open=!0),s.tag=t.substring(i,e).toLowerCase();;){if(a=(e=Ft(t,e,n))!==n?t.charCodeAt(e):-1,62===a)return s.pos=e+1,s.ok=!0,s;if(47===a)s.close=!0,++e;else{if(s.close)return s;if(!((32|a)>=97&&(32|a)<=122))return s;{const i=e,r=Mt(t,e,n,e),o=t.substring(i,r).toLowerCase();if((e=Ft(t,r,n))!==n&&61===t.charCodeAt(e))if(a=(e=Ft(t,e+1,n))!==n?t.charCodeAt(e):-1,34===a||39===a){const n=t.indexOf(t.charAt(e),e+1),a=t.indexOf("\n",e+1);if(-1===n||a>0&&n>a)return s;s.attr[o]=t.substring(e+1,n),e=n+1}else{if(!(45===a||a>=48&&a<=57||(32|a)>=97&&(32|a)<=122))return s;{const a=e;e=Mt(t,e+1,n,e),s.attr[o]=t.substring(a,e)}}else s.attr[o]=!0}}}}function jt(t,e){let n=t.src,a=t.pos,s=t.posMax;if(60!==n.charCodeAt(a)||a+2>=s)return!1;let i=32|n.charCodeAt(a+1);if(47!==i&&98!==i&&105!==i&&115!==i)return!1;const r=Tt(n,a,s);if(!r.ok)return!1;if("br"===r.tag){if(r.open){const t=Tt(n,Ft(n,r.pos,s),s);t.ok&&"br"===t.tag&&!t.open&&(r.pos=t.pos)}e||t.push("hardbreak","br",0)}else if("sub"!==r.tag&&"sup"!==r.tag||r.close){if("img"!==r.tag||!r.attr.src)return!1;{let e=t.push("image","img",0);e.attrs=[["src",r.attr.src],["alt",""]],r.attr.title&&e.attrs.push(["title",r.attr.title]),e.children=[],e.content=r.attr.alt||"",""!==e.content&&t.md.inline.parse(e.content,t.md,t.env,e.children)}}else{const a=n.indexOf("<",r.pos),i=n.indexOf("\n",r.pos);let o=a>=r.pos&&(i<0||i>a)?Tt(n,a,s):null;if(!o||!o.ok||o.open||o.tag!==r.tag)return!1;if(!e){t.push(r.tag+"_open",r.tag,1),t.push("text","",0).content=n.substring(r.pos,a),t.push(r.tag+"_close",r.tag,-1)}r.pos=o.pos}return t.pos=r.pos,!0}function Lt(t){t.inline.ruler.after("autolink","minihtml_inline",jt)}let zt,Ot;function Bt(t,e,n){try{const a=hljs.highlight(t,e,!0,n),s=a.value;return e.endsWith("\r\n")&&s.endsWith("\n\n")&&(a.value=s.substring(0,s.length-1)),a}catch(t){return null}}function It(t){return t[0]+1===t[1]?String(t[1]):t[0]+1+"-"+t[1]}function Pt(t,e,n,a,s){var i=t[e];return i.map&&0===i.level&&i.attrSet("data-landmark",It(i.map)),s.renderToken(t,e,n,a)}function Rt(t,e,n,a,s){var i=t[e];return i.map&&i.level<=1&&i.attrSet("data-landmark",It(i.map)),s.renderToken(t,e,n,a)}function qt(t,e){if(e.map&&0===e.level){var n=' data-landmark="'+It(e.map)+'"',a=t.indexOf(" "),s=t.indexOf(">");a>0&&a<s&&(s=a),t=t.substring(0,s)+n+t.substring(s)}return t}function Ht(t){return t?function(e,n,a,s,i){var r=e[n];return qt(t(e,n,a,s,i),r)}:Pt}function Wt(){if(!zt){for(var t of(zt=markdownit({linkify:!0}).use(markdownit_katex).use(Lt),["paragraph_open","heading_open","ordered_list_open","bullet_list_open","table_open","blockquote_open","hr"]))zt.renderer.rules[t]=Ht(zt.renderer.rules[t]);zt.renderer.rules.fence=zt.renderer.rules.code_block=function(t){return function(e,n,a,s,i){const r=e[n];let o,l=r.info?t.utils.unescapeAll(r.info):"";l&&l.indexOf(" ")>=0&&((o=l.match(/^ *([-a-z+]+) *$/))?l=o[1]:(r.content=l+"\n"+r.content,r.map&&(r.map[0]-=1),l=""));let c=l?l.trim().split(/\s+/g)[0]:"";c&&hljs.getLanguage(c)||(c=null);let u=r;if(c){let t=r.attrIndex("class");u={attrs:r.attrs?r.attrs.slice():[]},t<0?u.attrs.push(["class",a.langPrefix+c]):u.attrs[t][1]+=" "+a.langPrefix+c}let d="><code".concat(i.renderAttrs(u),">");if(r.map&&0===r.level){const t=r.content.split(/\n/),e=[];""===t[t.length-1]&&t.pop();const n=t.length;let a=0,s=r.map[0]+2,i=null;for(;c&&a!==n;){const r=Bt(c,t[a]+"\n",i);if(!r)break;e.push('<pre data-landmark="',s+a,a+1!==n?'" class="partial"':'"',d,r.value,"</code></pre>"),i=r.top,++a}for(;a!==n;)e.push('<pre data-landmark="',s+a,a+1!==n?'" class="partial"':'"',d,t[a],"\n</code></pre>"),++a;return e.join("")}return"<pre".concat(d,t.utils.escapeHtml(r.content),"</code></pre>")}}(zt),zt.renderer.rules.image=function(t){function e(t,e){return siteinfo.site_relative+"~"+encodeURIComponent(siteinfo.uservalue)+"/raw/"+t.getAttribute("data-pa-pset")+"/"+t.getAttribute("data-pa-commit")+"/"+e}return function(n,a,s,i,r){var o,l,c,u=n[a],d=u.attrIndex("src"),h=u.attrs[d][1];if(siteinfo.uservalue&&Ot&&(o=Ot.closest(".pa-psetinfo"))){if(!/\/\//.test(h)){for(var p=Nt.closest(Ot),f=p?p.file.replace(/^(.*)\/[^\/]*$/,"$1"):"";;)if(h.startsWith("./"))h=h.substring(2).replace(/^\/+/,"");else if(h.startsWith("../")&&""!==f)h=h.substring(3).replace(/^\/+/,""),f=f.replace(/(?:^|\/)[^\/]+\/*$/,"");else{if(h.startsWith("../")||h.startsWith("/")){h=null;break}if(!(l=h.match(/(^|\/+)[^\/]+\/\.\.(?:\/+|$)(.*)$/)))break;h=l[1]+l[2]}u.attrs[d][1]=h?e(o,f?f+"/"+h:h):"data:image/jpg,"}(l=h.match(/^https:\/\/github\.com\/([^\/]+\/[^\/]+)\/(?:blob|raw)\/([^\/]+)\/(.*)$/))&&(c=(o.getAttribute("data-pa-repourl")||"").match(/^(?:https:\/\/github\.com\/|git@github\.com:)(.*?)\/?$/))&&c[1]==l[1]&&o.getAttribute("data-pa-branch")==l[2]&&(u.attrs[d][1]=e(o,l[3]))}return qt(t(n,a,s,i,r),u)}}(zt.renderer.rules.image),zt.renderer.rules.list_item_open=Rt}return zt}function Ut(t){for(var e;(e=t.firstChild)&&1!==e.nodeType;)t.removeChild(e);if(e&&e.hasAttribute("data-landmark")){for(;e.nextSibling&&1!==e.nextSibling.nodeType;)t.removeChild(e.nextSibling);if(e.nextSibling){"OL"===t.tagName&&(e.hasAttribute("value")||(e.value=t.start),t.start=e.value+1);var n=document.createElement(t.tagName);n.appendChild(t.removeChild(e)),t=n}t.setAttribute("data-landmark",e.getAttribute("data-landmark"))}return t}function Kt(t){let e=0,n=0;for(;;){const a=t.charCodeAt(n);if(0===n?60!==a:62!==a&&(a<48||a>57))return[0,t];if(0!==n&&a>=48&&a<=57)e=10*e+a-48;else if(62===a)return 1===n?[0,t]:[e,t.substring(n+1)];++n}}_.on("pa-diff-unfold",(function(t){const e=t.metaKey?$(".pa-diff-unfold"):$(this),n=Nt.by_hash(this.hash),a=u(n.element,"hidden"),s=!!t.metaKey||a;e.each((function(){Nt.by_hash(this.hash).load().then((t=>t.toggle(s)))})),t.metaKey||$.post(q("=api/diffconfig",{psetinfo:n.element,file:n.file,collapse:a?0:1}))})),_.on("pa-diff-toggle-hide-left",(function(t){const e=t.metaKey?$(".pa-diff-toggle-hide-left"):$(this),n=u(Nt.referenced(this).element,"pa-hide-left");e.each((function(){Nt.referenced(this).toggle_show_left(n)}))})),u(document.body,"want-grgraph-hash")||($(window).on("popstate",(function(t){const e=(t.originalEvent||t).state;e&&e.href&&St(e.href)})).on("hashchange",(function(){St(location.href)})),$((function(){St(location.href)}))),_.on("pa-gx",(function(t){new Dt(t.currentTarget).expand()})),$(Nt.decorate_page),Nt.define_method("markdown",(function(){const t=this.element;if(u(t,"pa-markdown")||u(t,"pa-highlight"))return;const e=u(t,"pa-hide-landmarks"),n=e?"pa-da hidden":"pa-da",a=e?"pa-db hidden":"pa-db",s=e?"pa-dr pa-dhlm":"pa-dr";let i=t.firstChild,r=[],o=1;for(;i;){let e=i.nextSibling;if(u(i,"pa-dlr"))t.removeChild(i);else if(u(i,"pa-gi")||u(i,"pa-gc")){const t=+i.firstChild.nextSibling.getAttribute("data-landmark");for(;o<t;)r.push("\n"),++o;r.push(i.lastChild.textContent),++o,d(i,"hidden")}i=e}let l,c,p=document.createElement("div");for(Ot=t,p.innerHTML=Wt().render(r.join("")),Ot=null,i=t.firstChild;l=p.firstChild;){if(1!==l.nodeType){p.removeChild(l);continue}"OL"===l.tagName||"UL"===l.tagName?l=Ut(l):"P"===l.tagName&&1===l.firstChild.nodeType&&"IMG"===l.firstChild.tagName&&l.firstChild===l.lastChild&&d(l,"image-container");const e=document.createElement("div");e.className="pa-dl pa-dlr";const r=document.createElement("div");r.className=n;const o=document.createElement("div");o.className=a;const h=l.getAttribute("data-landmark");if(h){let t=parseInt(h),n=h.indexOf("-"),a=n>=0?parseInt(h.substring(n+1)):t;for(;i&&!((u(i,"pa-gi")||u(i,"pa-gc"))&&+i.firstChild.nextSibling.getAttribute("data-landmark")>=t);)i=i.nextSibling;o.setAttribute("data-landmark",t);let s=0,r=i;for(;r;){if(u(r,"pa-gi")||u(r,"pa-gc")){if(+r.firstChild.nextSibling.getAttribute("data-landmark")>=a)break;s|=u(r,"pa-gi")?1:2}r=r.nextSibling}e.className+=2===s?" pa-gc":" pa-gi"}for(c=document.createElement("div"),c.className=s,l===p.firstChild&&p.removeChild(l),c.appendChild(l);p.firstChild&&1!==p.firstChild.nodeType;)c.appendChild(p.removeChild(p.firstChild));e.appendChild(r),e.appendChild(o),e.appendChild(c),t.insertBefore(e,i)}c&&d(c,"pa-dr-last"),d(t,"pa-markdown"),h(t,"need-markdown")})),Nt.define_method("unmarkdown",(function(){const t=this.element;let e=t.firstChild;for(;e;){var n=e.nextSibling;u(e,"pa-dlr")?t.removeChild(e):(u(e,"pa-gi")||u(e,"pa-gc"))&&h(e,"hidden"),e=n}h(t,"pa-markdown")})),Nt.define_method("highlight",(function(){const t=this.element;let e;if(!(e=t.getAttribute("data-language"))){let n=this.file;/\.(?:cc|cpp|hh|hpp|c\+\+|h\+\+|C|H)$/.test(n)?e="c++":/\.(?:c|h)$/.test(n)&&(e="c"),e&&t.setAttribute("data-language",e)}if(!e||!hljs.getLanguage(e)||u(t,"pa-markdown"))return;const n="language-"+e;let a=t.firstChild,s=null,i=null;for(;a;){const t=u(a,"pa-gi")?2:u(a,"pa-gc")?3:u(a,"pa-gd")?1:0;if(0!==t){const r=a.lastChild,o=u(r,n),l=o?r.getAttribute("data-pa-text"):r.textContent,c=Bt(e,l,2&t?s:i);if(!c)break;1&t&&(i=c.top),2&t&&(s=c.top),o||(r.setAttribute("data-pa-text",l),r.innerHTML=c.value,d(r,n))}a=a.nextSibling}d(t,"pa-highlight"),h(t,"need-highlight")})),Nt.define_method("unhighlight",(function(){const t=this.element,e=t.getAttribute("data-language"),n=e?"language-"+e:"";let a,s=t.firstChild;for(;s;)(a=s.lastChild)&&a.hasAttribute("data-pa-text")&&(!n||u(a,n))&&(a.innerText=a.getAttribute("data-pa-text"),a.removeAttribute("data-pa-text"),n&&h(a,n)),s=s.nextSibling;h(t,"pa-highlight")})),Nt.add_decorator((function(t){u(t.element,"need-markdown")?t.markdown():u(t.element,"need-highlight")&&t.highlight()})),_.on("pa-diff-toggle-markdown",(function(t){const e=t.metaKey?$(".pa-diff-toggle-markdown"):$(this),n=Nt.referenced(this),a=!u(n.element,"pa-markdown");e.each((function(){const t=Nt.referenced(this),e=u(t.element,"pa-markdown");a&&!e?t.markdown():!a&&e&&t.unmarkdown(),p(this,"btn-primary",a)})),t.metaKey||$.post(q("=api/diffconfig",{psetinfo:n.element}),{file:n.file,markdown:a?1:0})}));const Zt={};function Jt(t){if(null==t.format||""===t.format||Zt[t.format])throw new Error("bad or reused format");Zt[t.format]=t}function Gt(t){return t.replace(/((?:https?|ftp):\/\/(?:[^\s<>\"&]|&amp;)*[^\s<>\"().,:;&])([\"().,:;]*)(?=[\s<>&]|$)/g,(function(t,e,n){return'<a href="'+e+'" rel="noreferrer">'+e+"</a>"+n}))}let Yt,Vt;function Xt(t,e,n,a){if(e&&hljs.getLanguage(e))try{var s=hljs.highlight(e,t,!0).value,i=a?a.attrIndex("class"):-1,r=a?a.attrIndex("data-lineno-start"):-1;if(i>=0&&/^(.*(?: |^))need-lineno((?: |$).*)$/.test(a.attrs[i][1])){let t=r>=0?a.attrs[r][1]:"1";const e=t.match(/^(.*?)(\d*)(\D*)$/),n=e[1],i=e[2].startsWith("0")?e[2].length:0,o=e[3],l=t=>n+t.toString().padStart(i,"0")+o;t=e[2]?+e[2]:1;let c=s.split(/\n/);c.length>0&&""===c[c.length-1]&&c.pop();const u='<span class="has-lineno has-lineno-'.concat(l(t+c.length-1).length,'" data-lineno="');for(let e=0;e!==c.length;++e,++t)c[e]=u.concat(l(t),'">',c[e],"</span>");s=c.join("\n")+"\n"}return s}catch(t){}return""}function Qt(t,e,n){const a=u(t,"format-inline")||window.getComputedStyle(t).display.startsWith("inline"),s=(a&&e.render_inline||e.render).call(t,n,t);var i,r;t.className=(i=t.className,r=e.format,i?i.replace(/(?:^|\s)(?:need-format|format\d+)(?=$|\s)/g,"").concat(" format",r).trimStart():"format"+r),t.innerHTML=s,a&&!e.render_inline&&1===t.children.length&&"P"===t.firstChild.tagName&&t.firstChild.replaceWith(...t.firstChild.childNodes)}function te(t,e,n){if("f"===e){var a=Kt(n);e=a[0],n=a[1]}try{Qt(t,Zt[e]||Zt[0],n)}catch(a){Qt(t,Zt[0],n),delete Zt[e]}}function ee(){const t=this.hasAttribute("data-format")?this.getAttribute("data-format"):"f";te(this,""!==t?t:"f",this.hasAttribute("data-content")?this.getAttribute("data-content"):this.textContent)}function ne(){$(".need-format").each(ee)}Jt({format:0,render:function(t){for(var e,n=t.split(/((?:\r\n?|\n)(?:[-+*][ \t]|\d+\.)?)/),a=1;a<n.length;a+=2)n[a-1].length>49&&n[a].length<=2&&""!==(e=n[a+1].charAt(0))&&" "!==e&&"\t"!==e&&(n[a]=" ");return(t="<p>"+Gt(ct(n.join("")))+"</p>").replace(/\r\n?(?:\r\n?)+|\n\n+/g,"</p><p>")},render_inline:function(t){return Gt(ct(t))}}),Jt({format:1,render:function(t){return Yt||(Yt=window.markdownit({highlight:Xt,linkify:!0}).use(markdownit_katex).use(Lt)),Yt.render(t)}}),Jt({format:3,render:function(t){return Vt||(Vt=window.markdownit({highlight:Xt,linkify:!0,html:!0,attributes:!0}).use(markdownit_katex)),Vt.render(t)}}),Jt({format:5,render:function(t){return t}});const ae={add_format:Jt,on_page:ne};$(ne);const se={parse:Kt,unparse:function(t,e){return t||e.startsWith("<")?"<".concat(t||0,">",e):e}};function ie(t,e){if("string"==typeof e&&(e=""===e?[]:[e]),0===e.length)return[];const n=document.createElement("div");n.className=0===t||1===t||2===t?"msg msg-".concat(["info","warning","error"][t]):"msg msg-error";for(let t=0;t!==e.length;++t){const a=document.createElement("p");a.append(e[t]),n.append(a)}return n}function re(t){const e=document.createElement("ul");e.className="feedback-list";for(let n=0;n!==(t||[]).length;++n)oe(e,t[n]);return e}function oe(t,e){var n,a,s;if(null!=e.message&&""!==e.message){if("UL"!==t.tagName)throw new Error("bad append_feedback");n="",null!=e.status&&e.status>=-4&&e.status<=3&&(n=["warning-note","success","urgent-note","note","","warning","error","error"][e.status+4]),s=document.createElement("div"),-5===e.status&&t.firstChild?(a=t.lastChild,s.className="msg-inform format-inline"):(a=document.createElement("li"),t.appendChild(a),s.className=n?"is-diagnostic format-inline is-"+n:"is-diagnostic format-inline"),a.appendChild(s),te(s,"f",e.message)}if(e.context){(s=document.createElement("div")).className="msg-context";var i=e.context[0],r=c(i,e.context[1]),o=c(i,e.context[2]),l=document.createElement("span");n=e.status>1?"is-error":"is-warning",l.className=(o>r+2?"context-mark ":"context-caret-mark ")+(e.status>1?"is-error":"is-warning"),l.append(i.substring(r,o)),s.append(i.substring(0,r),l,i.substring(o)),t.lastChild.appendChild(s)}}class le{constructor(){this.iscomment=!1,this.ftext="",this.format=null}empty(){return""===this.ftext}get file(){return Nt.closest(this.element||this.source).file}get lineid(){return this.element?this.element.getAttribute("data-landmark"):new Dt(this.source).note_lineid}get linea(){return new Dt(this.element||this.source).linea}linea_within(t){return new Dt(this.element||this.source).linea_within(t)}get editable_text(){return se.parse(this.ftext)[1]}static parse(t){const e=new le;return"string"==typeof t&&""!==t&&(t=JSON.parse(t)),e.assign(t),e}assign(t){let e=[null,""];"number"==typeof t?(this.iscomment=!1,this.ftext="",this.users=null,this.version=t):Array.isArray(t)&&(this.iscomment=t[0],this.ftext=t[1],e=se.parse(t[1]),this.users=t[2]||null,this.version=t[3]&&"number"==typeof t[3]?t[3]:null),this.format=e[0];const n=this.element;if(n)if(""===this.ftext&&null==this.version)n.removeAttribute("data-pa-note");else if(""===this.ftext&&null==this.users)n.setAttribute("data-pa-note",""+this.version);else{const t=[this.iscomment,this.ftext];null==this.users&&null==this.version||t.push(this.users,this.version),n.setAttribute("data-pa-note",JSON.stringify(t))}}static at(t){const e=le.parse(t.getAttribute("data-pa-note"));return e.element=t,e}static closest(t){const e=t.closest(".pa-dl");return e?le.at(e):null}static near(t){t instanceof Dt&&(t=t.element);let e=t;for(;e;)if(1!==e.nodeType)e=e.nextSibling;else{if(u(e,"pa-gw"))return le.at(e);if(!(e===t||u(e,"pa-gn")||u(e,"pa-gx")||u(e,"hidden")))break;e=e.nextSibling}const n=new le;return n.source=t,n}force_element(){if(!this.element){const t=new Dt(this.source),e=t.note_lineid,n=t.upper_bound(e);this.element=document.createElement("div"),this.element.className="pa-dl pa-gw",this.element.setAttribute("data-landmark",e),(this.version||""!==this.ftext)&&this.element.setAttribute("data-pa-note",JSON.stringify([this.iscomment,this.ftext,this.users,this.version]));let a=document.createElement("div");a.className="pa-notebox",this.element.appendChild(a),this.source.parentElement.insertBefore(this.element,n?n.element:null)}return this.element}cancel_edit(){return this.element&&u(this.element,"editing")&&$(this.element).find("textarea").val(this.editable_text),this}render(t){if(this.force_element(),u(this.element,"editing")){const t=$(this.element).find("textarea");if(t.length&&!l(this.editable_text,t.val().replace(/\s+$/,"")))return!1;h(this.element,"editing"),$(this.element).find(":focus").blur()}const e=$(this.element).find(".pa-notebox"),n=e.children();if(t?n.slideUp(80).queue((function(){n.remove()})):n.remove(),""===this.ftext)return ue(this.element),t?$(this.element).children().slideUp(80):d(this.element,"hidden"),!0;const a=document.createElement("div");if(a.className="pa-notecontent clearfix",this.users){const t=$.isArray(this.users)?this.users:[this.users],e=[];for(let n in t){const a=siteinfo.pc?siteinfo.pc[t[n]]:null;a&&(a.nick?e.push(a.nick):a.nicklen||a.lastpos?e.push(a.name.substr(0,a.nicklen||a.lastpos-1)):e.push(a.name))}if(e.length){const t=document.createElement("div");t.className="pa-note-author",t.append("["+e.join(", ")+"]"),a.append(t)}}if(!this.iscomment){const t=document.createElement("div");t.className="pa-gradenote-marker",a.append(t)}const s=document.createElement("div");return s.className="pa-dr pa-note pa-".concat(this.iscomment?"comment":"grade","note"),a.append(s),e.append(a),te(s,"f",this.ftext),ue(this.element),t?$(a).hide().slideDown(80):(e.show(),h(this.element,"hidden")),!0}save_ftext(t,e){if(this.element){if(u(this.element,"pa-outstanding"))return Promise.reject(new Error("Outstanding request"));d(this.element,"pa-outstanding")}const n=this.element&&u(this.element,"editing"),a=this,s=this.element||this.source,i=s.closest(".pa-filediff").closest(".pa-psetinfo"),r=s.closest(".pa-grade-range-block"),o={ftext:t},l=this.linea_within(1e3);return e&&(o.iscomment=1),l&&(o.linea=l),r&&r.setAttribute("data-pa-notes-outstanding",+r.getAttribute("data-pa-notes-outstanding")+1),new Promise((function(t,e){et(q("=api/linenote",{psetinfo:i,file:a.file,line:a.lineid,oldversion:a.version||0}),o).then((function(s){if(a.element&&h(a.element,"pa-outstanding"),s&&s.ok){a.force_element(),h(a.element,"pa-save-failed");const e=s.linenotes[a.file];a.assign(e&&e[a.lineid]),a.render(n),t(a)}else a.element&&d(a.element,"pa-save-failed"),n&&$(a.element).find(".pa-save-message").html('<strong class="err">'+ct(s.error||"Failed")+"</strong>"),e(new Error(s.error||"Save failed"));r&&function(t){var e=+t.getAttribute("data-pa-notes-outstanding")-1;e?t.setAttribute("data-pa-notes-outstanding",e):(t.removeAttribute("data-pa-notes-outstanding"),$(t).find(".pa-grade").each((function(){$pa.gradeentry_closest(this).save_landmark_grade(t)})))}(r)}))}))}save_text(t,e){let n=this.format;return null==n&&(n=+document.body.getAttribute("data-default-format"),isNaN(n)&&(n=0)),this.save_ftext(se.unparse(n,t),e)}}function ce(t,e){let n,a=$(t).find(".pa-note-links a");a.length||(a=$("<a></a>"),$('<div class="pa-note-links"></div>').append(a).prependTo($(t).find(".pa-notecontent"))),e?(a.attr("href",new Dt(e).hash),n="NEXT >"):(a.attr("href",""),n="TOP"),a.text()!==n&&a.text(n)}function ue(t){const e=$(".pa-gw");let n=0;for(;n<e.length&&e[n]!==t;)++n;if(n<e.length){let a=n-1;for(;a>=0&&le.at(e[a]).empty();)--a;let s=n+1;for(;s<e.length&&le.at(e[s]).empty();)++s;a>=0&&ce(e[a],le.at(t).empty()?e[s]:t),ce(t,e[s])}}let de={};const he={red:"cR",orange:"cO",yellow:"cY",green:"cG",blue:"cB",purple:"cP",gray:"cA",grey:"cA"},pe={basic_text:t=>null==t?"":""+t,basic_mount_edit:function(t,e,n){let a=document.createElement("span");a.className="pa-gradedesc",n&&n.max_text?a.append(n.max_text):this.max&&a.append("of "+this.max);const s=new DocumentFragment;let i;return window.$pa.long_page?(i=document.createElement("textarea"),i.className="ta1 uich pa-gradevalue pa-gradewidth",i.setAttribute("rows",1),i.setAttribute("cols",1e4),i.setAttribute("wrap","none")):(i=document.createElement("input"),i.type="text",i.className="uich pa-gradevalue pa-gradewidth"),i.name=this.key,i.id=e,i.disabled=this.disabled,s.append(i," ",a),s},basic_mount_show:function(t,e){t.id=e;const n=[document.createElement("span")];n[0].className="pa-gradevalue pa-gradewidth",this.max&&"letter"!==this.type&&(n.push(" ",document.createElement("span")),n[2].className="pa-gradedesc",n[2].append("of "+this.max)),t.replaceChildren(...n)},basic_unmount:function(t){t.remove()},basic_update_edit:function(t,e,n){const a=t.querySelector(".pa-gradevalue"),s=this.simple_text(e);k(a,s),a.value=s,null!=n.mixed&&(n.mixed?a.setAttribute("placeholder","Mixed"):a.removeAttribute("placeholder"))},basic_configure_column:function(t){t.ge=this,t.gabbr=this.abbr(),t.justify=this.gc.justify||"right",t.sort_forward="forward"===this.gc.sort;const e=this.gc.justify||"right";return t.gkey===t.ptconf.total_key?t.className=this.readonly?"gt-total":"gt-total gt-grade":t.className=this.readonly?"gt-rograde":"gt-grade",t.className+="left"===e?" l":" r",this.table_color&&he[this.table_color]&&(t.className+=" "+he[this.table_color]),t.make_compare=e=>this.gc.make_compare.call(this,t,e),t},basic_make_compare:function(t){const e=t.gidx,n="forward"===this.gc.sort?1:-1;return function(t,a){const s=t.grades&&t.grades[e],i=a.grades&&a.grades[e];if(""===s||null==s||""===i||null==i){if(""!==s&&null!=s)return-n;if(""!==i&&null!=i)return n}else{if(s<i)return-1;if(s>i)return 1}return n*t._sort_user.localeCompare(a._sort_user)}},basic_tcell_width:function(){return 3},add:(t,e)=>{e.type=t,e.type_tabular=null==e.type_tabular||e.type_tabular,e.text=e.text||pe.basic_text,e.simple_text=e.simple_text||e.text,e.configure_column=e.configure_column||pe.basic_configure_column,e.tcell_width=e.tcell_width||pe.basic_tcell_width,e.tcell=e.tcell||e.text,e.make_compare=e.make_compare||pe.basic_make_compare,e.mount_show=e.mount_show||pe.basic_mount_show,e.mount_edit=e.mount_edit||pe.basic_mount_edit,e.update_edit=e.update_edit||pe.basic_update_edit,e.unmount=e.unmount||pe.basic_unmount,de[t]=e},find:t=>de[t]||de.numeric};pe.add("numeric",{mount_edit:pe.basic_mount_edit}),pe.add("formula",{text:function(t){if(null==t||!1===t)return"";if(!0===t)return"✓";{const e=t.toFixed(1);return e.endsWith(".0")?e.substring(0,e.length-2):e}}}),pe.add("time",{text:function(t){return null==t||0===t?"":i("%Y-%m-%d %H:%M",t)},tcell_width:6}),pe.add("duration",{text:function(t){return null==t?"":r(t,"quarterhour")},tcell_width:6}),pe.add("text",{mount_show:function(t,e){t.id=e,d(t,"pa-textv"),d(t,"pa-gradevalue")},mount_edit:function(t,e){d(t,"pa-textv");const n=document.createElement("textarea");return n.className="uich pa-gradevalue need-autogrow",n.name=this.key,n.id=e,n.disabled=this.disabled,n},justify:"left",sort:"forward",type_tabular:!1}),pe.add("shorttext",{mount_show:function(t,e){t.id=e,d(t,"pa-gradevalue")},mount_edit:function(t,e){const n=document.createElement("textarea");return n.className="uich pa-gradevalue need-autogrow",n.setAttribute("rows",1),n.name=this.key,n.id=e,n.disabled=this.disabled,n},justify:"left",sort:"forward",type_tabular:!1}),pe.add("section",{text:()=>"",mount_show:function(t,e){t.id=e,d(t.closest(".pa-p"),"pa-p-section")},mount_edit:function(t){d(t.closest(".pa-p"),"pa-p-section")},update_show:function(){return!1},update_edit:function(){return!1},type_tabular:!1}),_.on("keydown.pa-sidebar-tab",(function(t){if("Tab"===F(t)&&!t.ctrlKey&&!t.altKey&&!t.metaKey){const e=function(t,e){let n,a,s=t.closest(".pa-sidebar"),i=s.querySelectorAll(".pa-sidebar-tab"),r=Array.prototype.indexOf.call(i,t);if(r<0)return null;for(;;)if(r+=e?-1:1,r<0||r>=i.length){if(null==n&&(n=document.querySelectorAll(".pa-sidebar"),a=Array.prototype.indexOf.call(n,s),a<0))return null;if(a+=e?-1:1,!(a>=0&&a<n.length))return null;s=n[a],i=s.querySelectorAll(".pa-sidebar-tab"),r=e?i.length:-1}else if(i[r].offsetParent)return i[r]}(this,t.shiftKey);e&&(e.focus(),e.setSelectionRange&&e.setSelectionRange(0,e.value.length),t.preventDefault())}}));let fe,me=0;const ge={pset:!0,uid:!0,user:!0,anon_user:!0,email:!0,first:!0,last:!0,year:!0,x:!0,dropped:!0,imageid:!0,commit:!0,base_commit:!0,base_handout:!0,grade_commit:!0,emptydiff:!0,late_hours:!0,auto_late_hours:!0,student_timestamp:!0,grades_latest:!0,version:!0,history:!0,total_type:!0,total:!0,total_noextra:!0,answer_version:!0,scores_editable:!0,answers_editable:!0,linenotes:!0,gradercid:!0,has_notes:!0,has_nongrader_notes:!0,repo:!0,repo_broken:!0,repo_unconfirmed:!0,repo_too_open:!0,repo_handout_old:!0,repo_partner_error:!0,repo_sharing:!0,flagid:!0,conversation:!0,conversation_pfx:!0,at:!0};function be(){if(h(this,"pa-resetgrade"),this.removeEventListener(this,be,!1),!C(this)){const t=ye.closest(this),e=this.closest(".pa-grade");queueMicrotask((function(){t.update_at(e)}))}}function _e(t){const e=document.createElement("span");return document.body.appendChild(e),te(e,"f",t),e.remove(),e}class ve{constructor(t){Object.assign(this,t),this.type=this.type||"numeric",this.gc=pe.find(this.type),this.disabled=!!this.disabled,this.normal=!0,this._abbr=null,this._all=null}get type_tabular(){return this.gc.type_tabular}student_visible(t){return!0===this.visible||null==this.visible&&(this.answer||t.scores_visible)}get title_html(){let t,e=this.title;return e?"<"===e.charAt(0)&&(t=e.charAt(1))>="0"&&t<="9"?_e(e).innerHTML:ct(e):this.key}get title_text(){let t,e=this.title;return e?"<"===e.charAt(0)&&(t=e.charAt(1))>="0"&&t<="9"?_e(e).textContext:e:this.key}abbr(){return this._abbr||this.compute_abbr(),this._abbr}compute_abbr(){const t=this._all?this._all.order:[this.key],e=this._all?this._all.value_order:[this.key],n=this._all?this._all.entries:{[this.key]:this};let a={};for(let e=0;e!==t.length;++e)n[t[e]]._abbr=":"+e;for(let t=0;t!==e.length;++t){const s=n[e[t]],i=s.title_text;let r=i.match(/^(p)(?:art[\s\d]|(?=\d))([-.a-z\d]+)(?:[\s:]+|$)/i)||i.match(/^(q)(?:uestion[\s\d]|(?=\d))([-.a-z\d]+)(?:[\s:]+|$)/i)||i.match(/^[\s:]*()(\S{1,3}[\d.]*)[^\s\d]*[\s:]*/);if(r){let e,n=r[1]+r[2],o=i.substring(r[0].length);for(;e=a[n];){if(!0!==e&&(r=e[1].match(/^(\S{1,3}[\d.]*)\S*[\s:]*(.*)$/))&&(e[0]._abbr+=r[1],a[e[0]._abbr]=[e[0],r[2]],a[n]=e=!0),!(r=o.match(/^(\S{1,3}[\d.]*)[^\s\d]*[\s:]*(.*)$/))){!0!==e&&(n+=":"+t);break}n+=r[1],o=r[2]}s._abbr=n,a[n]=[s,o]}}}render(t,e){null==e&&(e=!this.readonly&&(this.answer?t.answers_editable:t.scores_editable)?2:0);const n="pe-ge"+ ++me,a=document.createElement("div"),s=document.createElement("label"),i=document.createElement(2===e?"form":"div"),r=this.student_visible(t)?"":" pa-p-hidden";if(a.className="pa-grade pa-p".concat(e?" e":"",this.answer?" pa-ans":"",r),a.setAttribute("data-pa-grade",this.key),s.className="pa-pt",s.htmlFor=n,s.innerHTML=this.title_html,a.appendChild(s),this.description){const t=document.createElement("div");t.className="pa-pdesc pa-dr",te(t,"f",this.description),a.appendChild(t)}return i.className=2===e?"ui-submit pa-pv":"pa-pv",a.appendChild(i),this.mount_at(i,n,e),a}mount_at(t,e,n){let a;a=n?this.gc.mount_edit.call(this,t,e):this.gc.mount_show.call(this,t,e),"string"==typeof a?t.innerHTML=a:a instanceof Node&&t.replaceChildren(a),n&&$(t).find(".need-autogrow").autogrow()}update_edit(t,e,n){const a=$(t),s=t.querySelector(".pa-gradevalue"),i=this.simple_text(e);if(!u(t,"pa-saving"))if(s&&"hidden"!==s.type&&s.matches(":focus"))u(s,"pa-resetgrade")||i===w(s)||(d(s,"pa-resetgrade"),s.addEventListener("blur",be,!1));else{if(this.max){const n=t.nextSibling&&t.nextSibling.classList.contains("pa-gradeabovemax");if(!e||e<=this.max)n&&t.parentElement.removeChild(t.nextSibling);else if(!n){const e=document.createElement("div");e.classList="pa-pvnote pa-gradeabovemax",e.textContent="Grade is above max",t.parentElement.insertBefore(e,t.nextSibling)}}if(null==n.autograde||e===n.autograde)a.find(".pa-gradediffers").remove();else{const t=("late_hours"===this.key?"auto-late hours":"autograde")+" is "+this.text(n.autograde);a.find(".pa-gradediffers").length||a.append('<span class="pa-gradediffers"></span>');const e=a.find(".pa-gradediffers");e.text()!==t&&e.text(t)}!n.reset&&s&&w(s)===i||this.gc.update_edit.call(this,t,e,n),s&&n.reset&&k(s,i),s&&n.sidebar&&(s.tabIndex=-1,s.classList.add("uikd","pa-sidebar-tab")),this.landmark&&this.update_landmark(t),$(t).find("input, textarea").autogrow()}}update_show(t,e,n){const a=t.classList.contains("pa-gradevalue")?t:t.querySelector(".pa-gradevalue");let s;if(this.gc.update_show)s=this.gc.update_show.call(this,a,e,n);else{let t=this.text(e);s=""===t&&(!this.max||this.required)&&!this.answer,s||(""===t&&(t="—"),a.textContent!==t&&(a.textContent=t))}if(null!=s){const e=t.closest(".pa-grade");p(e,this.description?"pa-hidden-description":"hidden",s)}this.landmark&&this.update_landmark(t)}update_at(t,e,n){let a=t.firstChild;for(;!u(a,"pa-pv");)a=a.nextSibling;u(t,"e")?this.update_edit(a,e,n):this.update_show(a,e,n)}update_landmark(t){let e=t.closest(".pa-gradelist");if(e&&u(e,"want-landmark-links")){let e="";const n=/^(.*):(\d+)$/.exec(this.landmark);if(n&&Nt.by_file(n[1])){const a=t.closest(".pa-psetinfo").getAttribute("data-pa-directory")||"",s=n[1].startsWith(a)?n[1].substring(a.length):n[1];e='@<a href="#La'.concat(n[2],"F",ut(n[1]),'">',ct(s),":",n[2],"</a>")}const a=$(t).find(".pa-gradeboxref");""===e?a.remove():a.length&&a.html()===e||(a.remove(),$(t).append('<span class="pa-gradeboxref">'+e+"</span>"))}}unmount_at(t){this.gc.unmount.call(this,t)}text(t){return this.gc.text.call(this,t)}simple_text(t){return this.gc.simple_text.call(this,t)}configure_column(t){return this.gc.configure_column.call(this,t)}tcell_width(){const t=this.gc.tcell_width||3;return"function"==typeof t?t.call(this):t}tcell(t){return this.gc.tcell.call(this,t)}landmark_lines(t,e){const n=this.landmark_range?/:(\d+):(\d+)$/.exec(this.landmark_range):null;if(!n)throw new Error("bad landmark_lines");const a=+n[1];let s,i=t instanceof Dt?t.element:t;for(;!u(i,"pa-filediff")&&(!(s=i.getAttribute("data-pa-landmark"))||"a"!==s.charAt(0)||parseInt(s.substring(1))>a);)i=i.parentElement;return Dt.range(i,+n[1],+n[2],e)}landmark_grade(t){let e=null;for(let n of this.landmark_lines(t,".pa-gw")){const t=le.at(n.element);let a,s;t.text&&((a=/^[\s❮→]*(\+)(\d+(?:\.\d+)?|\.\d+)((?![.,]\w|[\w%$*])\S*?)[.,;:❯]?(?:\s|$)/.exec(t.text))||(a=/^[\s❮→]*()(\d+(?:\.\d+)?|\.\d+)(\/[\d.]+(?![.,]\w|[\w%$*\/])\S*?)[.,;:❯]?(?:\s|$)/.exec(t.text)))&&(null===e&&(e=0),e+=parseFloat(a[2]),s=ct(this.title_text).concat(": ",ct(a[1]),"<b>",ct(a[2]),"</b>",ct(a[3])));let i=$(n.element).find(".pa-note-gradecontrib");!i.length&&s&&(i=$('<div class="pa-note-gradecontrib"></div>').insertBefore($(n.element).find(".pa-note"))),s?i.html(s):i.remove()}this.round&&null!=e&&(e="up"===this.round?Math.ceil(e):"down"===this.round?Math.floor(e):Math.round(e));const n=t.closest(".pa-grade")||t.closest(".pa-grade-range-block");let a=$(n).find(".pa-notes-grade");if(null===e)a.remove();else{if(!a.length){(u(n,"pa-grade")?$(n):$(n).find(".pa-grade")).each((function(){let t=this.firstChild;for(;t&&!u(t,"pa-pv");)t=t.nextSibling;for(t=t.firstChild;t&&(1!==t.nodeType||u(t,"pa-gradewidth")||u(t,"pa-gradedesc"));)t=t.nextSibling;this.lastChild.insertBefore($('<a class="uic uikd pa-notes-grade" href=""></a>')[0],t)})),a=$(n).find(".pa-notes-grade")}a.text("Notes grade "+e)}return e}save_landmark_grade(t){const e=this.landmark_grade(t),n=$(t).find(".pa-gradevalue")[0];if(n){const t=null===e?"":""+e,a=$(n).val();a==n.getAttribute("data-pa-notes-grade")&&t!=a&&$(n).val(t).change(),n.setAttribute("data-pa-notes-grade",t)}return e}value_order_in(t){const e=t.vpos[this.key];return null!=e?e:null}value_in(t){const e=t.grades?t.vpos[this.key]:null;return null!=e?t.grades[e]:null}autovalue_in(t){const e=t.autogrades?t.vpos[this.key]:null;return null!=e?t.autogrades[e]:null}has_later_value_in(t){return this.answer&&t.grades_latest&&this.key in t.grades_latest&&this.value_in(t)!==t.grades_latest[this.key]}static closest(t){const e=t.closest(".pa-grade");return ye.closest(e).entries[e.getAttribute("data-pa-grade")]}static late_hours(){return fe=fe||new xe,fe}}class xe extends ve{constructor(){super({key:"late_hours",title:"late hours"}),this.normal=!1}value_in(t){return t.late_hours}autovalue_in(t){return t.auto_late_hours}}class ye{constructor(t){this.entries={},this.parent=null,this.root=this,t&&this.assign(t)}make_child(){const t=new ye;return Object.assign(t,this),t.parent=t.root=this,t}set_entry(t){if(this.entries!==this.root.entries)throw new Error("!");this.entries[t.key]=t,t._all=this.root}assign(t){const e=this.value_order;if(t.entries)for(let e in t.entries)this.set_entry(new ve(t.entries[e]));if(t.order&&(this.order=t.order),t.fixed_value_order&&!this.parent&&(this.fixed_value_order=t.fixed_value_order),this.value_order=this.fixed_value_order||this.order,this.value_order!==e){this.vpos={};for(let t=0;t!==this.value_order.length;++t)this.vpos[this.value_order[t]]=t;e&&(this.grades=this.autogrades=this.maxtotal=null)}t.grades&&(this.grades=this.merge_grades(this.grades,t.grades,t)),t.autogrades&&(this.autogrades=this.merge_grades(this.autogrades,t.autogrades,t)),"scores_visible"in t&&(this.parent?(this.scores_visible_pinned=null!=t.scores_visible)?this.scores_visible=t.scores_visible:this.scores_visible=this.parent.scores_visible:this.scores_visible=t.scores_visible);for(let e in t)ge[e]&&(this[e]=t[e]);return this}merge_grades(t,e,n){let a=n.fixed_value_order||n.order||this.value_order;if(t||a!==this.value_order){t=t||[];for(let n in a){const s=this.vpos[a[n]];if(null!=s){for(;t.length<=s;)t.push(null);t[s]=e[n]}}return t}return e}xentry(t){const e=this.entries[t];return e||("late_hours"===t?ve.late_hours():null)}*value_entries(){for(const t of this.value_order)yield this.entries[t]}remount_at(t,e){const n=this.xentry(t.getAttribute("data-pa-grade"));if(n){let a,s=t.firstChild;for(;!u(s,"pa-pv");)"LABEL"===s.tagName&&(a=s.htmlFor),s=s.nextSibling;for(;s.nextSibling;)t.removeChild(s.nextSibling);"boolean"==typeof e&&(e=e?2:0);const i=document.createElement(2===e?"form":"div");i.className=2===e?"ui-submit pa-pv":"pa-pv",p(t,"e",0!==e),t.replaceChild(i,s),2===e&&h(t,"hidden"),n.mount_at(i,a,0!==e),$(s).find("input, textarea").unautogrow()}}update_at(t,e){const n=this.xentry(t.getAttribute("data-pa-grade"));let a=n.value_in(this);if(n.has_later_value_in(this)){const e=t.firstChild;e.classList.contains("pa-grade-latest")?a=this.grades_latest[n.key]:e.classList.contains("uic")||(e.classList.add("pa-grade-earlier","uic","need-tooltip"),e.setAttribute("aria-label","Toggle latest version"))}const s={gradesheet:this,autograde:n.autovalue_in(this)};e&&Object.assign(s,e),n.update_at(t,a,s)}grade_total(t){let e=null;for(let n=0;n!==this.value_order.length;++n){const a=this.entries[this.value_order[n]];if(a&&a.in_total&&(!t||!a.is_extra)){const t=this.grades&&this.grades[n];null!=t&&(e=(e||0)+t)}}return null!==e?Math.round(1e3*e)/1e3:e}get grade_maxtotal(){if(null==this.maxtotal){let t=0;for(let e=0;e!==this.value_order.length;++e){const n=this.entries[this.value_order[e]];n&&n.in_total&&!n.is_extra&&n.max&&(!n.required||this.scores_editable||this.grades&&null!==this.grades[e])&&(t+=n.max)}this.maxtotal=Math.round(1e3*t)/1e3}return this.maxtotal}file_anchor(t){return u(document.body,"pa-multiuser")?"U".concat(ut(this.user),"/F",ut(t)):"F"+ut(t)}get has_sections(){for(let t=0;t!==this.order.length;++t){if("section"===this.entries[this.order[t]].type)return!0}return!1}has(t){for(let e=0;e!==this.value_order.length;++e){if(t(this.entries[this.value_order[e]],this))return!0}return!1}section_has(t,e){let n=this.vpos[t.key];for(;null!=n&&n<this.value_order.length;){const a=this.entries[this.value_order[n]];if(a!==t&&"section"===a.type)break;if(e(a,this))return!0;++n}return!1}section_wants_sidebar(t){let e=0;return this.scores_editable&&this.section_has(t,(t=>(e|=t.answer?1:2,3===e)))}static store(t,e){if(!u(t,"pa-psetinfo"))throw new Error("bad GradeSheet.store");ye.closest(t).assign(e),window.$pa.loadgrades.call(t)}static closest(t){if(!(t=t.closest(".pa-psetinfo")))return null;if(t.pa__gradesheet)return t.pa__gradesheet;let e;if(u(t,"pa-psetinfo-partial")&&(e=ye.closest(t.parentElement))&&(e=e.make_child()),e=e||new ye,t.hasAttribute("data-pa-gradeinfo"))try{let n=JSON.parse(t.getAttribute("data-pa-gradeinfo")||"{}");e.assign(n)}catch(t){}return Object.defineProperty(t,"pa__gradesheet",{value:e,configurable:!0,writable:!0}),e}}let we,ke,Ce,Ae,Ee;function $e(t,e,n){t.removeClass("hidden").addClass("editing");var a=t.find(".pa-notebox");if(n){t.css("display","").children().css("display","");var s=a.children();s.slideUp(80).queue((function(){s.remove()}))}let i=ye.closest(we.element),r=e?e.format:null;null==r&&(r=document.body.getAttribute("data-default-format"));let o='<form method="post" action="'.concat(ct(q("=api/linenote",{psetinfo:i.element,file:we.file,line:we.note_lineid,oldversion:e&&e.version||0,format:r})),'" enctype="multipart/form-data" accept-charset="UTF-8" class="ui-submit pa-noteform">','<textarea class="pa-note-entry need-autogrow" name="note"></textarea>','<div class="aab aabr pa-note-aa justify-content-between">','<div class="aabutr order-100"><button class="btn-primary" type="submit">Save comment</button></div>','<div class="aabutr order-99"><button type="button" name="cancel">Cancel</button></div>','<div class="aabut"><button type="button" class="btn ui pa-load-note-suggestions">↡</button></div>');i.scores_visible||(o+='<div class="aabut"><label class="checki"><input type="checkbox" name="iscomment" value="1" class="checkc">Show immediately</label></div>'),o+='<div class="aabut flex-grow-1"></div>';var l=$(o+"</div></form>").appendTo(a),c=l.find("textarea");if(e&&null!==e.ftext){const t=e.editable_text;c.text(t),c[0].setSelectionRange&&c[0].setSelectionRange(t.length,t.length)}c.autogrow().keydown(je),l.find("input[name=iscomment]").prop("checked",!(!e||!e.iscomment)),l.find("button[name=cancel]").click(Te),l.on("submit",(function(){!function(t){if(!u(t,"pa-gw"))throw new Error("bad `elt` in pa_save_my_note");if(!u(t,"pa-outstanding")){const e=$(t).find("form")[0],n=e.elements.note.value,a=e.elements.iscomment&&e.elements.iscomment.checked;$(e).find(".pa-save-message").remove(),$(e).find(".aab").append('<div class="aabut pa-save-message">Saving…</div>'),le.at(t).save_text(n,a).then((()=>{const t=we?we.visible_source():null;t&&Se(t.element,!0)}))}}(this.closest(".pa-dl"))})),n&&(c.focus(),l.hide().slideDown(100))}function Ne(t){t&&null!=t.screenX&&(Ee=t.timeStamp,Ce=t.screenX,Ae=t.screenY)}function De(t){let e,n;if("mousemove"===t.type&&Ee&&(Math.abs(t.screenX-Ce)<=1&&Math.abs(t.screenY-Ae)<=1||t.timeStamp-Ee<=500)||("keydown"===t.type||"keyup"===t.type)&&F.is_modifier(t))return;if("keydown"!==t.type||"ArrowUp"!==(e=F(t))&&"ArrowDown"!==e&&"Enter"!==e||(n=M(t))&&(n!==M.META||"Enter"!==e)||!we)return Fe();let a=we.visible_source();if(a&&("ArrowDown"===e||"ArrowUp"===e)){h(a.element,"live");let t=a;const n=Dt.ANYFILE+("ArrowDown"===e?0:Dt.BACKWARD);a=null;for(let e of Dt.all(t,n))if(e.element!==t.element&&e.is_visible()&&e.is_source()){a=e;break}}if(a){if(we=a,t.preventDefault(),Ne(t),"Enter"===e)ze();else{const t=a.element.closest(".pa-with-fixed");$(a.element).addClass("live").scrollIntoView(t?{marginTop:t.firstChild.offsetHeight}:null)}return!0}return Fe()}function Se(t,e){u(t,"pa-gw")||d(t,"live"),$(".pa-filediff").removeClass("live"),$(document).off(".pa-linenote"),$(document).on((e?"keydown.pa-linenote ":"")+"mousemove.pa-linenote mousedown.pa-linenote",De)}function Fe(){$(".pa-dl.live").removeClass("live"),$(".pa-filediff").addClass("live"),$(document).off(".pa-linenote")}function Me(t){const e=t.render(!0),n=we&&we.visible_source();return n&&Se(n.element,!0),e}function Te(){return Me(le.closest(this).cancel_edit()),!0}function je(t){return!("Escape"===F(t)&&!M(t)&&Me(le.closest(this)))&&("Enter"!==F(t)||M(t)!==M.META||($(this).closest("form").submit(),!1))}function Le(t,e){return t*t+e*e<144}function ze(t){const e=le.near(we),n=e.force_element();if(Ne(t),u(n,"editing")){if(Me(e))return t&&t.stopPropagation(),!0;var a=$(n).find("textarea").focus();return a[0].setSelectionRange&&a[0].setSelectionRange(0,a.val().length),!1}return $e($(n),e,!0),Se(we.element,!1),!1}function Oe(t){const e=siteinfo.user.cid;return t.like&&t.like.indexOf(e)>=0?1:t.dislike&&t.dislike.indexOf(e)>=0?-1:0}function Be(t,e){let n=$(t).data("paNoteSuggestionIndex")||0;!function(t,e){let n=$(t).find(".pa-note-suggestions");if(!n.length){const e=document.createElement("div"),a=document.createElement("input");e.className="pa-note-suggestions mt-4",a.type="search",a.className="uikd uii pa-search-suggestions mb-3",a.placeholder="Search…",e.append(a),$(e).insertBefore($(t).find(".pa-note-aa")),n=$(e)}for(const t of e){const e=Oe(t),a=document.createElement("div"),s=(t.like||[]).length-(t.dislike||[]).length;a.className="pa-note-suggestion".concat(e<0||0===e&&s<0?" dim":""),a.setAttribute("data-content",t.ftext),n[0].appendChild(a);const i=document.createElement("div"),r=document.createElement("button"),o=document.createElement("button"),l=document.createElement("div");i.className="btnbox small",i.append(r,o),l.className="flex-grow-1",a.append(i,l),r.type=o.type="button",r.className="ui pa-use-suggestion like".concat(e>0?" taken":""),r.setAttribute("aria-label","Use"),r.textContent="✔️",o.className="ui pa-use-suggestion dislike".concat(e<0?" taken":""),o.setAttribute("aria-label","Downrank"),o.textContent="➖",te(l,"f",t.ftext),Et.call(r),Et.call(o)}}(t,e.slice(n,e.length)),$(t).data("paNoteSuggestionIndex",e.length).find(".pa-load-note-suggestions").prop("disabled",!0)}function Ie(t,e){const n=Dt.closest(t);$.ajax(q("=api/linenotemark",{file:n.file,linea:n.linea,mark:e,pset:n.pset}),{data:{ftext:t.getAttribute("data-content")},method:"POST"})}_.on("pa-editablenotes",(function(t){var e=t.target.closest(".pa-dl");if(0===t.button&&e&&!u(e,"pa-gx")&&!t.target.matches("button, a, textarea, input, label")&&!t.target.closest(".pa-note-suggestions")){var n=function(t){for(;t&&"TEXTAREA"!==t.tagName&&"A"!==t.tagName;){if(u(t,"pa-dl")){for(let e of Dt.all(t)){if(e.is_note())return e;if(e.element!==t&&e.is_visible()&&!e.is_annotation())break}return new Dt(t)}t=t.parentElement}return null}(t.target),a=(new Date).getTime();"mousedown"===t.type&&n?we&&we.element===n.element&&ke&&Le(ke[0]-t.clientX,ke[1]-t.clientY)&&a-ke[2]<=500||(we=n,ke=[t.clientX,t.clientY,a,!1]):"mouseup"===t.type&&n?we&&we.element===n.element&&ke&&Le(ke[0]-t.clientX,ke[1]-t.clientY)&&!ke[3]&&(we=n,ke[3]=!0,ze(t)):"click"===t.type&&n?(we=n,ze(t)):we=ke=null}})),_.on("pa-load-note-suggestions",(function(){const t=this.closest("form");let e=$(t).data("paNoteSuggestions");if(e)Be(t,e);else{const n=Dt.closest(this),a={file:n.file,pset:n.pset},s=ye.closest(this);if(s&&s.base_commit&&!s.base_handout){if(s.user&&s.commit){let t=n.lineb;null!==t&&(a.u=s.user,a.line="b"+t,a.commit=s.commit)}}else a.linea=n.linea;this.disabled=!0,$.ajax(q("api/linenotesuggest",a),{success:function(n){if(n.ok){e=n.notelist||[];for(const t of e){const e=Oe(t),n=(t.like||[]).length-(t.dislike||[]).length;t.status=e>0&&n>1?3:e>0?2:0===e&&n>0?1:0===e&&0===n?0:-1===e&&n>=0?-1:-2}e.sort((n.linea,function(t,e){if(t.status!==e.status)return t.status>e.status?-1:1;if(t.ftext.substring(0,3)===e.ftext.substring(0,3))return t.ftext.localeCompare(e.ftext);{const n=se.parse(t.ftext),a=se.parse(e.ftext);return n.localeString(a)}})),$(t).data("paNoteSuggestions",e),Be(t,e)}}})}})),_.on("pa-use-suggestion",(function(){const t=this.closest(".pa-note-suggestion"),e=t.closest("form");this.classList.contains("like")?(Ie(t,"like"),e.elements.note.value=se.parse(t.getAttribute("data-content"))[1]):(Ie(t,"dislike"),t.remove())})),_.on("pa-search-suggestions",(function(t){if("input"===t.type){const t=this.closest(".pa-note-suggestions");let e="";for(const t of this.value.split(/\s+/))""!==t&&(e=e.concat("(?=.*",String(t).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),")"));const n=e?new RegExp(e,"i"):null;for(let e=t.firstChild;e;e=e.nextSibling)if(e.classList.contains("pa-note-suggestion")){const t=n&&!n.test(e.getAttribute("data-content"));e.classList.toggle("hidden",t)}}else"keydown"!==t.type||M(t)&(M.SHIFT|M.ALT)||"Enter"!==F(t)||t.preventDefault()}));const Pe={0:!1,1:{b:!0},2:{f:!0},3:{i:!0},4:{u:!0},5:{bl:!0},7:{rv:!0},8:{x:!0},9:{s:!0},21:{du:!0},22:{b:!1,f:!1},23:{i:!1},24:{u:!1},25:{bl:!1},27:{rv:!1},28:{x:!1},29:{s:!1},30:{fg:0},31:{fg:1},32:{fg:2},33:{fg:3},34:{fg:4},35:{fg:5},36:{fg:6},37:{fg:7},38:"fg",39:{fg:!1},40:{bg:0},41:{bg:1},42:{bg:2},43:{bg:3},44:{bg:4},45:{bg:5},46:{bg:6},47:{bg:7},48:"bg",49:{bg:!1},90:{fg:8},91:{fg:9},92:{fg:10},93:{fg:11},94:{fg:12},95:{fg:13},96:{fg:14},97:{fg:15},100:{bg:8},101:{bg:9},102:{bg:10},103:{bg:11},104:{bg:12},105:{bg:13},106:{bg:14},107:{bg:15}},Re={b:1,f:2,i:3,u:4,bl:5,rv:7,x:8,s:9,du:21};function qe(t,e){if(1===arguments.length&&(e=t,t=null),!e||"[m"===e||"[0m"===e)return null;let n;n=""===e.charAt(0)?e.substring(2,e.length-1).split(";"):e.split(";");for(let e=0;e<n.length;++e){const a=Pe[parseInt(n[e])];if(!1===a)t=null;else if(a){if("object"==typeof a)for(let e in a)!1!==a[e]?(t=t||{})[e]=a[e]:t&&delete t[e];else if("fg"===a||"bg"===a){let s,i,r;if(t=t||{},e+4<n.length&&2===parseInt(n[e+1]))s=parseInt(n[e+2]),i=parseInt(n[e+3]),r=parseInt(n[e+4]),s<=255&&i<=255&&r<=255&&(t[a]=[s,i,r]);else if(e+2<n.length&&5===parseInt(n[e+1])){const o=parseInt(n[e+1]);o<=15?t[a]=o:o<=231?(r=(o-16)%6,i=(o-16-r)/6%6,s=(o-16-r-6*i)/36,t[a]=[51*s,51*i,51*r]):o<=255&&(r=Math.round(255*(o-232)/23),t[a]=[r,r,r])}}}else;}return t&&$.isEmptyObject(t)?null:t}function He(t,e){return/^\x1b\[[\d;]*m$/.test(e)?function(t){if(!t)return"[m";const e=[];for(let n in Re)t[n]&&e.push(Re[n]);return t.fg&&("number"==typeof t.fg?e.push(t.fg<8?30+t.fg:90+t.fg-8):e.push(38,2,t.fg[0],t.fg[1],t.fg[2])),t.bg&&("number"==typeof t.bg?e.push(t.bg<8?40+t.bg:100+t.bg-8):e.push(48,2,t.bg[0],t.bg[1],t.bg[2])),"["+e.join(";")+"m"}(qe(qe(null,t),e)):t}function We(t,e,n){return"#".concat(t<16?0:"",t.toString(16),e<16?0:"",e.toString(16),n<16?0:"",n.toString(16))}function Ue(t,e,n){var a=!1;if("string"==typeof t&&(n=e,e=t,t=document.createElement("div"),a=!0),n&&n.clear)for(t.removeAttribute("data-pa-terminal-style"),t.removeAttribute("data-pa-outputpart");t.firstChild;)t.removeChild(t.firstChild);var s,i,r=t.getAttribute("data-pa-terminal-style"),o=null;function l(t,e,n){var a=function(t,e){if("string"==typeof t?t=document.createTextNode(t):t instanceof jQuery&&(t=t[0]),!e||"[m"===e||"string"==typeof e&&!(e=qe(e)))return t;const n=document.createElement("span"),a=[];for(let t in Re)e[t]&&a.push("ansi"+t);return e.fg&&("number"==typeof e.fg?a.push("ansifg"+e.fg):n.styles.foregroundColor=We(e.fg[0],e.fg[1],e.fg[2])),e.bg&&("number"==typeof e.bg?a.push("ansibg"+e.bg):n.styles.backgroundColor=We(e.bg[0],e.bg[1],e.bg[2])),a.length&&(n.className=a.join(" ")),n.appendChild(t),n}(e,r);if(null!=n&&""!==n){var s=document.createElement("a");s.href=n,s.append(a),t.append(s)}else t.append(a)}function c(t){o||(o=document.createDocumentFragment()),o.appendChild(t)}function d(t,e){var a,s,i=!e,o=0;for(i&&(e=document.createElement("span")),/\r/.test(t)&&(t=function(t){var e=/\n$/.test(t);if(e&&t.indexOf("\r")===t.length-1)return t.substring(0,t.length-2)+"\n";var n=r||"[m",a=(e?t.substr(0,t.length-1):t).split(/\r/),s=[];for(let t=0;t<a.length;++t){for(var i=[],o=0,l=null,c=a[t].split(/(\x1b\[[\d;]*m|\x1b\[0?K)/),u=0;u<c.length;u+=2)""!==c[u]&&(i.push(n,c[u]),o+=c[u].length),u+1<c.length&&(c[u+1].endsWith("K")?l=o:n=He(n,c[u+1]));for(var d=0;d<s.length&&o>=s[d+1].length;)o-=s[d+1].length,d+=2;for(;d<s.length&&o<s[d+1].length&&null===l;)i.push(s[d],s[d+1].substr(o)),o=0,d+=2;s=i}return s.push(n),e&&s.push("\n"),s.join("")}(t));a=t.match(/^(\x1b\[[\d;]*m|\x1b\[\d*K)([^]*)$/);)r=He(r,a[1]),t=a[2];((a=t.match(/^([ \t]*)([^:\s]+):(\d+)(?=:)/))||(a=t.match(/^([ \t]*)file \"(.*?)\", line (\d+)/i)))&&function(t,e,a,s,i){let o;for(;o=a.match(/^(\x1b\[[\d;]*m|\x1b\[\d*K)([^]*)$/);)r=He(r,o[1]),a=o[2];let c=Nt.by_file(a);if(!c&&n&&n.directory&&(a=n.directory+a,c=Nt.by_file(a)),c){e.length&&l(t,e);var u=document.createElement("a");return u.href="#"+c.lineid_anchor("b"+s),u.className="u pa-goto",u.append(i.substring(e.length).replace(/(?:\x1b\[[\d;]*m|\x1b\[\d*K)/g,"")),l(t,u),!0}return!1}(e,a[1],a[2],a[3],a[0])&&(o=a[0].length,t=t.substr(o));for(var u,d="";""!==t;){if(u=t,a=t.match(/^(.*?)(\x1b\[[\d;]*m|\x1b\[\d*K|\x1b\]8;;)([^]*)$/)){if(""===a[1]){if("]8;;"===a[2]){(s=a[3].match(/^(.*?)(?:\x1b\\|\x07)([^]*)$/))?(d=s[1],t=s[2]):t="";continue}r=He(r,a[2]),t=a[3];continue}u=a[1]}o+u.length>133||o+u.length==133&&"\n"!==u.charAt(132)?(l(e,u=u.substr(0,132-o),d),e.className="pa-rl-continues",i&&c(e),e=document.createElement("span"),i=!0,o=0):(l(e,u,d),o+=u.length),t=t.substr(u.length)}i&&c(e)}"string"==typeof e?((s=e.split(/^/m)).length&&""===s[s.length-1]&&s.pop(),i=s.length&&s[s.length-1].endsWith("\n")):(s=[],i=!0,o=e);var h=t.lastChild,p=null;if(h&&h.lastChild&&u(h.lastChild,"pa-runcursor")&&(p=h.lastChild,h.removeChild(p)),h&&null!==(e=h.getAttribute("data-pa-outputpart"))&&""!==e&&s.length){for(;h.firstChild;)h.removeChild(h.firstChild);s[0]=e+s[0],h.removeAttribute("data-pa-outputpart")}else h&&(s.length||o)&&(h.appendChild(document.createTextNode("\n")),h.removeAttribute("data-pa-outputpart")),h=null;var f,m,g,b=r;for(f=0;f<s.length;f=m){for(b=r,g=s[f],m=f+1;!g.endsWith("\n")&&m<s.length;++m)g+=s[m];m==s.length&&i&&(g=g.substring(0,g.length-1)),d(g,f?null:h)}n&&n.cursor&&!t.lastChild&&!o&&c(""),o&&t.appendChild(o);var _=t.childNodes.length;if(_>=4e3){for(f=t.firstChild;"DIV"===f.tagName&&"pa-rl-group"===f.className;)f=f.nextSibling,--_;for(var v=null,x=0;f&&(m=f.nextSibling);)(!v||x>=4e3&&_>=2e3)&&((v=document.createElement("div")).className="pa-rl-group",t.insertBefore(v,f),x=0),t.removeChild(f),v.appendChild(f),f=m,++x,--_}if(n&&n.cursor&&(p||((p=document.createElement("span")).className="pa-runcursor"),t.lastChild.appendChild(p)),!i&&t.lastChild&&(r=b,t.lastChild.setAttribute("data-pa-outputpart",g)),null!=r?t.setAttribute("data-pa-terminal-style",r):t.removeAttribute("data-pa-terminal-style"),a)return t.innerHTML}function Ke(){const t=this.closest(".pa-grade");this.classList.toggle("pa-grade-latest"),this.classList.toggle("pa-grade-earlier"),ye.closest(this).update_at(t)}function Ze(n,a){const s=n.closest("form"),r=n.getAttribute("data-pa-run-category")||n.value,o=n.closest(".pa-psetinfo"),l=o?o.getAttribute("data-pa-directory"):"",c=document.getElementById("pa-run-"+r),p=c.closest(".pa-runout"),f=$(c).find("pre");let m,g,b,_=a.queueid||null,v=null,y=null;if(p&&h(p,"hidden"),h(c,"need-run"),x(c,p,!0),a.unfold&&c.hasAttribute("data-pa-timestamp")?g=+c.getAttribute("data-pa-timestamp"):a.timestamp&&(g=a.timestamp),u(s,"pa-run-active"))return!0;if($(s).find("button").prop("disabled",!0),d(s,"pa-run-active"),g||c.removeAttribute("data-pa-timestamp"),g||a.noclear?c.lastChild&&$(c.lastChild).find("span.pa-runcursor").remove():(f.html(""),d(f[0].parentElement,"pa-run-short"),f[0].removeAttribute("data-pa-terminal-style"),$(c).children(".pa-runrange").remove()),c.getAttribute("data-pa-xterm-js")&&"false"!==c.getAttribute("data-pa-xterm-js")&&window.Terminal){h(f[0].parentElement,"pa-run-short"),d(f[0].parentElement,"pa-run-xterm-js");const t=+c.getAttribute("data-pa-columns"),e=+c.getAttribute("data-pa-rows"),n=+c.getAttribute("data-pa-font-size"),s={cols:!t||t<0||t!=t?function(t,e){const n=$('<span style="position:absolute">0</span>').appendTo(f),a=Math.trunc(f.width()/n.width()/1.33);return n.remove(),Math.max(t,Math.min(a,e))}(80,132):t,rows:!e||e<0||e!=e?25:e};n&&n>0&&n==n&&(s.fontSize=n),m=new Terminal(s),m.open(f[0]),m.attachCustomKeyEventHandler(function(t){return function(e){if("keydown"===e.type){let n=F(e),a=M(e);if(1===n.length)if(0==(14&a)&&F.printable(e));else if((14&a)===M.CTRL&&n>="a"&&n<="z")n=String.fromCharCode(n.charCodeAt(0)-96);else{if((14&a)===M.META&&"v"==n)return navigator.clipboard.readText().then((e=>t(e))),void e.preventDefault();n=""}else n="Enter"!==n||a?"Escape"!==n||a?"Backspace"!==n||a?"Tab"!==n||a?"ArrowUp"!==n||a?"ArrowDown"!==n||a?"ArrowRight"!==n||a?"ArrowLeft"!==n||a?"PageUp"!==n||a?"PageDown"!==n||a?"":"[6~":"[5~":"OD":"OC":"OB":"OA":"\t":"":"":"\r";""!==n&&(t(n),e.preventDefault())}return!1}}((function(t){K({write:t})}))),a.focus&&m.focus()}function w(){m||!u(c,"pa-run-short")&&!c.hasAttribute("data-pa-runbottom")||requestAnimationFrame((function(){c.scrollHeight>c.clientHeight&&h(c,"pa-run-short"),c.hasAttribute("data-pa-runbottom")&&(c.scrollTop=Math.max(c.scrollHeight-c.clientHeight,0))}))}c.hasAttribute("data-pa-opened")||(c.setAttribute("data-pa-opened","true"),m||(c.setAttribute("data-pa-runbottom","true"),c.addEventListener("scroll",(function(){requestAnimationFrame((function(){c.scrollTop+c.clientHeight>=c.scrollHeight-10?c.setAttribute("data-pa-runbottom","true"):c.removeAttribute("data-pa-runbottom")}))})),w()));let k="",C=null,A=0,E=50,N=null;function D(){m?m.write("[?25l"):c.lastChild&&$(c.lastChild).find(".pa-runcursor").remove()}function S(t){var e;u(s,"pa-run-active")&&(h(s,"pa-run-active"),$(s).find("button").prop("disabled",!1)),!1!==t&&(D(),n.hasAttribute("data-pa-run-grade")&&et(q("api/grade",{psetinfo:e=o}),null,"GET").then((function(t){t&&t.ok&&ye.store(e,t)})),a.done_function&&a.done_function()),R(-1)}function T(t,e){m?m.write(t,e):(Ue(f[0],t,{cursor:!0,directory:l}),e&&Promise.resolve(!0).then(e))}function j(t){"string"==typeof t&&(t=$(t)[0]),m?window.console&&console.log("xterm.js cannot render "+t):Ue(f[0],t,{cursor:!0})}function L(t,e,n){if(null!==k){k+=t;var s=k.indexOf("\n\n");if(s<0)return;C=function(t){const e=/^([\x00-\x7F]*)([\u0080-\u07FF]*)([\u0800-\uD7FF\uE000-\uFFFF]*)((?:[\uD800-\uDBFF][\uDC00-\uDFFF])*)/y;let n=0,a=0;for(;n<t.length;){e.lastIndex=n;const s=t.match(e);if(!s)break;s[1].length&&(n+=s[1].length,a+=s[1].length),s[2].length&&(n+=s[2].length,a+=2*s[2].length),s[3].length&&(n+=s[3].length,a+=3*s[3].length),s[4].length&&(n+=s[4].length,a+=2*s[4].length)}return a}(k.substr(0,s+2)),t=k.substr(s+2),k=null;var r="";e&&e.timestamp&&(r="...started "+i("%l:%M:%S%P %e %b %Y",new Date(1e3*e.timestamp))),m?(""!==r&&(r="[3;1;38;5;86m"+r+"[m\r\n"),a.noclear||(r="c"+r),t=r+t):(a.noclear||f.html(""),""!==r&&j('<span class="pa-runtime">'+r+"</span>"))}""!==t&&T(t,n)}function z(n,a){let s,i,o,l,p,f,m,g,b,_,v,x=0;if(!N){if(0!==n.offset)throw new Error("fuck");{const e=t.site_json(!1,"pa-runspeed-"+r);_=n.time_factor,e&&e[1]>=(new Date).getTime()-864e5?_=e[0]:e&&t.site_json(!1,"pa-runspeed-"+r,null),(_<.1||_>10)&&(_=1)}N=n.time_data,"string"==typeof N&&(N=function(t){let e=[0,0],n=0;for(;n<t.length;){let a,s=t.indexOf("\n",n+1);s<0&&(s=t.length);const i=t.charCodeAt(n);if((43===i||i>=48&&i<=57)&&(a=t.indexOf(",",n))>=0&&a<s){let r=+t.substring(n,a),o=+t.substring(a+1,s);43===i&&(r+=e[e.length-2]),43===t.charCodeAt(a+1)&&(o+=e[e.length-1]),e.push(r,o)}n=s+1}return e}(N)),N.length>2&&(s=$('<div class="pa-runrange"><button type="button" class="pa-runrange-play"></button><input type="range" class="pa-runrange-range" min="0" max="'+N[N.length-2]+'"><span class="pa-runrange-time"></span><span class="pa-runrange-speed-slow" title="Slow">🐢</span><input type="range" class="pa-runrange-speed" min="0.1" max="10" step="0.1"><span class="pa-runrange-speed-fast" title="Fast">🐇</span></div>').prependTo(c),i=s[0].lastChild,o=s[0].firstChild,s=o.nextSibling,i=s.nextSibling,l=i.nextSibling.nextSibling,s.addEventListener("input",(function(){b=!1,d(o,"paused"),S(+this.value)}),!1),o.addEventListener("click",(function(){u(o,"paused")?(h(o,"paused"),b=!0,f=(new Date).getTime(),m<N[N.length-2]&&(f-=m/_),S(null)):(d(o,"paused"),b=!1)}),!1),l.addEventListener("input",(function(){_=+this.value,t.site(!1,"pa-runspeed-"+r,[_,(new Date).getTime()]),b&&(f=(new Date).getTime()-m/_,S(null))}),!1),l.value=_),n={data:n.data,end_offset:n.end_offset,size:n.size||n.end_offset,timestamp:n.timestamp},a?(p=N.length,m=N[p-2],b=!1,o&&d(o,"paused"),y()):(p=0,m=0,f=(new Date).getTime(),b=!0,N.length&&S(null))}function y(){s&&(s.value=m,i.textContent=e("%d:%02d.%03d",Math.trunc(m/6e4),Math.trunc(m/1e3)%60,Math.trunc(m)%1e3))}function A(){x||(x=!0,K({offset:n.end_offset},(function(t){t.ok&&t.offset===n.end_offset?(n.data+=t.data,n.end_offset=t.end_offset):t.ok||(n.size=n.end_offset),x=!1,v&&S(v)})))}function E(t){if(null!==k){const t=n.data.indexOf("\n\n");L(n.data.substring(0,t+2),n)}return t<N.length?C+N[t+1]:n.size}function S(t){if(null===t){if(!b)return;t=((new Date).getTime()-f)*_}let e=p;if((e>=N.length||t<N[e])&&(e=0),e+2<N.length&&t>=N[e]){let n=N.length;for(;e<n;){const a=e+(n-e>>1&-2);t<=N[a]?n=a:e=a+2}}for(;e<N.length&&t>=N[e];)e+=2;e<p&&(k="",p=0);let a=E(p);const s=8<<20;let i=E(e);if(a+s<i){let t=p;for(;t<e;){const n=t+(e-t>>1&-2);a+s<N[n+1]+C?(e=n,i=E(n)):t=n+2}}if(n.end_offset<n.size){if(i>n.end_offset)return v=t,void A();i>n.end_offset-(1<<20)&&A()}if(m=e<N.length?Math.min(t,N[e]):t,v=t>m?t:null,v){const t=Math.min(a+(4<<20),i);L(n.data.substring(a,t),n,(()=>{S(v)})),a=t}L(n.data.substring(a,i),n),w(),y(),p=e,g&&(g=clearTimeout(g)),b&&!v&&(p<N.length?g=setTimeout(S,Math.min(100,(N[p]-(p?N[p-2]:0))/_),null):(o&&d(o,"paused"),D()))}}let O=0,B={};function I(t){let e=!1;if(t&&t.data)try{let n=JSON.parse(t.data);n&&"object"==typeof n&&null!=n.data&&null!=n.offset&&(n.offset+=C,n.end_offset+=C,null==n.ok&&(n.ok=!0),n.offset<=A?W(n):K({write:""}),e=!0)}catch(t){}e||P()}function P(){v&&(v.close(),v=!1,K())}function R(t){y&&clearTimeout(y),y=t>=0?setTimeout(H,t):null}function H(){y=null,K()}function W(t){if(_&&f.find("span.pa-runqueue").remove(),t&&t.onqueue){_=t.queueid;let e="On queue, ".concat(t.nahead,1==t.nahead?" job":" jobs"," ahead");if(t.headage){let n=t.headage;n>10&&(n=5*Math.round(n/5+.5)),e=e.concat(", oldest began about ",n,1==n?" second":" seconds"," ago")}const n=document.createElement("span");return n.className="pa-runqueue",n.append(e),f[0].insertBefore(n,f[0].lastChild),void R(1e4)}if(function(t){const e=p?p.firstChild:null;if(e&&"H3"===e.tagName){const n=$(e).find(".pa-runstop");t&&!n.length?$('<button class="btn btn-danger pa-runstop" type="button">Stop</button>').click(Z).appendTo(e):!t&&n.length&&n.remove()}}(t&&(null==t.status||"working"===t.status)&&!t.done),!t||!t.ok){let e="Unknown error";return t&&t.loggedout?e="You have been logged out (perhaps due to inactivity). Please reload this page.":t&&(t.error_text?e=t.error_text:t.error&&!0!==t.error?e=t.error:t.message&&(e=t.message),1001===t.errorcode&&t.conflict_timestamp&&(b=t.conflict_timestamp)),T("[1;3;31m"+e+"[m\r\n"),w(),S()}if(t.done&&S(!1),t.eventsource&&"working"===t.status&&null==v&&(v=new EventSource(window.siteinfo.base.concat("runevents/v1/",t.eventsource)),v.onmessage=I,v.onerror=P),!g&&t.timestamp&&(g=t.timestamp,c.setAttribute("data-pa-timestamp",t.timestamp)),t.data&&t.offset<A&&(function(t,e){const n=/^([\x00-\x7F]*)([\u0080-\u07FF]*)([\u0800-\uD7FF\uE000-\uFFFF]*)((?:[\uD800-\uDBFF][\uDC00-\uDFFF])*)/y;let a=0;for(;a<t.data.length&&t.offset<e;){n.lastIndex=a;const s=t.data.match(n);if(!s)break;if(s[1].length){const n=Math.min(e-t.offset,s[1].length);a+=n,t.offset+=n}if(s[2].length){const n=Math.min(e-t.offset,2*s[2].length);a+=n/2,t.offset+=n}if(s[3].length){const n=Math.min(e-t.offset,3*s[3].length);a+=n/3,t.offset+=n}if(s[4].length){const n=Math.min(e-t.offset,2*s[4].length);a+=n/2,t.offset+=n}}t.data=t.data.substring(a)}(t,A),t.offset<A))return void R(0);let e;if(t.data&&!t.partial&&t.done&&(e=t.data.match(/\x1b\[\?1049l(?:[\r\n]|\x1b\[\?1l|\x1b>)*$/))&&(t.data=t.data.substring(0,t.data.length-e[0].length)),t.done&&null!=t.time_data&&""===k)z(t);else{if(null!=t.data&&t.offset===A&&t.end_offset>=A&&(A=t.end_offset,L(t.data,t),E=100),t.result){if(!t.done||t.partial)throw new Error("data.result must only be present on last");null!==k&&L("\n\n",t),L(t.result,t)}t.data||t.result||(E=Math.min(2*E,500)),w(),"old"===t.status?R(2e3):!t.done||t.partial?R(E):(S(),t.timed&&!u(c.firstChild,"pa-runrange")&&K({offset:0},U))}}function U(t){--O,t.data&&t.done&&null!=t.time_data&&z(t,!0)}function K(t,e){if(t&&t.stop&&(B.stop=1),t&&null!=t.write&&(B.write=(B.write||"").concat(t.write)),B.write&&O>0||!B.stop&&null==B.write&&v)return;let n={};s.elements.run||(n.run=r),n.offset=A,t&&null!=t.offset&&(n.offset=t.offset),g?n.check=g:t&&t.stop&&b&&(n.check=b),_&&(n.queueid=_),Object.assign(n,B),delete B.write,delete B.stop,++O,jQuery.ajax(s.getAttribute("action"),{data:$(s).serializeWith(n),type:"POST",cache:!1,dataType:"json",timeout:3e4,success:function(t){--O,(e||W)(t),B.write&&K()},error:function(){$(s).find(".ajaxsave61").html("Failed"),h(s,"pa-run-active")}})}function Z(){K({stop:1})}return a.headline&&a.noclear&&!m&&f[0].firstChild&&T("\n\n"),a.headline&&a.headline instanceof Node?j(a.headline):a.headline&&T("[1;37m"+a.headline+"[m\n"),a.unfold&&c.getAttribute("data-pa-content")&&T(c.getAttribute("data-pa-content")),a.focus&&$(p).scrollIntoView(),c.removeAttribute("data-pa-content"),w(),K(),!1}function Je(t,e){for(var n=$("#pa-runsettings"),a=n.find(".n").length;n.find("[data-runsetting-num="+a+"]").length;)++a;var s=$('<div class="pa-p" data-runsetting-num="'+a+'"><div class="pa-pt"></div><div class="pa-pv"><input name="n'+a+'" class="uich pa-runconfig ignore-diff n" size="30" placeholder="Name"> &nbsp; <input name="v'+a+'" class="uich pa-runconfig ignore-diff v" size="40" placeholder="Value"></div></div>');t&&(s.find(".n").val(t),s.find(".v").val(e)),n.append(s),t||s.find(".n").focus()}function Ge(t){var e,n,a=0,s=this.getTotalLength();if(a!=s){for(;s-a>.5;)if(e=a+(s-a)/2,(n=this.getPointAtLength(e)).x>=t+.25)s=e;else{if(n.x>=t-.25)return n.y;a=e}if((n=this.getPointAtLength(s===e?a:s)).x>=t-.25&&n.x<=t+.25)return n.y}return null}ae.add_format({format:2,render:function(t){return Ue(t)}}),_.on("pa-grade-latest",Ke),_.on("pa-grade-earlier",Ke),_.on("pa-runner",(function(){Ze(this,{focus:!0})})),_.on("pa-run-show",(function(){const t=this.closest(".pa-runout").id.substring(4),e=document.getElementById("pa-run-"+t);if(e.hasAttribute("data-pa-timestamp")&&u(e,"need-run")){Ze(jQuery(".pa-runner[value='"+t+"']")[0],{unfold:!0})}else x(e,jQuery("#run-"+t))})),_.on("pa-runconfig",(function(){"define"===this.name?Je():function(){var t,e,n,a=$("#pa-runsettings .pa-p"),s={};for(t=0;t!=a.length;++t)e=$.trim($(a[t]).find(".n").val()),n=$.trim($(a[t]).find(".v").val()),""!=e&&(s[e]=n);$.ajax(a.closest("form").attr("action"),{data:{runsettings:s},type:"POST",cache:!1,dataType:"json"})}()}));const Ye={m:2,M:2,z:0,Z:0,l:2,L:2,h:1,H:1,v:1,V:1,c:6,C:6,s:4,S:4,q:4,Q:4,t:2,T:2,a:7,A:7,b:1,B:1};let Ve,Xe={},Qe=0,tn=!1;function en(t){if(t instanceof SVGPathElement&&(t=t.getAttribute("d")),Xe[t])return Xe[t];for(var e,n,a,s,i,r,o=[],l=0,c=0,u=0,d=0,h=!1,p=0,f=0,m=1,g=function(t){t instanceof SVGPathElement&&(t=t.getAttribute("d")),t=t.split(/([a-zA-Z]|[-+]?(?:\d+\.?\d*|\.\d+)(?:[Ee][-+]?\d+)?)/);var e,n=1,a=t.length;return function(){for(var s,i=null;n<a;){if((s=t[n])>="A"){if(i)break;i=[s],e=s,"m"!==s&&"M"!==s&&"z"!==s&&"Z"!==s||(e="m"===s||"z"===s?"l":"L")}else{if(!i&&e)i=[e];else if(!i||i.length===Ye[i[0]]+1)break;i.push(+s)}n+=2}return i}}(t);s=g();)if("b"!==(i=s[0])&&"B"!==i)if("z"!==i&&"Z"!==i){if(1==Ye[i]&&(1==s.length?s=["L"]:"h"===i?s=["l",s[1],0]:"H"===i?s=["L",s[1],c]:"v"===i?s=["l",0,s[1]]:"V"===i&&(s=["L",l,s[1]])),(i=s[0])>="a"&&!p)for(e="a"!==i?1:6;e<s.length;e+=2)s[e]+=l,s[e+1]+=c;else if(i>="a")for("a"===i&&(s[3]+=p),e="a"!==i?1:6;e<s.length;e+=2)n=s[e],a=s[e+1],s[e]=l+n*m+a*f,s[e+1]=c+n*f+a*m;for(i=s[0]=i.toUpperCase();s.length<Ye[i]+1;)s.push(u,d);"S"===i?(n=a=0,r&&"C"===r[0]&&(n=l-r[3],a=c-r[4]),s=["C",l+n,c+a,s[1],s[2],s[3],s[4]],i="C"):"T"===i&&(n=a=0,r&&"Q"===r[0]&&(n=l-r[1],a=c-r[2]),s=["Q",l+n,c+a,s[1],s[2]],i="Q"),h||"M"===i||(0!==o.length&&"Z"!==o[o.length-1][0]&&o.push(["M"]),h=!0),"M"===i?(u=s[1],d=s[2],h=!1):"L"===i?o.push(["L",l,c,s[1],s[2]]):"C"===i?o.push(["C",l,c,s[1],s[2],s[3],s[4],s[5],s[6]]):"Q"===i?o.push(["C",l,c,l+2*(s[1]-l)/3,c+2*(s[2]-c)/3,s[3]+2*(s[1]-s[3])/3,s[4]+2*(s[2]-s[4])/3,s[3],s[4]]):(1==++tn&&W("bad normalize "+i),o.push(s)),r=s,l=s[s.length-2],c=s[s.length-1]}else r=o.length?o[o.length-1]:null,h&&(l==u&&c==d||o.push(["L",l,c,u,d]),o.push(["Z"]),h=!1),l=u,c=d;else p="b"===i?p+s[1]:s[1],m=Math.cos(p),f=Math.sin(p);return Qe>=1e3&&(Xe={},Qe=0),Xe[t]=o,++Qe,o}function nn(t,e,n){if(n&&!function(t,e,n){function a(t,a,s,i){return t-e[0]>=n||e[0]-s>=n||a-e[1]>=n||e[1]-i>=n}if("clientX"in e){var s=t.getBoundingClientRect(),i=e[0]-e.clientX,r=e[1]-e.clientY;if(s&&a(s.left+i,s.top+r,s.right+i,s.bottom+r))return!1}for(var o,l,c,u,d=en(t),h=0;h!==d.length;++h){var p=d[h];if("L"===p[0])o=Math.min(p[1],p[3]),l=Math.min(p[2],p[4]),c=Math.max(p[1],p[3]),u=Math.max(p[2],p[4]);else{if("C"!==p[0]){if("Z"===p[0]||"M"===p[0])continue;return!0}o=Math.min(p[1],p[3],p[5],p[7]),l=Math.min(p[2],p[4],p[6],p[8]),c=Math.max(p[1],p[3],p[5],p[7]),u=Math.max(p[2],p[4],p[6],p[8])}if(!a(o,l,c,u))return!0}return!1}(t,e,n.distance))return n;var a,s,i,r,o=t.getTotalLength(),l=((r=t)instanceof SVGPathElement&&(r=r.getAttribute("d")),Xe[r]?Xe[r].length:r.replace(/[^A-DF-Za-df-z]+/g,"").length),c=Math.max(o/l/8,4),u=n?(n.distance+.01)*(n.distance+.01):1/0;function d(n){var i=t.getPointAtLength(n),r=e[0]-i.x,o=e[1]-i.y,l=r*r+o*o;return l<u&&(a=[i.x,i.y],s=n,u=l),i}if(l>20){var h,p,f=function(t,e){var n=en(t);function a(t,n,a,s){var i=e[0]<t?t-e[0]:e[0]>a?e[0]-a:0,r=e[1]<n?n-e[1]:e[1]>s?e[1]-s:0;return Math.max(i,r)}var s,i,r=1/0,o=-1/0,l=24;for(s=0;s!==n.length;++s)"L"===(i=n[s])[0]?(r=Math.min(r,i[1],i[3]),o=Math.max(o,i[1],i[3])):"C"===i[0]&&(r=Math.min(r,i[1],i[3],i[5],i[7]),o=Math.max(o,i[1],i[3],i[5],i[7]));r-=l,o+=l;var c,u,d,h,p,f=Math.max(Math.ceil((o-r)/l),1),m=new Array(f+1);for(m.fill(1/0),s=0;s!==n.length;++s){if("L"===(i=n[s])[0])c=Math.min(i[1],i[3]),u=Math.min(i[2],i[4]),d=Math.max(i[1],i[3]),h=Math.max(i[2],i[4]);else{if("C"!==i[0])continue;c=Math.min(i[1],i[3],i[5],i[7]),u=Math.min(i[2],i[4],i[6],i[8]),d=Math.max(i[1],i[3],i[5],i[7]),h=Math.max(i[2],i[4],i[6],i[8])}for(p=a(c,u,d,h),c=Math.floor((c-r)/l),d=Math.ceil((d-r)/l);c<=d;)m[c]=Math.min(m[c],p),++c}for(s=0;s!==m.length;++s)m[s]<1/0&&(m[s]=m[s]*m[s]);return m.xmin=r,m.xmax=o,m.width=l,m.point=e,m}(t,e),m=f.xmin,g=f.width;for(i=0;i<o;)h=d(i),f[p=Math.floor((h.x-m)/g)]>u&&f[p-1]>u&&f[p+1]>u?i+=g:i+=c}else for(i=0;i<o;i+=c)d(i);d(o);do{(i=s-c/2)>0&&d(i),(i+=c)<o&&d(i),c/=2}while(c>.5);return a&&(a.distance=Math.sqrt(u),a.pathNode=t,a.pathLength=s),a&&(!n||a.distance<=n.distance+.01)?a:n}class an{constructor(){this.is=[]}lower(t){for(var e=this.is,n=0,a=e.length;n<a;){var s=n+2*(a-n>>2);if(e[s]>t)a=s;else{if(!(t>e[s+1]))return s;n=s+2}}return n}contains(t){var e=this.lower(t);return e<this.is.length&&t>=this.is[e]}overlaps(t,e){var n=this.lower(t);return n<this.is.length&&e>=this.is[n]}add(t,e){var n=this.is,a=this.lower(t);(a>=n.length||t<n[a])&&n.splice(a,0,t,t);for(var s=a;s+2<n.length&&e>=n[s+2];)s+=2;s!==a&&n.splice(a+1,s-a),n[a+1]=Math.max(n[a+1],e)}clear(){this.is=[]}}function sn(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}class rn{constructor(t,e,n){const a=$(t);let s="all";n.indexOf("extension")>=0?s="extension":n.indexOf("noextra")>=0&&(s="noextra");const i=e.series[s]||e.series.all,r=i.min();let o=r<0?r-1:0;e.entry&&"letter"===e.entry.type&&(o=Math.min(65,r<0?r:Math.max(r-5,0))),this.min=o,this.max=i.max(),e.maxtotal&&(this.max=Math.max(this.max,e.maxtotal)),this.min==this.max&&(o=this.min=this.min-1,this.max+=1),this.total=e.maxtotal,this.cutoff=i.cutoff,this.svg=sn("svg"),this.gg=sn("g"),this.gx=sn("g"),this.gy=sn("g"),this.xl=this.xt=!0,this.yl=this.yt="pdf"!==n.substring(0,3),this.tw=a.width(),this.th=a.height(),this.svg.setAttribute("preserveAspectRatio","none"),this.svg.setAttribute("width",this.tw),this.svg.setAttribute("height",this.th),this.svg.setAttribute("overflow","visible"),this.svg.appendChild(this.gg),this.gx.setAttribute("class","pa-gg-axis pa-gg-xaxis"),this.svg.appendChild(this.gx),this.gy.setAttribute("class","pa-gg-axis pa-gg-yaxis"),this.svg.appendChild(this.gy),this.maxp=0,this.hoveranno=null,this.hoveron=!1,a.html(this.svg);const l=sn("text");l.appendChild(document.createTextNode("888")),this.gx.appendChild(l);var c=l.getBBox();if(this.xdw=c.width/3,this.xdh=c.height,this.gx.removeChild(l),this.xlw=this.xdw*(this.max>0?Math.floor(Math.log10(this.max))+1:1),this.mt=Math.ceil(Math.max(this.yl?this.xdh/2:0,2)),this.mr=Math.ceil(this.xl?this.xlw/2:0),this.mb=(this.xt?5:0)+(this.xl?this.xdh+3:0),this.yl){const t=this.th-this.mt-Math.max(this.mb,Math.ceil(this.xdh/2));if(t>this.xdh){var u=a.hasClass("pa-grgraph-min-yaxis");this.yfmt=u?"%.0r%%":"%.0r";const e=t/this.xdh;this.ymax=100,this.ylu=e>15?10:e>5?25:e>3?50:100,this.ml=5+(this.yt?5:0)+(u?4.2:3)*this.xdw,a.hasClass("pa-grgraph-min-yaxis")||(this.yltext=sn("text"),this.yltext.appendChild(document.createTextNode("% of grades")),this.gy.appendChild(this.yltext),(c=this.yltext.getBBox()).width<=.875*t?this.ml+=.5*this.xdw+this.xdh:(this.gy.removeText(this.yltext),this.yltext=null)),this.mb=Math.max(this.mb,Math.ceil(this.xdh/2))}else this.yl=!1,this.ml=0,this.mt=2}else this.ml=this.yt?5:0;this.xl&&(this.ml=Math.max(this.ml,Math.ceil(this.xdw/2))),this.gw=this.tw-this.ml-this.mr;var d=this.gh=this.th-this.mt-this.mb;const h=this.gw/Math.max(this.max-this.min,.001);if(this.xax=function(t){return(t-o)*h},this.yax=function(t){return d-t*d},this.unxax=function(t){return t/h+o},this.unyax=function(t){return-(t-d)/d},e.entry&&e.entry.type){const t=window.pa_grade_types[e.entry.type];t&&t.tics&&(this.xtics=t.tics.call(t))}this.max-this.min>900?this.xfmt="%.0r":this.max-this.min>10?this.xfmt="%.1r":this.xfmt="%.3r",this.gg.setAttribute("transform","translate("+this.ml+","+this.mt+")"),this.gx.setAttribute("transform","translate("+this.ml+","+(this.mt+this.gh+(this.xt?2:-5))+")"),this.gy.setAttribute("transform","translate("+(this.ml+(this.yt?-2:5))+","+this.mt+")")}numeric_xaxis(){const t=Math.floor(Math.log10(this.max))+1,e=this.xdw*(t+.5),n=this.gw/e,a=Math.pow(10,Math.max(0,t-2)),s=(this.max-this.min)/a;let i;i=n>4*s&&a>1?a/2:n>2*s?a:n>s*(a<=1?.75:1)?2*a:a>1&&n>.6*s?2.5*a:n>.3*s?5*a:10*a;const r=[];let o=Math.floor(this.min/i)*i,l=!1;for(;o<this.max+i;){let t=o,n=this.xl;if(this.total&&(t>this.total&&t-i<this.total&&!l&&(t=this.total,o-=i),t==this.total&&(l=!0)),o+=i,t<this.min)continue;t>this.max&&(t=this.max);const a=this.xax(t);if(r.push("M",a,",0v5"),(this.total&&t!=this.total&&Math.abs(a-this.xax(this.total))<e||t!=this.max&&t!=this.total&&Math.abs(a-this.xax(this.max))<e)&&(n=!1),n){const e=sn("text");e.appendChild(document.createTextNode(t)),e.setAttribute("x",a),e.setAttribute("y",this.xdh+3),this.gx.appendChild(e)}}if(this.xt){const t=sn("path");t.setAttribute("d",r.join("")),t.setAttribute("fill","none"),t.setAttribute("stroke","black"),this.gx.appendChild(t)}}xtics_xaxis(){let t=new an,e=new an,n=[];for(let a=0;a!==this.xtics.length;++a){let s=this.xtics[a];if(s.x<this.min||s.x>this.max)continue;let i=this.xax(s.x);if((s.notic||!e.contains(i))&&(s.notic||(n.push("M",i,",0v5"),e.add(i-3,i+3)),this.xl&&s.text)){let e=this.xdw*(s.label_space||s.text.length+.5)*.5;if(!t.overlaps(i-e,i+e)){const n=sn("text");n.appendChild(document.createTextNode(s.text)),n.setAttribute("x",i),n.setAttribute("y",this.xdh+3),this.gx.appendChild(n),e=this.xdw*(s.text.length+.5)*.5,t.add(i-e,i+e)}}}if(this.xt){const t=sn("path");t.setAttribute("d",n.join("")),t.setAttribute("fill","none"),t.setAttribute("stroke","black"),this.gx.appendChild(t)}}xaxis(){this.xtics?this.xtics_xaxis():this.numeric_xaxis()}yaxis(){const t=[];let n=0;for(;n<=this.ymax&&this.yl;){const a=sn("text");a.appendChild(document.createTextNode(e(this.yfmt,n))),a.setAttribute("x",-8),a.setAttribute("y",this.yax(n/this.ymax)+.25*this.xdh),this.gy.appendChild(a),t.push("M-5,",this.yax(n/this.ymax),"h5"),n+=this.ylu}if(this.yt){const e=sn("path");e.setAttribute("d",t.join("")),e.setAttribute("fill","none"),e.setAttribute("stroke","black"),this.gy.appendChild(e)}this.yltext&&(this.yltext.setAttribute("transform","translate("+(-this.ml+this.xdh)+","+this.yax(.5)+") rotate(-90)"),this.yltext.setAttribute("text-anchor","middle"))}container(){return this.svg.closest(".pa-grgraph")}append_cdf(t,e){const n=t.cdf,a=[],s=1/t.n,i=this.cutoff||0,r=this.min;let o=0;if(i)for(;o<n.length&&n[o+1]<i*t.n;)o+=2;for(;o<n.length;o+=2){if(0!==a.length){const t=Math.max(r,n[o]-Math.min(1,n[o]-n[o-2])/2);a.push("H",this.xax(t))}else a.push("M",this.xax(Math.max(r,n[o]-.5)),",",this.yax(i));a.push("V",this.yax(n[o+1]*s))}0!==a.length&&a.push("H",this.xax(Math.max(this.max,n[n.length-2])));const l=sn("path");return l.setAttribute("d",a.join("")),l.setAttribute("fill","none"),l.setAttribute("class",e),this.gg.appendChild(l),this.last_curve=l,this.last_curve_series=t,l}append_pdf(t,e){if(0===t.maxp)return null;const n=[],a=t.kde,s=.9/this.maxp,i=this.xax,r=this.yax,o=[0,0,0,0],l=[0,0,0,0],c=[0,0,0,0],u=[0,0,0,0],d=1e-6;function h(t){const e=(t+2)%4,a=(t+3)%4,s=(t+1)%4;let i=o[a],r=l[a],h=o[t],p=l[t];if(c[a]>d){let n=2*u[a]+3*c[a]*c[t]+u[t],s=3*c[a]*(c[a]+c[t]);i=(i*n-o[e]*u[t]+o[t]*u[a])/s,r=(r*n-l[e]*u[t]+l[t]*u[a])/s}if(c[s]>d){let e=2*u[s]+3*c[s]*c[t]+u[t],n=3*c[s]*(c[s]+c[t]);h=(h*e-o[s]*u[t]+o[a]*u[s])/n,p=(p*e-l[s]*u[t]+l[a]*u[s])/n}n.push("C",i,r,h,p,o[t],l[t])}for(let e=0;e!==a.length;++e){const d=i(this.min+e*t.binwidth),f=r(a[e]*s);if(0===e)n.push("M",d,f),o[3]=o[0]=d,l[3]=l[0]=f;else{const t=(e+3)%4,n=e%4;o[n]=d,l[n]=f;const s=o[t]-d,i=l[t]-f;if(u[n]=Math.sqrt(s*s+i*i),c[n]=Math.sqrt(u[n]),e>1&&h(t),e===a.length-1){var p=(e+1)%4;o[p]=d,l[p]=f,u[p]=0,c[p]=0,h(n)}}}const f=sn("path");return f.setAttribute("d",n.join(" ")),f.setAttribute("fill","none"),f.setAttribute("class",e),this.gg.appendChild(f),this.last_curve=f,this.last_curve_series=t.series,f}remove_if(t){let e=this.gg.firstChild;for(;e;){const n=e.nextSibling;t.call(e)&&this.gg.removeChild(e),e=n}}highlight_last_curve(t,e,n){if(!this.last_curve||!this.last_curve_series.cdfu)return null;var a,s,i,r,o,l,c,h=u(this.last_curve,"pa-gg-pdf"),p=this.last_curve_series.cdf,f=this.last_curve_series.cdfu,m=[];for(s=(a=h?.9/(this.maxp*t.n):1/t.n)*this.gh,i=r=0;i!==p.length;i+=2){for(c=0;r!==p[i+1];++r)e(f[r],t)&&++c;c&&(o=this.xax(p[i]),null!=(l=h?Ge.call(this.last_curve,o):this.yax(p[i+1]*a))&&m.push("M",o,",",l,"v",c*s))}if(m.length){const t=sn("path");return t.setAttribute("d",m.join("")),t.setAttribute("fill","none"),t.setAttribute("class",n),this.gg.appendChild(t),d(this.gg,"pa-gg-has-hl"),t}return null}typed_annotation(t){const e=sn("circle");return e.setAttribute("class","pa-gg-mark hl-"+(t||"main")),e.setAttribute("r",t&&"main"!==t?3.5:5),e}star_annotation(t,e,n,a){null==e&&(e=Math.PI/2),null==n&&(n=5);var s=sn("path");s.setAttribute("class",a);for(var i=["M"],r=Math.cos,o=Math.sin,l=Math.PI/n,c=0;c<2*n;++c)i.push(t[1&c]*r(e)," ",t[1&c]*o(e),c?" ":"L"),e+=l;return i.push("z"),s.setAttribute("d",i.join("")),s}annotate_last_curve(t,e,n){if(this.last_curve){var a=this.xax(t),s=Ge.call(this.last_curve,a);if(null===s&&this.cutoff&&(s=this.yax(this.cutoff)),null!==s)return(e=e||this.typed_annotation()).setAttribute("transform","translate("+a+","+s+")"),this.gg.insertBefore(e,n||null),!0}return!1}user_x(t){if(this.last_curve_series.cdfu){if(!this.last_curve_series.ucdf){var e,n,a=this.last_curve_series.cdf,s=this.last_curve_series.cdfu,i=this.last_curve_series.ucdf={};for(e=n=0;n!==s.length;++n){for(;n>=a[e+1];)e+=2;i[s[n]]=a[e]}}return this.last_curve_series.ucdf[t]}}highlight_users(){if(this.last_curve&&this.last_curve_series.cdfu){this.last_highlight=this.last_highlight||{};var t,e=this.container().attributes,n={};for(let t=0;t!==e.length;++t)if(e[t].name.startsWith("data-pa-highlight")){let a;a="data-pa-highlight"===e[t].name?"main":e[t].name.substring(18),n[a]=e[t].value,this.last_highlight[a]=this.last_highlight[a]||""}for(let e in this.last_highlight){var a=n[e]||"";if(this.last_highlight[e]!==a){var s={},i=a.split(/\s+/);for(let t=0;t!==i.length;++t)""!==i[t]&&(s[i[t]]=1);for(var r,o=this.gg.firstChild,l="pa-gg-mark hl-"+e;o&&(!u(o,"pa-gg-mark")||o.className.animVal<l);)o=o.nextSibling;for(;o&&o.className.animVal===l;){r=o.nextSibling;var c=+o.getAttribute("data-pa-uid");s[c]?s[c]=2:this.gg.removeChild(o),o=r}for(let n=0;n!==i.length;++n)if(1===s[i[n]]&&null!=(t=this.user_x(i[n]))){var d=this.typed_annotation(e);d.setAttribute("data-pa-uid",i[n]),this.annotate_last_curve(t,d,o)}this.last_highlight[e]=a}}}}hover(){const t=this;function n(t,e,n){let a=null;for(const s of t){const t=s.getAttribute("transform").match(/^translate\(([-+\d.]+),([-+\d.]+)\)$/);if(t){const i=+t[1]-e[0],r=+t[2]-e[1],o=i*i+r*r;o<n&&(a=[+t[1],+t[2]],a.pathNode=s,n=o)}}return a&&(a.distance=Math.sqrt(n)),a}function a(a){let s={distance:20},i=t.xfmt;if("mousemove"!==a.type&&(t.hoveron="mouseleave"!==a.type),t.hoveron){const e=function(t,e){var n,a=t.ownerSVGElement||t;if(a.createSVGPoint)(n=a.createSVGPoint()).x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse());else{var s=t.getBoundingClientRect();n={x:e.clientX-s.left-t.clientLeft,y:e.clientY-s.top-t.clientTop}}var i=[n.x,n.y];return i.clientX=e.clientX,i.clientY=e.clientY,i}(t.svg,a),o=t.gg.querySelectorAll(".pa-gg-pdf, .pa-gg-cdf");for(var r of(e[0]-=t.ml,e[1]-=t.mt,o))s=nn(r,e,s);if(s.pathNode){const e=n(t.gg.querySelectorAll(".pa-gg-mark.hl-main"),s,36)||n(t.gg.querySelectorAll(".pa-gg-mark:not(.hl-main)"),s,25);e&&(s=e,"%.0r"!==i&&"%.1f"!==i||(i="%.2r"))}}let o=t.hoveranno;if(s.pathNode){if(!o){o=t.hoveranno=[t.star_annotation([4,10],null,null,"pa-gg-hover-mark")],t.gg.appendChild(o[0]);var l=sn("path");l.setAttribute("d","M0,0v5"),l.setAttribute("fill","none"),l.setAttribute("stroke","black"),t.gx.appendChild(l),o.push(l),(l=sn("rect")).setAttribute("class","pa-gg-hover-box"),l.setAttribute("y",5),l.setAttribute("height",t.xdh+1.5),l.setAttribute("rx",3),t.gx.appendChild(l),o.push(l),(l=sn("text")).appendChild(document.createTextNode("")),l.setAttribute("class","pa-gg-hover-text"),l.setAttribute("y",t.xdh+3),t.gx.appendChild(l),o.push(l),(l=sn("text")).appendChild(document.createTextNode("")),l.setAttribute("class","pa-gg-anno-name"),l.setAttribute("text-anchor","end"),l.setAttribute("dx",-8),t.gg.appendChild(l),o.push(l),t.yl&&((l=sn("path")).setAttribute("d","M-5,0h5"),l.setAttribute("fill","none"),l.setAttribute("stroke","black"),t.gy.appendChild(l),o.push(l),(l=sn("rect")).setAttribute("class","pa-gg-hover-box"),l.setAttribute("height",t.xdh+1),l.setAttribute("rx",3),t.gy.appendChild(l),o.push(l),(l=sn("text")).appendChild(document.createTextNode("")),l.setAttribute("class","pa-gg-hover-text"),l.setAttribute("x",-8),t.gy.appendChild(l),o.push(l))}o[0].setAttribute("transform","translate("+s[0]+","+s[1]+")"),o[1].setAttribute("transform","translate("+s[0]+",0)"),o[3].setAttribute("x",s[0]),o[3].firstChild.data=e(i,t.unxax(s[0]));var c=o[3].getBBox();let n,a,r;o[2].setAttribute("x",s[0]-c.width/2-2),o[2].setAttribute("width",c.width+4),s.pathNode.hasAttribute("data-pa-uid")&&(n=this.closest("form").pa__ptconf)&&(a=n.uidmap[s.pathNode.getAttribute("data-pa-uid")])&&(r=n.render_tooltip_name(a))?(o[4].firstChild.data=r,o[4].setAttribute("x",s[0]),o[4].setAttribute("y",s[1])):o[4].firstChild.data="",t.yl&&(o[5].setAttribute("transform","translate(0,"+s[1]+")"),o[7].setAttribute("y",s[1]+.25*t.xdh),o[7].firstChild.data=e(t.yfmt,t.unyax(s[1])*t.ymax),c=o[7].getBBox(),o[6].setAttribute("x",-c.width-10),o[6].setAttribute("y",s[1]-(t.xdh+2)/2),o[6].setAttribute("width",c.width+4))}else o&&(t.gg.removeChild(o[0]),t.gx.removeChild(o[1]),t.gx.removeChild(o[2]),t.gx.removeChild(o[3]),t.gg.removeChild(o[4]),t.yl&&(t.gy.removeChild(o[5]),t.gy.removeChild(o[6]),t.gy.removeChild(o[7])),t.hoveranno=null)}this.svg.addEventListener("mouseenter",a,!1),this.svg.addEventListener("mousemove",a,!1),this.svg.addEventListener("mouseleave",a,!1)}}class on{constructor(t){this.n=t.n,this.cdf=t.cdf,this.cdfu=t.cdfu||null,this.mean=t.mean||null,this.median=t.median||null,this.stddev=t.stddev||null,this.cutoff=t.cutoff||null}min(){return this.cdf.length?this.cdf[0]:0}max(){return this.cdf.length?this.cdf[this.cdf.length-2]:0}count_at(t){const e=this.cdf;let n=0,a=e.length;for(;n<a;){const s=n+2*(a-n>>2);e[s]>=t?a=s:n=s+2}return e[n+1]}}class ln{constructor(t,e,n,a){const s=e.max,i=e.min,r=(s-i)*n,o=1/r;function l(t){return t>=-r&&t<=r?.75*o*(1-(t*=o)*t):0}const c=[];for(let t=0;t!==a+1;++t)c.push(0);const u=t.cdf,d=(s-i)/a,h=1/d;for(let t=0;t<u.length;t+=2){const e=u[t+1]-(0===t?0:u[t-1]);let n=Math.floor((u[t]-i-r)*h);const s=Math.ceil((u[t]-i+r)*h);for(;n<s;){const s=Math.max(-1,Math.min(a+1,n));s>=0&&s<=a&&(c[s]+=l(n*d-u[t]+i)*e),++n}}let p=0;if(t.n){const e=1/t.n;for(let t=0;t!==a+1;++t)c[t]*=e,p=Math.max(p,c[t])}this.series=t,this.kde=c,this.maxp=p,this.binwidth=d}}class cn{constructor(t){this.pset=t.pset,this.psetid=t.psetid,this.maxtotal=t.maxtotal||null,this.entry=t.entry||null,this.series={};for(let e in t.series)this.series[e]=new on(t.series[e])}}function un(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function dn(){const e=this,n=$(e).data("paGradeData");if(!n)return d(e,"hidden"),void $(e).removeData("paGradeGraph").off("redrawgraph");const a=e.closest(".pa-psetinfo"),s=!a||a.hasAttribute("data-pa-user-extension"),i=[];n.series.extension&&a&&s&&i.push("cdf-extension","pdf-extension"),i.push("cdf","pdf"),n.series.extension&&!a&&i.push("cdf-extension","pdf-extension"),n.series.noextra&&i.push("cdf-noextra","pdf-noextra"),i.push("all"),e.setAttribute("data-pa-gg-types",i.join(" "));let r=e.getAttribute("data-pa-gg-type");if(r||(r=t(!0,"pa-gg-type")),!r){let e=t(!1,"pa-gg-type");if(e&&"{"===e[0])try{e=JSON.parse(e),"string"==typeof e.type&&"number"==typeof e.at&&e.at>=(new Date).getTime()-72e5&&(r=e.type)}catch(t){}}r&&"default"!==r||(r=i[0]),i.indexOf(r)<0&&(r="pdf"===r.substring(0,3)?i[1]:i[0]),e.setAttribute("data-pa-gg-type",r),$(e).removeClass("cdf pdf all cdf-extension pdf-extension all-extension cdf-noextra pdf-noextra all-noextra hidden").addClass(r);const o="all"===r.substring(0,3),l=r.indexOf("-extension")>=0||o&&s&&n.extension,c=r.indexOf("-noextra")>=0||o&&n.series.noextra&&!l;let u=$(e).find(".pa-plot");u.length||(u=$(e));const p=new rn(u[0],n,r);if($(e).data("paGradeGraph",p),p.total&&p.total<p.max){let t=un("line");t.setAttribute("x1",p.xax(p.total)),t.setAttribute("y1",p.yax(0)),t.setAttribute("x2",p.xax(p.total)),t.setAttribute("y2",p.yax(1)),t.setAttribute("class","pa-gg-anno-total"),p.gg.appendChild(t)}const f=Math.ceil((p.max-p.min)/2),m=.08,g={};"pdf-extension"===r?g.extension=new ln(n.series.extension,p,m,f):"pdf-noextra"===r?g.noextra=new ln(n.series.noextra,p,m,f):"pdf"===r&&(g.main=new ln(n.series.all,p,m,f));for(let t in g)p.maxp=Math.max(p.maxp,g[t].maxp);if("pdf-noextra"===r?p.append_pdf(g.noextra,"pa-gg-pdf pa-gg-noextra"):"pdf"===r?p.append_pdf(g.main,"pa-gg-pdf"):"pdf-extension"===r?p.append_pdf(g.extension,"pa-gg-pdf pa-gg-extension"):("cdf-noextra"===r||"all"===r&&n.series.noextra)&&p.append_cdf(n.series.noextra,"pa-gg-cdf pa-gg-noextra"),"cdf"!==r&&"all"!==r||p.append_cdf(n.series.all,"pa-gg-cdf"),("cdf-extension"===r||"all"===r&&n.series.extension&&s)&&p.append_cdf(n.series.extension,"pa-gg-cdf pa-gg-extension"),p.cutoff&&"pdf"!==r.substring(0,3)){const t=un("rect");t.setAttribute("x",p.xax(0)),t.setAttribute("y",p.yax(p.cutoff)),t.setAttribute("width",p.xax(p.max)),t.setAttribute("height",p.yax(0)-p.yax(p.cutoff)),t.setAttribute("fill","rgba(255,0,0,0.1)"),p.gg.appendChild(t)}const b=a?a.pa__gradesheet:null,_=b?b.grade_total(c&&!o):null;null!=_&&p.annotate_last_curve(_),p.xaxis(),p.yaxis(),e.hasAttribute("data-pa-highlight")&&p.highlight_users(),p.hover(),$(e).find(".statistics").each((function(){const t=p.last_curve_series,e=[];t&&t.mean&&e.push("mean "+t.mean.toFixed(1)),t&&t.median&&e.push("median "+t.median.toFixed(1)),t&&t.stddev&&e.push("stddev "+t.stddev.toFixed(1));const n=[e.join(", ")];if(t&&null!=_){const e=t.count_at(_);t.cutoff&&e<t.cutoff*t.n?n.push("≤"+Math.round(100*t.cutoff)+" %ile"):n.push(Math.round(Math.min(Math.max(1,100*e/t.n),99))+" %ile")}n.length?(h(this,"hidden"),this.innerHTML=n.join(" · ")):(d(this,"hidden"),this.innerHTML="")})),$(e).find(".pa-grgraph-type").each((function(){const t=[];r.startsWith("cdf")?t.push("CDF"):r.startsWith("pdf")&&t.push("PDF"),l&&!o&&t.push("extension"),c&&!o&&t.push("no extra credit");const e=t.length?" ("+t.join(", ")+")":"";this.innerHTML="grade statistics"+e})),p.highlight_users(),$(e).off("redrawgraph").on("redrawgraph",dn)}function hn(t){t=t.replace(/^[^#]*/,"");let e,n=/([^#=\/]+)[=\/]?([^\/]*)/g,a={};for(;e=n.exec(t);)a[e[1]]=decodeURIComponent(e[2].replace(/\+/g," "));return a}function pn(t){const e=hn(location.hash);for(let n in t)null===t[n]||void 0===t[n]?delete e[n]:e[n]=t[n];const n=function(t){const e=[];for(var n in t)null===t[n]||void 0===t[n]||""===t[n]?e.push(n):e.push(n+"="+encodeURIComponent(t[n]).replace(/%20/g,"+"));return e.sort(),e.length?"#"+e.join("/"):""}(e);n!==location.hash&&Ve(location.origin+location.pathname+location.search+n)}function fn(){return u(document.body,"want-grgraph-hash")}function mn(t,e,n){const a="data-pa-highlight"+("main"===e?"":"-"+e);n=n||"",$(t).find(".pa-grgraph").each((function(){const t=this.getAttribute(a)||"",s=this;t===n||"main"!==e&&"course"===this.getAttribute("data-pa-pset")||(n?this.setAttribute(a,n):this.removeAttribute(a),window.requestAnimationFrame((function(){const t=$(s).data("paGradeGraph");t&&t.highlight_users()})))}))}function gn(t,e){const n={},a={};let s,i=!1;for(let e of t.match(/[-\d.]+/g)||[])n[e]=!0;if($(".js-grgraph-highlight-course").each((function(){const t=this.getAttribute("data-pa-highlight-range")||"90-100",e=this.getAttribute("data-pa-highlight-type")||"h00";if(a[e]=a[e]||[],this.checked=!!n[t]){let n=t.match(/^([-+]?(?:\d+\.?\d*|\.\d+))-([-+]?(?:\d+\.?\d*|\.\d))(\.?)$/);if(n)a[e].push(+n[1],+n[2]+(n[3]?1e-5:0)),i=!0;else{if(!(n=t.match(/^([-+]?(?:\d+\.?\d*|\.\d+))-$/)))throw new Error("bad range");a[e].push(+n[1],1/0),i=!0}}})),i)if(s=function(){let t=null;return $(".pa-grgraph[data-pa-pset=course]").each((function(){const e=$(this).data("paGradeData");if(e&&e.series.all&&e.series.all.cdfu)return t=e.series.all,!1})),t}())for(let t in a){const e=a[t],n=[];if(e.length){for(let t=0;t!==s.cdf.length;t+=2)for(let a=0;a!==e.length;a+=2)if(s.cdf[t]>=e[a]&&s.cdf[t]<e[a+1]){const e=t?s.cdf[t-1]:0;Array.prototype.push.apply(n,s.cdfu.slice(e,s.cdf[t+1]));break}n.sort()}mn(document.body,t,n.join(" "))}else setTimeout((function(){gn(hn(location.hash).hr||"",e+1)}),8<<Math.max(e,230));else for(let t in a)mn(document.body,t,"")}function bn(t){const e=hn(t);mn(document.body,"main",e.hs||""),$("input[type=checkbox].js-grgraph-highlight").prop("checked",!1);for(let t of(e.hs||"").match(/\d+/g)||[])$("tr[data-pa-uid="+t+"] input[type=checkbox].js-grgraph-highlight").prop("checked",!0);gn(e.hr||"",0),$(".js-grgraph-highlight-course").prop("checked",!1);for(let t of(e.hr||"").match(/[-\d.]+/g)||[])$('.js-grgraph-highlight-course[data-pa-highlight-range="'+t+'"]').prop("checked",!0)}_.on("js-grgraph-flip",(function(){const e=this.closest(".pa-grgraph"),n=(e.getAttribute("data-pa-gg-types")||"").split(/ /),a=e.getAttribute("data-pa-gg-type");let s=n.indexOf(a);s>=0&&(s=(s+(u(this,"prev")?n.length-1:1))%n.length,e.setAttribute("data-pa-gg-type",n[s]),t(!0,"pa-gg-type",n[s]),t(!1,"pa-gg-type",{type:n[s],at:(new Date).getTime()}),dn.call(e))})),Ve="pushState"in window.history?function(t){var e;return history.state||(e={href:location.href},$(document).trigger("collectState",[e]),history.replaceState(e,document.title,e.href)),t&&(e={href:t},$(document).trigger("collectState",[e]),history.pushState(e,document.title,e.href)),!0}:function(){return!1},_.on("js-grgraph-highlight",(function(t){if("change"!==t.type)return;const e=this.getAttribute("data-range-type"),n=[];$(this).closest("form").find("input[type=checkbox]").each((function(){let t;this.getAttribute("data-range-type")===e&&this.checked&&(t=this.closest("tr"))&&t.hasAttribute("data-pa-uid")&&n.push(+t.getAttribute("data-pa-uid"))})),n.sort((function(t,e){return t-e})),fn()?(pn({hs:n.length?n.join(" "):null}),mn(document.body,"main",n.join(" "))):mn(this.closest("form"),"main",n.join(" "))})),_.on("js-grgraph-highlight-course",(function(){const t=[];$(".js-grgraph-highlight-course").each((function(){this.checked&&t.push(this.getAttribute("data-pa-highlight-range"))})),fn()&&pn({hr:t.length?t.join(" "):null}),gn(t.join(" "),0)})),fn()&&($(window).on("popstate",(function(t){const e=(t.originalEvent||t).state;e&&e.href&&bn(e.href)})).on("hashchange",(function(){bn(location.href)})),$((function(){bn(location.href)}))),pe.add("checkbox",{text:function(t){return null==t||0===t||!1===t?"–":t===(this.max||1)||!0===t?"✓":""+t},simple_text:pe.basic_text,tcell:function(t){return null==t||0===t||!1===t?"":t===(this.max||1)||!0===t?"✓":""+t},mount_edit:function(t,e){const n=document.createElement("input");n.type="checkbox",n.className="uic uich pa-gradevalue ml-0",n.name=this.key,n.id=e,n.value=this.max,n.disabled=this.disabled;const a=document.createElement("span");return a.className="pa-gradewidth",a.append(n),_n.finish_mount_edit(this,a)},update_edit:function(t,e,n){const a=null==e||""===e||0===e||this&&e===this.max,s=t.firstChild.firstChild;a||"checkbox"!==s.type?a&&"checkbox"!==s.type&&n.reset&&_n.recheckbox(s):_n.uncheckbox(s),"checkbox"===s.type?(s.checked=!!e,s.indeterminate=!!n.mixed):s.value===e||!n.reset&&$(s).is(":focus")||(s.value=""+e)},justify:"center"});class _n{static uncheckbox(t){const e=ve.closest(t);"checkbox"===t.type&&(t.value=t.checked?e.max:""),t.type="text",t.className=(u(t,"uich")?"uich ":"")+"pa-gradevalue pa-gradewidth";const n=t.closest(".pa-pv");$(n).find(".pa-grade-uncheckbox").remove(),$(n).find('input[name^="'+t.name+':"]').addClass("hidden")}static recheckbox(t){const e=t.value.trim(),n=ve.closest(t);t.type="checkbox",t.checked=""!==e&&"0"!==e,t.value=n.max,t.className=(u(t,"uich")?"uic uich ":"")+"pa-gradevalue ml-0",$(t.closest(".pa-pv")).find(".pa-gradedesc").append(' <a href="" class="x ui pa-grade-uncheckbox" tabindex="-1">#</a>')}static finish_mount_edit(t,e){const n=document.createElement("span");n.className="pa-gradedesc";const a=document.createElement("a");a.href="",a.className="x ui pa-grade-uncheckbox",a.tabIndex=-1,a.append("#"),n.append("of "+t.max+" ",a);const s=new DocumentFragment;return s.append(e," ",n),s}}_.on("pa-grade-uncheckbox",(function(){$(this.closest(".pa-pv")).find(".pa-gradevalue").each((function(){_n.uncheckbox(this),this.focus(),this.select()}))}));const vn={98:"A+",95:"A",92:"A-",88:"B+",85:"B",82:"B-",78:"C+",75:"C",72:"C-",68:"D+",65:"D",62:"D-",50:"F"};function xn(t){return{text:function(e){return null==e||0===e?"–":e>0&&Math.abs(e-Math.round(e))<.05?t.repeat(Math.round(e)):""+e},simple_text:pe.basic_text,tcell:function(e){return null==e||0===e?"":e>0&&Math.abs(e-Math.round(e))<.05?t.repeat(Math.round(e)):""+e},mount_edit:function(t,e){const n=document.createElement("input");n.type="hidden",n.className="uich pa-gradevalue",n.name=this.key;const a=document.createElement("span");a.className="pa-gradewidth",a.append(n);for(let t=0;t<this.max;++t){const n=document.createElement("input");n.type="checkbox",n.className="ui js-multicheckbox-grade ml-0",n.name=this.key+":"+t,n.value=1,n.disabled=this.disabled,t===this.max-1&&(n.id=e),a.append(n)}return _n.finish_mount_edit(this,a)},update_edit:function(t,e,n){const a=null==e||""===e||0===e||e>=0&&(!this||e<=this.max)&&Math.abs(e-Math.round(e))<.05,s=t.firstChild.firstChild;a||"hidden"!==s.type?a&&"hidden"!==s.type&&n.reset&&_n.recheckbox(s):_n.uncheckbox(s),s.value!==e&&(s.value=e);const i=s.name+":",r=Math.round(e||0);$(t).find("input[type=checkbox]").each((function(){if(this.name.startsWith(i)){const t=+this.name.substring(i.length);this.checked=t<r,this.indeterminate=!!n.mixed}}))},justify:"left"}}function yn(t,e,n){t.line(e).then((t=>{n.source=t.element,n.render(!1)}))}pe.add("letter",{text:t=>null==t?"":vn[t]||""+t,mount_edit:function(t,e){return pe.basic_mount_edit.call(this,t,e,{max_text:"letter grade"})},justify:"left",tics:()=>{const t=[];for(let e in vn)1===vn[e].length&&t.push({x:e,text:vn[e]});for(let e in vn)2===vn[e].length&&t.push({x:e,text:vn[e],label_space:5});for(let e in vn)2===vn[e].length&&t.push({x:e,text:vn[e].substring(1),label_space:2,notic:!0});return t}}),pe.add("checkboxes",xn("✓")),pe.add("stars",xn("⭐")),_.on("js-multicheckbox-grade",(function(){const t=this.name.indexOf(":"),e=this.name.substring(0,t),n=this.name.substring(t+1),a=this.closest("form").elements[e],s=this.checked?+n+1+"":n;a.value!==s&&(a.value=s,$(a).trigger("change"))})),pe.add("select",{mount_edit:function(t,e){const n=document.createElement("select");n.className="uich pa-gradevalue",n.name=this.key,n.id=e,n.disabled=this.disabled;const a=document.createElement("option");a.value="",a.append("None"),n.append(a);for(let t=0;t!==this.options.length;++t){const e=document.createElement("option");e.value=this.options[t],e.append(this.options[t]),n.append(e)}const s=document.createElement("span");return s.className="select",s.append(n),s},update_edit:function(t,e,n){const a=this.simple_text(e),s=t.firstChild.firstChild;if(k(s,a),s.value=a,n.reset&&n.mixed){if(""!==s.options[0].value){const t=document.createElement("option");t.value="",t.append("Mixed"),s.insertBefore(t,s.firstChild)}s.selectedIndex=0}else""!==a&&s.remove(0)},configure_column:function(t){return(t=pe.basic_configure_column.call(this,t)).className+=" gt-el",t},tcell_width:function(t){let e=0;for(let t of this.options)e=Math.max(e,t.length);return Math.max(pe.basic_tcell_width.call(this,t),Math.floor(1.25*Math.min(e,10))/2)},justify:"left",sort:"forward"}),pe.add("markdown",{text:function(t){return null==t?"":""+t},mount_show:function(t,e){t.id=e,d(t,"pa-textv"),d(t,"pa-gradevalue")},mount_edit:function(t,e){d(t,"pa-textv");const n=document.createElement("span");n.append("Markdown styling and LaTeX math supported · ");const a=document.createElement("a");a.href="",a.className="ui js-toggle-gc-markdown-preview",a.tabIndex=-1,a.append("Preview");const s=document.createElement("p");s.className="pa-preview-notice",s.append(n,a);const i=document.createElement("textarea");i.className="uich pa-gradevalue need-autogrow",i.name=this.key,i.id=e,i.disabled=this.disabled;const r=new DocumentFragment;return r.append(s,i),r},update_show:function(t,e,n){if(null==e||""===e)t.replaceChildren();else if(this.answer){const a=n.gradesheet;d(t,"bg-none"),d(t,"align-self-start");const s=document.createElement("div");s.className="pa-filediff pa-dg pa-hide-left pa-hide-landmarks uim"+(a.scores_editable?" pa-editablenotes live":"")+(a.scores_visible?"":" pa-scores-hidden");let i="/g/"+this.key;s.id=a.file_anchor(i);let r=0,o=1;for(;r!==e.length;){let t=e.indexOf("\n",r);t=t<0?e.length:t+1;const n=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),l=document.createElement("div");n.className="pa-dl pa-gi",a.className="pa-da hidden",i.className="pa-db hidden",i.setAttribute("data-landmark",o),l.className="pa-dd pa-dhlm",l.textContent=e.substring(r,t),n.appendChild(a),n.appendChild(i),n.appendChild(l),s.appendChild(n),++o,r=t}t.replaceChildren(s);const l=new Nt(s);let c;if(u(t.parentElement,"pa-markdown")&&l.markdown(),a.linenotes&&(c=a.linenotes[i]))for(let t in c)yn(l,t,le.parse(c[t]))}else u(t.parentElement,"pa-markdown")?te(t,1,e):te(t,0,e);return null===t.firstChild},justify:"left",sort:"forward",type_tabular:!1}),_.on("js-toggle-gc-markdown-preview",(function(){const t=this.closest(".pa-pv").querySelector("textarea");if(u(t,"hidden"))t.parentElement.removeChild(t.previousSibling),h(t,"hidden"),t.focus(),this.textContent="Preview",h(this.previousSibling,"hidden");else{const e=document.createElement("div"),n=document.createElement("hr"),a=document.createElement("hr"),s=document.createElement("div");e.className="pa-preview",n.className=a.className="pa-preview-border",s.className="pa-dr",e.append(n,s,a),t.parentElement.insertBefore(e,t),d(t,"hidden"),te(s,1,t.value),this.textContent="Edit",d(this.previousSibling,"hidden")}}));const wn="%Y-%m-%d %H:%M";function kn(t,e){let n,a;return t.timeout_entry&&e&&(n=e.entries[t.timeout_entry])&&null!=(a=n.value_in(e))?a:t.timeout}function Cn(t,e,n){if(e&&e.pa__tmto&&(clearTimeout(e.pa__tmto),delete e.pa__tmto),e&&e.pa__tmsticky&&!n)e.pa__tmsticky.parentElement.remove(),delete e.pa__tmsticky;else if(e&&!e.pa__tmsticky&&n){const n=e.closest(".pa-gsection");if(n){const a=document.createElement("div"),s=document.createElement("div");a.className="pa-gnote pa-timermark-sticky",a.setAttribute("data-pa-grade",t.key),s.className="pa-timermark-alert",a.appendChild(s),n.parentElement.insertBefore(a,n),e.pa__tmsticky=s}}}function An(t){const n=(new Date).getTime(),a=Math.round(t.deadline-n/1e3),s=[t.start_at_text];if(a>630)s[0]=s[0].concat(" (",r(60*Math.ceil(a/60))," left)");else if(a>300)s[0]=s[0].concat(" (",r(a)," left)");else if(a>=-599){const t=document.createElement("strong");t.className="overdue",t.textContent="(".concat(r(Math.abs(a)),a<0?" over)":" left)"),s[0]+=" ",s.push(t)}else s[0]=s[0].concat(" (",r(60*-Math.ceil(a/60))," over)");if(t.tmelt.replaceChildren(...s),t.stelt){let n;n=a>630?r(60*Math.ceil(a/60))+" left":a>=0?e("%d:%02d left",Math.floor(a/60),a%60):a>-600?e("%d:%02d over",Math.floor(-a/60),-a%60):r(60*Math.floor(-a/60))+" over",t.stelt.replaceChildren(n),p(t.stelt,"urgent",a<=600&&a>-900)}let i;i=a>660||a<=-600?60*Math.floor((a-1)/60):a>630?630:Math.floor(a-.1);let o=1e3*(t.deadline-i)-490-n;o<=0&&(o+=1e3),t.tmelt.pa__tmto=setTimeout(An,o,t)}function En(t){var e=new A,n=null;function a(t){var e=n.find("form")[0],a=n.find(".popup-body"),s=ie(2,t.error);for(var i in n.find(".msg-error").remove(),a.length?a.prepend(s):n.find("h2").after(s),t.errf||{}){var r=e[i];if(r){var o=$(r).closest(".entryi, .f-i");(o.length?o:$(r)).addClass("has-error")}}return n}return t=t||{},e.push('<div class="modal" role="dialog"><div class="modal-dialog'+(t.anchor&&t.anchor!==window?"":" modal-dialog-centered")+(t.style?'" style="'+ct(t.style):"")+'" role="document"><div class="modal-content"><form enctype="multipart/form-data" accept-charset="UTF-8"'+(t.form_class?' class="'+t.form_class+'"':"")+">","</form></div></div></div>"),e.push_actions=function(t){return e.push('<div class="popup-actions">',"</div>"),t&&e.push(t.join("")).pop(),e},e.show=function(s){if(!n){for(var i in(n=$(e.render()).appendTo(document.body)).find(".need-tooltip").each(Et),n.on("click",(function(t){t.target===n[0]&&$n.call(n[0])})),n.find("button[name=cancel]").on("click",$n),t.action&&(t.action instanceof HTMLFormElement?n.find("form").attr({action:t.action.action,method:t.action.method}):n.find("form").attr({action:t.action,method:t.method||"post"})),{minWidth:1,maxWidth:1,width:1})null!=t[i]&&n.children().css(i,t[i]);n.show_errors=a,n.close=function(){$n.call(n[0])}}return!1!==s&&(!function(t,e){Et.erase(),t.jquery&&(t=t[0]);for(;!u(t,"modal-dialog");)t=t.childNodes[0];var n=t.parentNode;if(d(n,"show"),d(document.body,"modal-open"),!u(t,"modal-dialog-centered")){var a=$(e).geometry(),s=$(window).geometry(),i=$(n).offset(),r=(a.top+a.bottom-t.offsetHeight)/2;r=Math.max(s.top+5,Math.min(s.bottom-5-t.offsetHeight,r))-i.top,t.style.top=r+"px";var o=(a.right+a.left-t.offsetWidth)/2;o=Math.max(s.left+5,Math.min(s.right-5-t.offsetWidth,o))-i.left,t.style.left=o+"px"}queueMicrotask((function(){for(const e of t.querySelectorAll(".want-focus"))if(e.offsetWidth>0)return void Nn(e);for(const e of t.querySelector("form").elements)if("hidden"!==e.type&&!u(e,"dangerous")&&!u(e,"no-focus")&&e.offsetWidth>0)return void Nn(e)}))}(n,t.anchor||window),n.find(".need-autogrow").autogrow(),n.find(".need-tooltip").each(Et)),n},e}function $n(){const t=this.closest(".modal");Et.erase(),$(t).find("textarea, input").unautogrow(),$(t).trigger("closedialog"),$(t).remove(),h(document.body,"modal-open")}function Nn(t){if(t.jquery&&(t=t[0]),t.focus(),!t.hotcrp_ever_focused){if(t.select&&u(t,"want-select"))t.select();else if(t.setSelectionRange)try{t.setSelectionRange(t.value.length,t.value.length)}catch(t){}t.hotcrp_ever_focused=!0}}function Dn(t,e,n,a){const s=e[n.uid],i=t.smap[s.getAttribute("data-pa-spos")];i.assign(n);let r=0;for(let t of i.grades||[])null!=t&&""!==t&&++r;i.ngrades=r;for(let e of t.col)0!=((e.refreshable||0)&a)&&e.td.call(e,s.childNodes[e.index],i,t)}function Sn(){p(this.closest(".pa-pv"),"pa-grade-changed",this.hasAttribute("data-pa-unmixed")||C(this))}function Fn(t){if("click"===t.type&&!t.shiftKey){const t=this.checked;let e=this.closest("label");for(;e=e.nextSibling;){const n=e.firstChild.firstChild;if(n.classList.contains("pa-gdialog-section"))break;n.checked=t}}}function Mn(t,e,n,a){let s,i,r=t.gradesheet,o=function(t){const e={};for(;t;)t.getAttribute("data-pa-uid")&&(e[t.getAttribute("data-pa-uid")]=t),t=t.nextSibling;return e}(n.tBodies[0].firstChild);function l(t){s.find(".has-error").removeClass("has-error"),t.ok?s.find(".pa-messages").html(""):(s.find(".pa-messages").html(ie(2,ct(t.error))),t.errf&&s.find(".pa-gradevalue").each((function(){t.errf[this.name]&&d(this,"has-error")})))}function c(e){let n=!1,a={};if(s.find(".pa-gradevalue").each((function(){if((this.hasAttribute("data-pa-unmixed")||C(this))&&!this.indeterminate){let t,e=this.name,s=r.entries[e];t="checkbox"===this.type?this.checked?this.value:"":$(this).val();for(let n of i)a[n.uid]=a[n.uid]||{grades:{},oldgrades:{}},a[n.uid].grades[e]=t,a[n.uid].oldgrades[e]=s.value_in(n);n=!0}})),e=e||function(){s.close()},n)if(1===i.length)et(q("=api/grade",t.url_gradeparts(i[0])),a[i[0].uid]).then((function(n){l(n),n.ok&&(Dn(t,o,n,1),e())}));else{for(let t of i)t.grade_commit?(a[t.uid].commit=t.grade_commit,a[t.uid].commit_is_grade=1):t.commit&&(a[t.uid].commit=t.commit);et(q("=api/multigrade",{pset:t.key}),{us:JSON.stringify(a)}).then((function(n){if(l(n),n.ok){for(let e of n.us)Dn(t,o,e,1);e()}}))}else e()}function u(){const e={},n={};for(const e of t.gradesheet.value_entries())n[e.key]=null;for(let t of i){const a=e[t.uid]={};t.grade_commit?(a.commit=t.grade_commit,a.commit_is_grade=1):t.commit&&(a.commit=t.commit),a.autogrades=n}et(q("=api/multigrade",{pset:t.key}),{us:JSON.stringify(e)}).then((function(e){if(l(e),e.ok){for(let n of e.us)Dn(t,o,n,1);s.close()}}))}function p(){const t=this.getAttribute("data-pa-spos");c((function(){f([t])}))}function f(e){i=[];for(let n=0;n!==e.length;++n)i.push(t.smap[e[n]]);t.render_gdialog_users(s.find("h3")[0],i),1===i.length&&function(t){let e,a=n.tBodies[0].firstChild;for(;a&&a.getAttribute("data-pa-spos")!=t._spos;)a=a.nextSibling;for(e=a;e&&(e===a||!e.hasAttribute("data-pa-spos"));)e=e.previousSibling;for(s.find("button[name=prev]").attr("data-pa-spos",e?e.getAttribute("data-pa-spos"):"").prop("disabled",!e).removeClass("hidden"),e=a;e&&(e===a||!e.hasAttribute("data-pa-spos"));)e=e.nextSibling;s.find("button[name=next]").attr("data-pa-spos",e?e.getAttribute("data-pa-spos"):"").prop("disabled",!e).removeClass("hidden")}(i[0]),s.find(".pa-grade").each((function(){let t=this.getAttribute("data-pa-grade"),e=r.entries[t],n=e.value_order_in(r),a=i[0].grades[n],s={reset:!0,mixed:!1};for(let t=1;t!==i.length;++t){let e=i[t].grades[n];if(!(e===a||null==e&&""===a||""===e&&null==a)){a=null,s.mixed=!0;break}}e.update_at(this,a,s)}))}function m(t){let e;!t.ctrlKey||"n"!==t.key&&"p"!==t.key||!(e=s.find("button[name="+("n"===t.key?"next":"prev")+"]"))||e[0].disabled?"Return"===t.key||"Enter"===t.key?(c(null),t.stopImmediatePropagation(),t.preventDefault()):"Esc"===t.key||"Escape"===t.key?(t.stopImmediatePropagation(),t.preventDefault(),s.close()):"Backspace"===t.key&&this.hasAttribute("placeholder")&&this.closest(".pa-gradelist")&&g.call(this):(p.call(e[0]),t.stopImmediatePropagation(),t.preventDefault())}function g(){h(this,"has-error"),this.hasAttribute("placeholder")&&(this.setAttribute("data-pa-unmixed",1),this.removeAttribute("placeholder"),Sn.call(this))}function b(){const t=s.find(".pa-gradelist")[0];if(!t.firstChild){const e=ye.closest(t);for(const n of e.value_entries())n.readonly||t.appendChild(n.render(e,1))}s.find(".pa-gdialog-tab").addClass("hidden"),t.classList.remove("hidden"),s.find("button[name=bsubmit]").text("Save").removeClass("hidden")}function _(){const e=s.find(".pa-gdialog-settings")[0],n=e.closest("form"),a={};for(let t of i)a[t.uid]={uid:t.uid};if("save-gvis"===this.name){let t;$(e).find(".pa-gvis").each((function(){this.checked&&!this.indeterminate&&(t=JSON.parse(this.value))}));for(let e of i)a[e.uid].scores_visible=t}else if("save-grader"===this.name&&"clear"===n.elements.gradertype.value)for(let t of i)a[t.uid].gradercid=0;else if("save-grader"===this.name&&"previous"===n.elements.gradertype.value)for(let t of i)a[t.uid].gradercid="previous";else if("save-grader"===this.name){let t=[],n=[],s=0;if($(e).find(".pa-grader").each((function(){this.checked&&!this.indeterminate&&(t.push(+this.name.substring(6)),n.push(1),++s)})),s)for(let e of i){let i=Math.floor(Math.random()*s),r=0;for(;i>=n[r];)i-=Math.max(n[r],0),++r;if(a[e.uid].gradercid=t[r],s-=Math.min(n[r],1),--n[r],s<=0)for(r in s=0,n)++n[r],s+=Math.max(n[r],0)}}else if("save-repo"===this.name){const t=n.elements.clearrepo.checked,e=n.elements.adoptoldrepo.checked;for(let n of i)t&&(a[n.uid].clearrepo=!0),e&&(a[n.uid].adoptoldrepo=!0)}else if("save-dropped"===this.name){const t=n.querySelectorAll(".pa-dropped:checked");if(1!==t.length)return;for(let e of i)a[e.uid].dropped="true"===t[0].value}this.disabled=!0;const r=[];for(let t of i)r.push(a[t.uid]);const c=document.createElement("progress");c.max=r.length,c.className="float-right",this.after(c);let u=0;!function e(){const n=r.slice(u,u+16);u+=n.length,et(q("=api/gradesettings",{pset:t.key}),{us:JSON.stringify(n)},{timeout:2e4}).then((function(n){if(l(n),c.value=u,n.ok&&n.us)for(let e of n.us)Dn(t,o,e,3);n.ok&&u<r.length?e():s.close()}))}()}function v(){const t=s.find(".pa-gdialog-settings")[0];$(t).find(".pa-gvis").prop("checked",!1).prop("indeterminate",!1),this.checked=!0}function x(){const t=s.find(".pa-gdialog-settings")[0];$(t).find(".pa-dropped").prop("checked",!1).prop("indeterminate",!1),$(t).find("button[name=save-dropped]").prop("disabled",!1),this.checked=!0}function y(){const t=s.find(".pa-gdialog-settings")[0],e=this;$(t).find(".pa-grader:indeterminate").each((function(){e!==this&&this.indeterminate&&(this.checked=!1),this.indeterminate=!1})),this.checked?t.closest("form").elements.gradertype.value="set":setTimeout((function(){0===$(t).find(".pa-grader:checked").length&&(t.closest("form").elements.gradertype.value="clear")}),0)}function w(){s.find(".nav-pills button").removeClass("btn-primary"),"mode-settings"===this.name?function(){const e=s.find(".pa-gdialog-settings")[0],n=e.closest("form");if(!e.firstChild){const n=new A;n.push('<fieldset><legend>Grade visibility</legend><div class="multicol-3">',"</fieldset>"),n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="gvis" value="true" class="uic pa-gvis"></span>Visible</label>'),n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="gvis" value="false" class="uic pa-gvis"></span>Hidden</label>'),n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="gvis" value="null" class="uic pa-gvis"></span>Default ('+(t.scores_visible?"visible":"hidden")+")</label>"),n.push('</div><div class="popup-actions"><button type="button" class="btn btn-primary" name="save-gvis">Save</button></div>'),n.pop(),n.push('<fieldset class="mt-3"><legend>Grader</legend>',"</fieldset>"),n.push('<label class="checki"><span class="checkc"><input type="radio" name="gradertype" value="clear" class="uic"></span>Clear</label>'),n.push('<label class="checki"><span class="checkc"><input type="radio" name="gradertype" value="set" class="uic"></span>Set grader</label>'),n.push('<div class="checki mt-1 multicol-3">',"</div>");for(let t=0;t!==siteinfo.pc.__order__.length;++t){const e=siteinfo.pc.__order__[t],a=siteinfo.pc[e];n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="grader'.concat(e,'" class="uic js-range-click pa-grader" data-range-type="grader"></span>',ct(a.name),'<span class="ct small dim"></span></label>'))}n.pop(),n.push('<div class="popup-actions"><button type="button" class="btn btn-primary" name="save-grader">Save</button></div>'),n.pop(),t.gitless||(n.push('<fieldset class="mt-3"><legend>Repository</legend>',"</fieldset>"),n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="clearrepo" value="1" class="uic"></span>Clear repository</label>'),t.has_older_repo&&n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="adoptoldrepo" value="1" class="uic"></span>Adopt previous repository</label>'),n.push('<div class="popup-actions"><button type="button" class="btn btn-primary" name="save-repo">Save</button></div>'),n.pop()),siteinfo.user.is_admin&&(n.push('<fieldset class="mt-3"><legend>Enrollment</legend><div class="multicol-2">',"</fieldset>"),n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="dropped" value="false" class="uic pa-dropped"></span>Enrolled</label>'),n.push('<label class="checki"><span class="checkc"><input type="checkbox" name="dropped" value="true" class="uic pa-dropped"></span>Dropped</label>'),n.push('</div><div class="popup-actions"><button type="button" class="btn btn-primary" name="save-dropped">Save</button></div>'),n.pop()),e.innerHTML=n.render(),$(e).on("click","button",_),$(e).on("click",".pa-grader",y),$(e).on("click",".pa-gvis",v),$(e).on("click",".pa-dropped",x)}const a={},r={},o={},l={};for(let t of i){t.scores_visible_pinned?t.scores_visible?a.true=(a.true||0)+1:a.false=(a.false||0)+1:a.null=(a.null||0)+1;const e=t.gradercid||0;r[e]=(r[e]||0)+1;const n=t.dropped?"true":"false";l[n]=(l[n]||0)+1}for(let e of t.smap)if(e){const t=e.gradercid||0;o[t]=(o[t]||0)+1}$(e).find("input").prop("checked",!1).prop("indeterminate",!1);for(let t in a)$(e).find(".pa-gvis[value="+t+"]").prop("checked",!!a[t]).prop("indeterminate",a[t]&&a[t]!==i.length);$(e).find("input[name=gradertype][value="+((r[0]||0)===i.length?"clear":"set")+"]").prop("checked",!0);for(let t in r)if(0!=t){const e=n.elements["grader"+t];e.checked=!0,e.indeterminate=r[t]!==i.length}$(e).find(".pa-grader").each((function(){const t=+this.name.substring(6),e=r[t]||0,n=o[t]||0;this.closest(".checki").lastChild.textContent=n&&e===n?" (".concat(n,")"):n?" (".concat(e,"/",n,")"):""}));for(let t in l)$(e).find(".pa-dropped[value="+t+"]").prop("checked",!!l[t]).prop("indeterminate",l[t]&&l[t]!==i.length);l.true&&l.false&&$(e).find("button[name=save-dropped]").prop("disabled",!0),s.find(".pa-gdialog-tab").addClass("hidden"),e.classList.remove("hidden"),s.find("button[name=bsubmit]").addClass("hidden")}():b(),this.classList.add("btn-primary")}!function(){const n=En();n.push('<h2 class="pa-home-pset">'+ct(t.title)+" Grades</h2>"),n.push('<h3 class="gdialog-userids hidden"></h3>'),n.push('<div class="pa-messages"></div>'),n.push('<div class="nav-pills">',"</div>"),n.push('<button type="button" class="btn btn-primary no-focus is-mode" name="mode-values">Values</button>'),n.push('<button type="button" class="btn no-focus is-mode" name="mode-settings">Settings</button>'),n.pop(),n.push('<div class="pa-gdialog-tab pa-gradelist is-modal"></div>'),n.push('<div class="pa-gdialog-tab pa-gdialog-settings hidden"></div>'),n.push_actions(),n.push('<button type="button" name="bsubmit" class="btn-primary">Save</button>'),n.push('<button type="button" name="cancel">Cancel</button>'),n.push('<span class="btnbox btnl"><button type="button" name="prev" class="btnl">&lt;</button><button type="button" name="next" class="btnl">&gt;</button></span>'),n.push('<button type="button" name="clearauto" class="btnl">Clear autogrades</button>'),s=n.show(!1),s.children(".modal-dialog").addClass("modal-dialog-wide");const i=s.find("form")[0];d(i,"pa-psetinfo"),i.pa__gradesheet=t.gradesheet,b(),s.on("click",".pa-gdialog-section",Fn),s.on("change blur",".pa-gradevalue",Sn),s.on("input change",".pa-gradevalue",g),s.on("keydown",m),s.on("keydown","input, textarea, select",m),s.find("button[name=bsubmit]").on("click",(function(){c(null)})),s.find("button[name=clearauto]").on("click",u),s.find("button[name=prev], button[name=next]").on("click",p),s.find("button.is-mode").on("click",w),s.find("button[name=prev], button[name=next]").prop("disabled",!0).addClass("hidden"),f(e),a&&i.elements[a]&&(d(i.elements[a],"want-focus"),d(i.elements[a],"want-select")),n.show()}()}function Tn(t){if("click"===t.type&&!t.shiftKey){const t=this.checked;let e=this.closest("label");for(;e=e.nextSibling;){const n=e.firstChild.firstChild;if(n.classList.contains("pa-gdialog-section"))break;n.checked=t}}}function jn(t,e){let n,a,s=t.gradesheet;function i(){const t=[];for(const n of e)t.push(n.uid);return t.join(" ")}function r(){u(a.elements["mode-diff"],"btn-primary")?function(){const e=a.elements.diff.value,n={pset:t.key,anonymous:t.anonymous?1:"",users:i()};if("other"===e&&a.elements.otherdiff.value)n.files=a.elements.otherdiff.value.trim();else if(e.startsWith("file:")&&e.length>5)n.file=e.substring(5);else if(e.startsWith("grade:")&&e.length>6){const t=s.entries[e.substring(6)];t.landmark_range_file?(n.file=t.landmark_range_file,n.lines=t.landmark_range_first+"-"+t.landmark_range_last):n.grade=t.key}H("diffmany",n)}():u(a.elements["mode-gradesheet"],"btn-primary")?function(){const e=n.find(".pa-gdialog-gradesheet input"),a=[];for(let t=0;t!==e.length;++t)e[t].checked&&a.push(s.entries[e[t].name]);if(0===a.length)alert("No grades selected.");else{const e={pset:t.key,anonymous:t.anonymous?1:"",users:i()};1===a.length&&a[0].landmark_range_file&&(e.file=a[0].landmark_range_file,e.lines=a[0].landmark_range_first+"-"+a[0].landmark_range_last),e.grade=a[0].key;for(let t=1;t!==a.length;++t)e.grade+=" "+a[t].key;H("diffmany",e)}}():H("report",{pset:t.key,anonymous:t.anonymous?1:"",users:i(),report:a.elements.report.value||"default"})}function o(t){"Return"===t.key||"Enter"===t.key?(r(),t.stopImmediatePropagation(),t.preventDefault()):"Esc"!==t.key&&"Escape"!==t.key||(t.stopImmediatePropagation(),t.preventDefault(),n.close())}function l(){const e=n.find(".pa-gdialog-diff")[0];if(!e.firstChild){const n=new A;n.push('<label class="checki"><span class="checkc"><input type="radio" name="diff" value="all" checked></span><strong>Full diffs</strong></label>');let a=" mt-2";for(const e of t.diff_files)n.push('<label class="checki'.concat(a,'"><span class="checkc"><input type="radio" name="diff" value="file:',ct(e),'"></span>',ct(e)," diffs</label>")),a="";a=" mt-2";for(const t of s.order){const e=s.entries[t];e.collate&&(n.push('<label class="checki'.concat(a,'"><span class="checkc"><input type="radio" name="diff" value="grade:',ct(e.key),'"></span>',e.title_html,"</label>")),a="")}t.gitless||n.push('<label class="checki mt-2"><span class="checkc"><input type="radio" name="diff" value="other"></span>Diffs in <input type="text" name="otherdiff" size="30" class="ml-2"></label>'),e.innerHTML=n.render()}n.find(".pa-gdialog-tab").addClass("hidden"),e.classList.remove("hidden"),a.elements.bsubmit.textContent="Show diffs"}function c(){n.find(".nav-pills button").removeClass("btn-primary"),"mode-report"===this.name?function(){const e=n.find(".pa-gdialog-report")[0];if(!e.firstChild){const n=new A;n.push('<label class="checki"><span class="checkc"><input type="radio" name="report" value="default" checked></span>Grades</label>'),t.gitless||n.push('<label class="checki"><span class="checkc"><input type="radio" name="report" value="git"></span>Git information</label>');for(const e of t.reports)n.push('<label class="checki"><span class="checkc"><input type="radio" name="report" value="',ct(e.key),'"></span>',ct(e.title),"</label>");e.innerHTML=n.render()}n.find(".pa-gdialog-tab").addClass("hidden"),e.classList.remove("hidden"),a.elements.bsubmit.textContent="Download"}():"mode-gradesheet"===this.name?function(){const t=n.find(".pa-gdialog-gradesheet")[0];if(!t.firstChild){const e=new A;let n=!1;for(const t of s.order){const a=s.entries[t],i=n&&"section"!==a.type?"checki ml-4":"checki",r="section"===a.type?" pa-gdialog-section":"";e.push('<label class="'.concat(i,'"><span class="checkc"><input type="checkbox" name="',a.key,'" class="uic js-range-click',r,'" data-range-type="mge"></span>',a.title_html,"</label>")),n=n||"section"===a.type}t.innerHTML=e.render()}n.find(".pa-gdialog-tab").addClass("hidden"),t.classList.remove("hidden"),a.elements.bsubmit.textContent="Edit gradesheet"}():l(),this.classList.add("btn-primary")}!function(){const e=En();e.push('<h2 class="pa-home-pset">'+ct(t.title)+" Diffs</h2>"),e.push('<h3 class="gdialog-userids hidden"></h3>'),e.push('<div class="pa-messages"></div>'),e.push('<div class="nav-pills">',"</div>"),e.push('<button type="button" class="btn btn-primary no-focus is-mode" name="mode-diff">Diff</button>'),e.push('<button type="button" class="btn no-focus is-mode" name="mode-gradesheet">Gradesheet</button>'),e.push('<button type="button" class="btn no-focus is-mode" name="mode-report">Reports</button>'),e.pop(),e.push('<div class="pa-gdialog-tab pa-gdialog-diff is-modal"></div>'),e.push('<div class="pa-gdialog-tab pa-gdialog-gradesheet multicol-3 hidden"></div>'),e.push('<div class="pa-gdialog-tab pa-gdialog-report hidden"></div>'),e.push_actions(),e.push('<button type="button" name="bsubmit" class="btn-primary">Save</button>'),e.push('<button type="button" name="cancel">Cancel</button>'),n=e.show(!1),n.children(".modal-dialog").addClass("modal-dialog-wide"),a=n.find("form")[0],d(a,"pa-psetinfo"),a.pa__gradesheet=t.gradesheet,l(),n.on("click",".pa-gdialog-section",Tn),n.on("keydown",o),n.on("keydown","input, textarea, select",o),$(a.elements.bsubmit).on("click",r),n.find("button.is-mode").on("click",c),e.show()}()}function Ln(t,e){return null!=t.first&&null!=t.last?e?t.last.concat(", ",t.first):t.first.concat(" ",t.last):null!=t.first?t.first:null!=t.last?t.last:""}function zn(t){return t.__nickname||(t.nick?t.__nickname=t.nick:t.nicklen||t.lastpos?t.__nickname=t.name.substr(0,t.nicklen||t.lastpos-1):t.__nickname=t.name),t.__nickname}function On(t,e){return t?"number"==typeof t?t>=1&&t<=20&&Math.floor(t)===t?String.fromCharCode(9311+t):t.toString():1===t.length&&t>="A"&&t<="Z"?String.fromCharCode(9333+t.charCodeAt(0)):e?ct(t):t:""}function Bn(t,e){return t._sort_user.localeCompare(e._sort_user)}function In(t,e){const n=t.gradercid?siteinfo.pc[t.gradercid]:null,a=e.gradercid?siteinfo.pc[e.gradercid]:null,s=n&&zn(n)||"~~~",i=a&&zn(a)||"~~~";return s!=i?s<i?-1:1:0}function Pn(t){const e=document.createElement("strong");return e.className="err",e.append(t),e}function Rn(t){"A"===t.target.tagName&&t.target.classList.contains("pa-user")&&("mouseenter"===t.type?Et.enter(t.target,"pa-ptable-user"):Et.leave(t.target))}pe.add("timermark",{text:function(t){return null==t||0===t?"–":i(wn,t)},simple_text:pe.basic_text,tcell:function(t){return null==t||0===t?"":i(wn,t)},tcell_width:10,make_compare:function(t){const e=t.gidx;return function(t,n){const a=t.grades&&t.grades[e],s=n.grades&&n.grades[e];if(""===a||null==a||0==a||""===s||null==s||0==s){if(""!==a&&null!=a&&0!=a)return-1;if(""!==s&&null!=s&&0!=s)return 1}else{if(a<s)return-1;if(a>s)return 1}return t._sort_user.localeCompare(n._sort_user)}},mount_show:function(t,e){t.id=e,d(t,"pa-gradevalue")},update_show:function(t,e,n){const a=n.gradesheet;if(null==e||0===e)t.textContent="";else{let n=[i(wn,e)];if(a&&(a.student_timestamp||0)>e){const t=i(wn,a.student_timestamp),s=a.student_timestamp-e,o=kn(this,a);if(o&&s>o+120){n[0]=n[0].concat(" → ",t," ");const e=document.createElement("strong");e.className="overdue",e.textContent="("+r(s)+" later)",n.push(e)}else n[0]=n[0].concat(" → ",t," (",r(s)," later)")}t.replaceChildren(...n)}return!1},mount_edit:function(t){h(t,"pa-gradevalue");const e=document.createElement("button");e.type="button",e.className="ui js-timermark hidden mr-2",e.name=this.key+":b",e.value=1,e.disabled=this.disabled,e.append("Press to start");const n=new DocumentFragment;if(n.append(e),siteinfo.user.is_pclike){const t=document.createElement("button");t.type="button",t.className="ui js-timermark hidden mr-2",t.name=this.key+":r",t.value=0,t.disabled=this.disabled,t.append("Reset"),n.append(t)}const a=document.createElement("span");a.className="pa-timermark-result hidden";const s=document.createElement("input");return s.type="hidden",s.className="uich pa-gradevalue",s.name=this.key,n.append(a,s),n},unmount:function(t){Cn(this,t.querySelector(".pa-timermark-result"),!1),t.remove()},update_edit:function(t,e,n){const a=n.gradesheet;let s=kn(this,a);t.querySelectorAll(".js-timermark").forEach((function(t){t.classList.toggle("hidden",!e!=("1"===t.value))}));const o=t.querySelector(".pa-timermark-result");o.classList.toggle("hidden",!e&&!s),Cn(this,o,!0);let l=i(wn,e);if(e&&s&&e+s+600>+document.body.getAttribute("data-now")){An({deadline:e+s+ +document.body.getAttribute("data-time-skew"),start_at_text:l,timeout:s,tmelt:o,stelt:o.pa__tmsticky})}else e?(a&&(a.student_timestamp||0)>e&&(l=l.concat(" (updated ",r(a.student_timestamp-e)," later at ",i(wn,a.student_timestamp),")")),o.textContent=l):s&&(o.textContent="Time once started: "+r(s))},justify:"left",sort:"forward"}),_.on("js-timermark",(function(){const t=this.name.indexOf(":"),e=this.name.substring(0,t),n=this.closest("form").elements[e];n.value=this.value,$(n).trigger("change")})),_.on("js-gdialog",(function(){const t=this.closest("form"),e=t.pa__ptconf,n=e.users_in(t,e.CHECKED_USERS);if(0===n.length)alert("Select one or more students first");else{const a=[];for(const t of n)a.push(t._spos);Mn(e,a,t.querySelector("table.gtable"))}})),_.on("js-ptable-diff",(function(){const t=this.closest("form"),e=t.pa__ptconf;jn(e,e.users_in(t,e.SOME_USERS))}));class qn{constructor(t,e){this.id=t.id,this.key=t.key,this.title=t.title,this.gitless=!!t.gitless,this.gitless_grades=!!t.gitless_grades,this.has_older_repo=!!t.has_older_repo,this.disabled=!!t.disabled,this.visible=!!t.visible,this.scores_visible=!!t.scores_visible,this.frozen=!!t.frozen,this.anonymous=this.original_anonymous=!!t.anonymous,this.has_nonanonymous=!this.anonymous||t.has_nonanonymous,this.overridable_anonymous=this.anonymous&&t.overridable_anonymous,this.flagged_commits=t.flagged_commits,this.sort={f:this.flagged_commits?"at":"name",last:!1,rev:1,u:"name"},this.no_sort=t.no_sort,this.checkbox=!!t.checkbox,this.grades=t.grades,this.need_total=!!t.need_total,this.total_key=t.total_key,this.runners=t.runners||[],this.diff_files=t.diff_files||[],this.reports=t.reports||[],this.requested_columns=t.col||null,this.col=[],this.pincol=[],this.colmap={},this.data=e,this.mode=0,this.smap=[null],this.uidmap=[]}set_gradesheet(t){this.gradesheet=t,this.in_total_indexes=[],this.answer_indexes=[];for(let e=0;e!==t.value_order.length;++e){const n=t.entries[t.value_order[e]];n.answer?this.answer_indexes.push(e):n.in_total&&n.key!==this.total_key&&this.in_total_indexes.push(e)}}add_column(t){t.index=this.col.length,this.col.push(t),this.colmap[t.name]=this.colmap[t.name]||t,t.pin&&(t.pin_index=this.pincol.length,this.pincol.push(t))}get columns(){return this.col}get pinned_columns(){return this.pincol}columns_in(t){return t.classList.contains("gtable-left-pin")?this.pincol:this.col}column_index_in(t,e){const n=this.colmap[t];if(!n)return-1;const a=e.classList.contains("gtable-left-pin")?"pin_index":"index";return null!=n[a]?n[a]:-1}ukey(t){return this.anonymous&&t.anon_user||t.user||""}url_gradeparts(t){const e={u:this.ukey(t),pset:t.pset||this.key};return!t.commit||t.is_grade&&!this.flagged_commits?t.grade_commit&&(e.commit=t.grade_commit,e.commit_is_grade=1):e.commit=t.commit,e}href(t){return q("pset",this.url_gradeparts(t))}make_student_ae(t){const e=document.createElement("a");return e.href=q("index",{u:this.ukey(t)}),e.className="track",e}make_pset_ae(t){const e=document.createElement("a");return e.href=this.href(t),e.className="pa-user track"+(t.dropped?" gt-dropped":""),e}render_username_td(t,e){const n=this.make_pset_ae(e);this.anonymous&&e.anon_user?n.append(e.anon_user):this.sort.email&&e.email?n.append(e.email):e.user&&n.append(e.user),t.replaceChildren(n)}render_user_td(t,e){const n=this.make_pset_ae(e),a=this.sort;this.anonymous&&e.anon_user?n.append(e.anon_user):"email"===a.u&&e.email?n.append(e.email):"name"===a.u?n.append(Ln(e,a.last)):n.append(e.user),t.replaceChildren(n)}render_display_name(t,e,n){const a=n&&this.anonymous?e.anon_user||"?":Ln(e,this.sort.last);if(n){const n=this.make_pset_ae(e);n.textContent=a,t.replaceChildren(n)}else t.replaceChildren(a)}render_tooltip_name(t){return t?this.anonymous&&t.anon_user?t.anon_user:"email"===this.sort.u&&t.email?t.email:"name"===this.sort.u?Ln(t,!1):t.user:"???"}render_checkbox_name(t){let e=this.anonymous&&t.anon_user||t.user;return"s:"+encodeURIComponent(e).replace(/\./g,"%2E")}render_table_row(t,e){this.mode=e;const n=document.createElement("tr");n.className="gt",n.setAttribute("data-pa-spos",t._spos),t.uid&&n.setAttribute("data-pa-uid",t.uid),2&e&&n.classList.add("kfade"),1&e&&(n.classList.add("gtrow-partner"),n.setAttribute("data-pa-partner",1));const a=2&e?this.pincol:this.col;for(const e of a){const a=document.createElement("td");e.td.call(e,a,t),n.appendChild(a)}return n}render_gdialog_users(t,e){if(e.length===this.data.length||0===e.length)d(t,"hidden");else{h(t,"hidden");let n=0,a=[],s=20===e.length?20:19;for(;n<s&&n<e.length;)a.push(this.render_tooltip_name(e[n])),++n;n<e.length&&a.push("(".concat(e.length-n," more)")),t.replaceChildren(a.join(", "))}}push(t){t._spos=this.smap.length,this.smap.push(t),t.uid>0&&(t.uid>=this.uidmap.length&&(this.uidmap.length=t.uid+1),this.uidmap[t.uid]=t)}user_row_checkbox(t){const e=u(t.parentElement.parentElement,"gtable-left-pin"),n=this.colmap.checkbox[e?"pin_index":"index"];return null!=n?t.children[n].firstChild:null}get ALL_USERS(){return 0}get CHECKED_USERS(){return 1}get SOME_USERS(){return 2}users_in(t,e){const n=t.querySelector("table.gtable"),a=this.colmap.checkbox.index,s=[],i=[];for(let t=n.tBodies[0].firstChild;t;t=t.nextSibling){const n=t.getAttribute("data-pa-spos"),r=n?this.smap[n]:null;r&&(s.push(r),e&&t.children[a].firstChild.checked&&i.push(r))}return 2===e?i.length>0?i:s:1===e?i:s}}function Hn(t){let e=t.target;for(;e!==this&&"TH"!==e.tagName&&"BUTTON"!==e.tagName&&"A"!==e.tagName;)e=e.parentElement;const n=function(t){if("TH"===t.tagName?!t.hasAttribute("data-pa-sort"):"BUTTON"!==t.tagName||!t.classList.contains("js-switch-anon"))return null;const e=t.closest("form").pa__ptconf,n=Object.assign({},e.sort);if("BUTTON"===t.tagName)return e.overridable_anonymous?(n.deblind?delete n.deblind:n.deblind=(new Date).getTime()/1e3,n):null;const a=t.getAttribute("data-pa-sort");if(a!==n.f){n.f=a;const t=e.colmap[a];n.rev=t&&t.sort_forward?1:-1,"name"===a?n.u="name":"name2"===a?n.u=e.anonymous?"user":"name":"email"===a?n.u="email":"username"===a&&(e.anonymous&&!e.has_nonanonymous||!n.email?n.u="user":n.u="email")}else n.rev=-n.rev,1===n.rev&&("name"===a?n.last=!n.last:e.anonymous&&!e.has_nonanonymous||("name2"===a?n.last=!n.last:"username"===a?n.email?(n.u="user",delete n.email):(n.u="email",n.email=!0):"user"===a&&("name"===n.u?(n.last=!n.last,n.last||(n.u="email")):"email"===n.u?n.u="user":n.u="name")));return n}(e);n&&e.closest("form").dispatchEvent(new CustomEvent("sortchange",{bubbles:!0,cancelable:!0,detail:{sort:n}}))}function Wn(t){let e=t.target;for(;e!==this&&"TD"!==e.tagName;)e=e.parentElement;if("TD"!==e.tagName)return;let n=0;for(let t=e.parentElement.firstChild;t!==e;t=t.nextSibling)++n;const a=e.closest("form").pa__ptconf,s=a.col[n].ge,i=e.closest("tr");!s||s.readonly||!i.hasAttribute("data-pa-spos")||t.shiftKey||t.ctrlKey||Mn(a,[+i.getAttribute("data-pa-spos")],e.closest("table"),s.key)}function Un(t){if(!window.IntersectionObserver||t.rows.length<=10)return null;const e=t.closest(".gtable-container-2"),n=e.parentElement.parentElement,a=document.createElement("table");a.className=t.className,a.classList.add("gtable-top-pin"),a.classList.remove("gtable"),a.style.width=t.style.width,a.appendChild(t.tHead.cloneNode(!0));const s=t.tHead.getBoundingClientRect(),i=n.getBoundingClientRect(),r=e.getBoundingClientRect();if(t.style.marginTop=-s.height-.5+"px",t.tHead.style.visibility="hidden",!u(n.firstChild,"gtable-container-headers")){const t=document.createElement("div");t.className="gtable-container-headers",t.style.marginLeft=r.left-i.left+"px",t.scrollLeft=e.scrollLeft,n.prepend(t),e.addEventListener("scroll",function(t){return function(){t.scrollLeft=this.scrollLeft,u(t.lastChild,"gtable-left-pin")&&(t.lastChild.style.left=this.scrollLeft+"px")}}(t),{passive:!0})}const o=n.firstChild;return u(a,"gtable-left-pin")&&(a.style.left=o.scrollLeft+"px"),o.append(a),a.tHead.addEventListener("click",Hn),a}function Kn(t,e){if(e.overridable_anonymous){const e=document.createElement("button");e.type="button",e.className="btn-ulink n js-switch-anon",e.append("[anon]"),t.append(" ",e)}else if(e.original_anonymous){const e=document.createElement("span");e.className="n",e.append("[anon]"),t.append(" ",e)}}function Zn(t,e,n){const a=document.createElement("tr");let s,i=0;a.className="gtable-headrow gt k0";for(const e of t){const t=document.createElement("th");if(t.scope="col",(e.compare||e.make_compare)&&(t.className="plsortable",t.setAttribute("data-pa-sort",e.name)),e.th.call(e,t),n){let n=e.tw;"number"!=typeof n&&(n=n.call(e)),null==s&&(s=parseFloat(window.getComputedStyle(document.documentElement).fontSize)),n*=s,null==e.left&&(e.left=i),e.width=n,t.style.width=n+"px",i+=n}a.appendChild(t)}const r=document.createElement("thead");return r.append(a),r}const Jn={rownumber:{th:function(t){t.classList.add("gt-rownumber")},td:function(t){t.className="gt-rownumber"},tw:function(){return.75*Math.ceil(Math.log10(Math.max(this.ptconf.data.length,1)))}},checkbox:{th:function(t){t.classList.add("gt-checkbox");const e=document.createElement("input");e.type="checkbox",e.className="uic js-range-click is-range-group ignore-diff",e.ariaLabel="Select all",e.setAttribute("data-range-type","s61"),t.appendChild(e)},td:function(t,e){if(1&this.ptconf.mode)return;t.className="gt-checkbox";let n=document.createElement("input");n.type="checkbox",n.value=1,2&this.ptconf.mode?(n.className="uic js-range-click",n.setAttribute("data-range-type","s61o")):(n.name=this.ptconf.render_checkbox_name(e),n.className=this.className||"uic js-range-click papsel",n.setAttribute("data-range-type","s61")),t.appendChild(n)},tw:2,pin:!0},flagcheckbox:{th:function(t){t.className="gt-checkbox"},td:function(t,e){if(this.ptconf.mode)return;t.className="gt-checkbox";let n=document.createElement("input");n.type="checkbox",n.name="s:"+e._spos,n.value=1,n.className=this.className||"uic js-range-click papsel",n.setAttribute("data-range-type","s61"),t.appendChild(n)},tw:2,pin:!0},pset:{th:function(t){t.classList.add("gt-pset","l"),t.append("Pset")},td:function(t,e){t.className="gt-pset";let n=document.createElement("a");n.href=this.ptconf.href(e),n.classname="track",n.append(siteinfo.psets[e.pset].title+(e.commit?"/"+e.commit.substr(0,7):"")),t.append(n)},tw:8,sort_forward:!0,compare:function(t,e){return t.pset!=e.pset?siteinfo.psets[t.pset].pos<siteinfo.psets[e.pset].pos?-1:1:t.pos<e.pos?-1:1}},user:{th:function(t){let e=t.firstChild;e||(t.classList.add("gt-user","l"),t.appendChild(e=document.createElement("span")),e.className="heading",Kn(t,this.ptconf)),this.ptconf.anonymous||"user"===this.ptconf.sort.u?e.replaceChildren("Username"):"email"===this.ptconf.sort.u?e.replaceChildren("Email"):e.replaceChildren("Name")},td:function(t,e){t.className="gt-user",this.ptconf.render_user_td(t,e)},tw:14,pin:!0,sort_forward:!0,compare:!0,refreshable:2},username:{th:function(t){let e=t.firstChild;e||(t.classList.add("gt-username","l"),t.appendChild(e=document.createElement("span")),e.className="heading",Kn(t,this.ptconf)),this.ptconf.anonymous||!this.ptconf.sort.email?e.replaceChildren("Username"):e.replaceChildren("Email")},td:function(t,e){t.className="gt-username",this.ptconf.render_username_td(t,e)},tw:12,pin:!0,sort_forward:!0,compare:!0,refreshable:2},name:{th:function(t){t.classList.add("gt-name","l"),t.replaceChildren("Name")},td:function(t,e){t.className="gt-name",this.ptconf.render_display_name(t,e,!1)},tw:14,sort_forward:!0,compare:!0,refreshable:2},name2:{th:function(t){let e=t.firstChild;e||(t.classList.add("gt-name2","l"),t.appendChild(e=document.createElement("span")),e.className="heading",Kn(t,this.ptconf)),this.ptconf.anonymous?e.replaceChildren("Username"):e.replaceChildren("Name")},td:function(t,e){t.className="gt-name2",this.ptconf.render_display_name(t,e,!0)},tw:14,sort_forward:!0,compare:!0,refreshable:2},at:{th:function(t){t.classList.add("gt-at","l"),t.replaceChildren("Flagged")},td:function(t,e){t.className="gt-at",e.at&&t.append(i("%#e %b %#k:%M",e.at))},tw:8,sort_forward:!0,compare:function(t,e){return t.at!=e.at?t.at<e.at?-1:1:t.pos<e.pos?-1:1}},extension:{th:function(t){t.classList.add("gt-extension"),t.replaceChildren("X?")},td:function(t,e){t.className="gt-extension",e.x&&t.append("X")},tw:2,sort_forward:!0,compare:function(t,e){return t.x!=e.x?t.x?-1:1:Bn(t,e)}},year:{th:function(t){t.classList.add("gt-year"),t.replaceChildren("Yr")},td:function(t,e){t.className="gt-year c",t.replaceChildren(On(e.year))},tw:2,sort_forward:!0,compare:function(t,e){return t.year!=e.year?t.year&&e.year?typeof t.year!=typeof e.year?"number"==typeof t.year?-1:1:t.year<e.year?-1:1:t.year?-1:1:Bn(t,e)}},grader:{th:function(t){t.classList.add("gt-grader","l"),t.replaceChildren("Grader")},td:function(t,e){t.className="gt-grader",e.gradercid&&siteinfo.pc[e.gradercid]?t.replaceChildren(zn(siteinfo.pc[e.gradercid])):e.gradercid&&t.replaceChildren("???")},tw:6,sort_forward:!0,compare:function(t,e){return In(t,e)||Bn(t,e)},refreshable:2},latehours:{th:function(t){t.classList.add("gt-latehours","r"),t.title="Late",t.replaceChildren("⏰")},td:function(t,e){t.className="gt-latehours r",t.replaceChildren(e.late_hours||"")},tw:2.5,compare:function(t,e){return t.late_hours!=e.late_hours?(t.late_hours||0)-(e.late_hours||0):Bn(t,e)},refreshable:1},notes:{th:function(t){t.classList.add("gt-notes"),t.replaceChildren("⎚")},td:function(t,e){t.className="gt-notes c";let n=e.scores_visible?"⎚":"";e.grade_commit&&e.grade_commit===e.commit&&this.ptconf.flagged_commits&&(n+="✱"),e.has_notes&&(n+="♪"),e.has_nongrader_notes&&!this.ptconf.flagged_commits&&(n+="+"),t.replaceChildren(n)},tw:2,refreshable:1},total:{th:function(t){t.classList.add("gt-total","r"),t.replaceChildren("Tot")},td:function(t,e){t.className="gt-total r",t.replaceChildren(null!=e.total?e.total+"":"")},compare:function(t,e){if(null==t.total||null==e.total){if(null!=t.total)return 1;if(null!=e.total)return-1}else if(t.total!=e.total)return t.total<e.total?-1:1;return-Bn(t,e)},tw:3.5,refreshable:1},grade:{th:function(t){t.classList.add(...this.className.split(/\s+/)),t.title=this.ge.title_text,t.replaceChildren(this.ge.abbr())},td:function(t,e){const n=e.grades[this.gidx];t.className=this.className,e.autogrades&&null!=e.autogrades[this.gidx]&&e.autogrades[this.gidx]!==n&&(t.className+=" gt-highlight"),t.replaceChildren(this.ge.tcell(n))},tw:function(){const t=.5*this.ge.abbr().length+1.5;return Math.max(t,this.ge.tcell_width())},refreshable:1},ngrades:{th:function(t){t.classList.add("gt-ngrades","r"),t.replaceChildren("#G")},td:function(t,e){t.className="gt-ngrades r",t.replaceChildren(e.ngrades?e.ngrades+"":"")},tw:2,sort_forward:!0,compare:function(t,e){return t.ngrades!==e.ngrades?t.ngrades<e.ngrades?-1:1:-Bn(t,e)},refreshable:1},repo:{th:function(){},td:function(t,e){if(t.className="gt-repo",!e.repo)return;const n=document.createElement("a");this.ptconf.anonymous?(n.className="ui pa-anonymized-link",n.href="",n.setAttribute("data-pa-link",e.repo)):(n.className="track",n.href=e.repo),n.append("repo"),t.replaceChildren(n),e.repo_broken&&t.append(" ",Pn("broken")),e.repo_unconfirmed&&t.append(" ",Pn("unconfirmed")),e.repo_too_open&&t.append(" ",Pn("open")),e.repo_handout_old&&t.append(" ",Pn("handout")),e.repo_partner_error&&t.append(" ",Pn("partner")),e.repo_sharing&&t.append(" ",Pn("sharing"))},tw:10},conversation:{th:function(t){t.classList.add("gt-conversation","l"),t.replaceChildren("Flag")},td:function(t,e){t.className="gt-conversation l",e.conversation?t.append(e.conversation):e.conversation_pfx&&t.append(e.conversation_pfx+"…")},compare:function(t,e){const n=t.conversation||t.conversation_pfx||"",a=e.conversation||e.conversation_pfx||"";return""===n||""===a?n===a?0:""===n?1:-1:n.localeCompare(a)},sort_forward:!0,tw:20}};function Gn(t,e,n){const a=[];for(let s=0;s!==e.length;++s){const i=e[s],r=t.column_index_in(n,i);r>=0&&a.push({table:i,index:r})}return a}function Yn(t,e,...n){for(const a of n){const n=t.colmap[a];for(const s of Gn(t,e,a)){const e=s.table,a=s.index;if(e.tBodies.length>0)for(let s=e.tBodies[0].firstChild;s;s=s.nextSibling){const e=s.getAttribute("data-pa-spos");if(e){const i=t.smap[e],r=s.children[a];n.td.call(n,r,i)}}n.th.call(n,e.tHead.firstChild.children[a])}}}function Vn(t){"s61"===t.detail.rangeType&&$(this).find(".js-gdialog").prop("disabled",!t.detail.newState)}function Xn(t){const e=document.createElement("tr");e.className="gt-boring";const n=document.createElement("td");return n.colSpan=t.rows[0].childNodes.length,n.appendChild(document.createElement("hr")),e.appendChild(n),e}function Qn(t,e,n){const a=e.tBodies[0],s=function(t){const e={};let n=t.tBodies[0].firstChild;for(;n;)e[n.getAttribute("data-pa-spos")]=n,n=n.nextSibling;return e}(e),i=e.classList.contains("gtable-left-pin")?2:0,r=["k0","k1"];let o=!1,l=0,c=a.firstChild;for(let u=0;u!==n.length;++u){const d=n[u];for(d.boringness!==o&&!1!==o&&(c&&"gt-boring"===c.className?c=c.nextSibling:a.insertBefore(Xn(e),c)),o=d.boringness;c&&"gt-boring"===c.className;){const t=c;c=c.nextSibling,a.removeChild(t)}++l;for(const e of d.partners?[d,...d.partners]:[d]){const n=s[e._spos]||t.render_table_row(d,d===e?i:1|i);n!==c?a.insertBefore(n,c):c=c.nextSibling,n.classList.remove(r[1&(1^l)]),n.classList.add(r[1&l])}}}function ta(n){const a=this,s=$(a),i=n.smap;let r,o,l,c=$(a),f=null,m=null,g=null,b=null,_=-1,v=n.data;function x(t){const e=[];for(const t of v){let a="~".concat(encodeURIComponent(n.ukey(t)));n.flagged_commits&&(a=a.concat("/pset/",t.pset),t.commit&&(a=a.concat("/",t.commit))),e.push(a)}t.detail.hotlist={pset:n.flagged_commits?null:n.key,items:e}}function y(){for(var t=[],e=0;e!==v.length;++e)t.push(n.ukey(v[e]));r.value=t.join(" ")}function w(){const t=l.rownumber.index;let e=0;for(let n=a.tBodies[0].firstChild;n;n=n.nextSibling)u(n,"gt")&&(++e,n.children.item(t).textContent=e+".")}function k(t){let n="";return 8&_&&t.anon_user?n=t.anon_user+" ":1&_&&(n=Ln(t,2==(2&_))+" "),4&_&&t.email?n+=t.email:n+=t.user||"",null!=t.pset&&(n+=e(" %5s",t.pset)),null!=t.at&&(n+=e(" %.11g",t.at)),n.toLowerCase()}function C(){const t=n.anonymous?8:"name"===n.sort.u?1|(n.sort.last?2:0):"email"===n.sort.u?4:0;if(t!==_){_=t;for(var e=0;e!==v.length;++e)v[e]._sort_user=k(v[e])}}function A(){let t=n.sort.f;C();let e=l[t];e&&e.compare&&!0!==e.compare?v.sort(e.compare):e&&e.make_compare?v.sort(e.make_compare(n.sort,e.subtype||null)):("name"!==t&&"name2"!==t||n.anonymous)&&"user"!==t?"gradestatus"===t?v.sort((function(t,e){const n=t.scores_visible;return n!==e.scores_visible?n?-1:1:t.has_notes!=e.has_notes?t.has_notes?-1:1:In(t,e)||Bn(t,e)})):n.sort.email&&!n.anonymous?(t="username",v.sort((function(t,e){var n=(t.email||"").toLowerCase(),a=(e.email||"").toLowerCase();return n!==a?""===n||""===a?""===n?1:-1:n<a?-1:1:Bn(t,e)}))):("name2"!==t&&(t="username"),v.sort(Bn)):v.sort(Bn),n.sort.rev<0&&v.reverse(),v.sort((function(t,e){return t.boringness!==e.boringness?t.boringness-e.boringness:0}))}function E(){const t=this.getAttribute("data-range-type");if("s61"===t&&m||"s61o"===t){const e="s61"===t,s=this.closest("tr"),i=(e?m:a).rows[s.rowIndex],r=n.user_row_checkbox(i);r.checked!==this.checked&&r.click()}}function N(){let t=0;for(;t!==o.length&&!o[t].pin;)++t;var e=$('<div style="position:absolute;left:0;top:0;bottom:0;width:'+(o[t].left-10)+'px;pointer-events:none"></div>').prependTo(s.parent())[0],i=!1,r=!1;var l=new IntersectionObserver((function(t){for(let n of t)n.target===e?r=n.isIntersecting:i=n.isIntersecting;!i||r&&!m||(r||m||function(){const t=n.pinned_columns;let e=0;for(const n of t)e+=n.width;m=document.createElement("table"),m.className="gtable-left-pin gtable-fixed new",m.style.width=e+24+"px",m.appendChild(Zn(t,0,!0)),m.appendChild(document.createElement("tbody")),m.tHead.firstChild.classList.add("kfade");let i=a.rows[0],r=m.rows[0];for(let e=0;e!==t.length;++e)r.childNodes[e].className=i.childNodes[t[e].index].className;const o=document.createElement("div");o.className="gtable-container-left-pin",o.appendChild(m),a.parentNode.prepend(o),m.tHead.addEventListener("click",Hn),$(m).find("tbody").on("click","input[type=checkbox]",E),Qn(n,m,v),g=Un(m),s.find("input[data-range-type=s61]:checked").each(E),m.addEventListener("mouseenter",Rn,!0),m.addEventListener("mouseleave",Rn,!0),queueMicrotask((function(){h(m,"new"),g&&h(g,"new")})),c=c.add(m).add(g)}(),p(m.parentElement,"hidden",r),g&&p(g,"hidden",r))}));l.observe(e),l.observe(a.parentElement)}function D(){const t=o[o.length-1];let e=t.left+t.width;n.anonymous&&(l.name&&(e-=l.name.width),l.year&&(e-=l.year.width)),c.each((function(){u(this,"gtable-left-pin")||(this.style.width=e+"px")}))}function S(){c.children("thead").find(".plsortable").removeClass("plsortactive plsortreverse"),c.children("thead").find("th[data-pa-sort='"+n.sort.f+"']").addClass("plsortactive").toggleClass("plsortreverse",n.sort.rev<0)}function F(e){const s=n.sort,o=e.detail.sort;n.sort=o,n.overridable_anonymous&&o.deblind!=s.deblind&&(n.anonymous=!o.deblind,c.toggleClass("gt-anonymous",!!n.anonymous),D(),c.children("tbody").find("input.gt-check").each((function(){const t=i[this.parentNode.parentNode.getAttribute("data-pa-spos")];this.setAttribute("name",n.render_checkbox_name(t))})),a.closest("form").elements.anonymous.value=n.anonymous?"1":"0"),o.last!==s.last||o.deblind!=s.deblind?Yn(n,c,"name","name2","username","user"):o.u!==s.u&&Yn(n,c,"username","user"),A(),Qn(n,a,v),m&&Qn(n,m,v),l.rownumber&&w(),S(),r&&y(),t.site(!0,"pa-pset"+n.id+"-table",JSON.stringify(o))}!function(){let e=n.sort,s=t.site(!0,"pa-pset"+n.id+"-table");if(s)try{s=JSON.parse(s),s&&"object"==typeof s&&(e=n.sort=s,delete e.override_anonymous)}catch(t){}if(e.f&&/^\w+$/.test(e.f)||(e.f="name"),1!==e.rev&&-1!==e.rev&&(e.rev=1),n.overridable_anonymous||delete e.deblind,e.deblind){let a=(new Date).getTime()/1e3;"number"==typeof e.deblind&&e.deblind+3600>a?e.deblind=a:delete e.deblind,t.site(!0,"pa-pset"+n.id+"-table",JSON.stringify(e))}e.deblind&&(n.anonymous=!1),b=n.grades?new ye(n.grades):new ye({order:[]}),b.scores_visible=n.scores_visible,n.set_gradesheet(b);let i=-1,c=!1,u=n.scores_visible;for(let t=0;t!==v.length;++t){const e=v[t]=b.make_child().assign(v[t]);e.dropped?e.boringness=2:e.emptydiff||!e.grade_commit&&!e.commit&&!n.gitless_grades?e.boringness=1:e.boringness=0;let a=0;if(e.grades)for(let t of n.in_total_indexes)null!=e.grades[t]&&""!==e.grades[t]&&++a;e.ngrades=a,-1===i?i=a:i>=0&&i!==a&&(!e.boringness||a>0)&&(i=-2),c=c||!!e.late_hours,u=u||e.scores_visible_pinned}const d=-2===i;if(n.requested_columns)o=n.requested_columns;else{o=["rownumber"],n.checkbox&&o.push(n.flagged_commits?"flagcheckbox":"checkbox"),n.flagged_commits&&(o.push("pset"),o.push("at")),o.push("user","extension","year","grader"),c&&o.push("latehours"),n.flagged_commits&&o.push("conversation"),(n.flagged_commits||!n.gitless_grades||u)&&o.push("notes"),n.need_total&&o.push("total");let t=n.gradesheet;for(let e=0;e!==t.value_order.length;++e){const a=t.entries[t.value_order[e]];o.push(a.configure_column({type:"grade",name:"/g/"+a.key,gidx:e,gkey:a.key,ptconf:n}))}d&&o.push("ngrades"),n.gitless||o.push("repo")}for(let t of o)"string"==typeof t&&(t={type:t,name:t,ptconf:n}),Object.assign(t,Jn[t.type]),n.add_column(t);o=n.col,l=n.colmap,a.closest("form")&&(r=document.createElement("input"),r.type="hidden",r.name="slist",a.after(r))}(),function(){const t=s.hasClass("want-gtable-fixed"),e=Zn(o,0,!0);p(a,"gt-anonymous",!!n.anonymous),a.appendChild(e),p(a,"gt-useemail",!!n.sort.email),t&&(D(),h(a,"want-gtable-fixed"),d(a,"gtable-fixed"));const i=document.createElement("tbody");i.className="has-hotlist",a.appendChild(i),n.no_sort||(A(),S());for(const t of v){n.push(t);for(const e of t.partners||[])n.push(e)}Qn(n,a,v),l.rownumber&&w(),r&&y(),s.find("tbody").on("click","input[type=checkbox]",E),f=Un(a),c=c.add(f),t&&window.IntersectionObserver&&N()}(),function(){const t=a.closest("form");a.tBodies[0].addEventListener("pa-hotlist",x),a.tBodies[0].addEventListener("click",Wn),a.addEventListener("mouseenter",Rn,!0),a.addEventListener("mouseleave",Rn,!0),a.tHead.addEventListener("click",Hn),t.addEventListener("rangechange",Vn),t.addEventListener("sortchange",F)}()}Et.add_builder("pa-ptable-user",(function(){let t=this.closest("tr").getAttribute("data-pa-spos"),e=this.closest("form").pa__ptconf,n=e.smap[t];return{content:new Promise((t=>{const a=document.createElement("div"),s=e.anonymous&&n.anon_user;if(a.className="d-flex align-items-center",n.imageid&&!s){const t=e.make_student_ae(n),s=document.createElement("img");s.className="pa-tinyface",s.src=q("face",{u:n.user,imageid:n.imageid}),t.append(s),a.append(t)}const i=document.createElement("div");a.append(i);const r=e.make_student_ae(n);if(r.className+=" font-weight-bold",r.append(s?n.anon_user:n.user),i.append(r),n.x?i.append(" (X)"):!s&&n.year&&i.append(" "+On(n.year)),i.append(document.createElement("br")),!s){if(""!==Ln(n,!1)){const t=e.make_student_ae(n);t.className="q",t.append(Ln(n,!1)),i.append(t,document.createElement("br"))}n.email&&i.append(n.email,document.createElement("br"))}t(a)})),delay:400,className:"gray small ml-2",dir:"w",noDelayClass:"pa-ptable-user"}})),_.on("js-pset-gconfig",(function(){let t,e,n=this.closest("form").pa__ptconf;function a(){const t=e.elements.state.value;p(e.elements.frozen.parentElement,"invisible","disabled"===t||"hidden"===t),p(e.elements.anonymous.parentElement,"invisible","disabled"===t)}function s(){$.ajax(q("=api/psetconfig",{pset:n.key}),{method:"POST",data:$(e).serializeWith({}),success:function(){location.hash="#"+n.key,location.reload()}})}!function(){const i=En();let r;i.push('<h2 class="pa-home-pset">'+ct(n.title)+" Settings</h2>"),i.push('<div class="pa-messages"></div>'),i.push('<div class="d-grid-1 grid-gap-2">',"</div>"),i.push('<span class="select"><select name="state">',"</select></span>"),i.push('<option value="disabled">Disabled</option>'),i.push('<option value="hidden">Hidden</option>'),i.push('<option value="visible">Visible without grades</option>'),i.push('<option value="scores_visible">Visible with grades</option>'),i.pop(),i.push('<span class="select"><select name="frozen">',"</select></span>"),i.push('<option value="no">Student updates allowed</option>'),i.push('<option value="yes">Submissions frozen</option>'),i.pop(),i.push('<span class="select"><select name="anonymous">',"</select></span>"),i.push('<option value="no">Open grading</option>'),i.push('<option value="yes">Anonymous grading</option>'),i.pop(),i.pop(),i.push_actions(),i.push('<button type="button" name="bsubmit" class="btn-primary">Save</button>'),i.push('<button type="button" name="cancel">Cancel</button>'),t=i.show(!1),e=t.find("form")[0],r=n.disabled?"disabled":n.visible?n.scores_visible?"scores_visible":"visible":"hidden",e.elements.state.value=r,e.elements.state.setAttribute("data-default-value",r),e.elements.state.addEventListener("change",a),a(),r=n.frozen?"yes":"no",e.elements.frozen.value=r,e.elements.frozen.setAttribute("data-default-value",r),r=n.anonymous?"yes":"no",e.elements.anonymous.value=r,e.elements.anonymous.setAttribute("data-default-value",r),t.find("button[name=bsubmit]").on("click",s),i.show()}()})),_.on("js-ptable-run",(function(){let t,e,n,a=this.closest("form"),s=a.pa__ptconf;function i(){if(e.elements.runner.value){const t=e.elements.runner.value+(e.elements.ifneeded.checked?".ifneeded":""),a=[],i={pset:s.key,run:t,runmany:1},r={};for(const t of n)a.push(s.ukey(t));const o=a.join(" ");o.length<=160?i.users=o:r.users=o,function(t,e,n){const a=document.createElement("form");a.setAttribute("method","post"),a.setAttribute("enctype","multipart/form-data"),a.setAttribute("accept-charset","UTF-8"),a.action=q(t,e),n=n||{____empty____:1};for(let t in n){const e=document.createElement("input");e.type="hidden",e.name=t,e.value=n[t],a.appendChild(e)}document.body.appendChild(a),a.submit()}("=run",i,r)}else $n.call(e)}!function(){n=s.users_in(a,2);const r=En();r.push('<h2 class="pa-home-pset">'+ct(s.title)+" Commands</h2>"),r.push('<h3 class="gdialog-userids"></h3>'),r.push('<div class="pa-messages"></div>'),r.push('<div class="mt-1 multicol-2">',"</div>");for(let t in s.runners)r.push('<label class="checki"><span class="checkc"><input type="radio" name="runner" value="'+t+'"></span>'+ct(s.runners[t])+"</label>");r.pop(),r.push('<label class="checki mt-2"><span class="checkc"><input type="checkbox" name="ifneeded" value="1"></span>Use prerecorded runs when available</label>'),r.push_actions(),r.push('<button type="button" name="run" class="btn-primary">Run</button>'),r.push('<button type="button" name="cancel">Cancel</button>'),t=r.show(!1),s.render_gdialog_users(t.find("h3")[0],n),e=t.find("form")[0],$(e.elements.run).on("click",i),r.show()}()}));var ea=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,na=/[\0-\x1F\x7F-\x9F]/,aa=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,sa=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/;function ia(t){return Array.prototype.slice.call(arguments,1).forEach((function(e){e&&Object.keys(e).forEach((function(n){t[n]=e[n]}))})),t}function ra(t){return Object.prototype.toString.call(t)}function oa(t){return"[object Function]"===ra(t)}function la(t){return t.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const ca={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};const ua={"http:":{validate:function(t,e,n){const a=t.slice(e);return n.re.http||(n.re.http=new RegExp("^\\/\\/"+n.re.src_auth+n.re.src_host_port_strict+n.re.src_path,"i")),n.re.http.test(a)?a.match(n.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(t,e,n){const a=t.slice(e);return n.re.no_http||(n.re.no_http=new RegExp("^"+n.re.src_auth+"(?:localhost|(?:(?:"+n.re.src_domain+")\\.)+"+n.re.src_domain_root+")"+n.re.src_port+n.re.src_host_terminator+n.re.src_path,"i")),n.re.no_http.test(a)?e>=3&&":"===t[e-3]||e>=3&&"/"===t[e-3]?0:a.match(n.re.no_http)[0].length:0}},"mailto:":{validate:function(t,e,n){const a=t.slice(e);return n.re.mailto||(n.re.mailto=new RegExp("^"+n.re.src_email_name+"@"+n.re.src_host_strict,"i")),n.re.mailto.test(a)?a.match(n.re.mailto)[0].length:0}}},da="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",ha="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");function pa(t){const e=t.re=function(t){const e={};t=t||{},e.src_Any=ea.source,e.src_Cc=na.source,e.src_Z=sa.source,e.src_P=aa.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");const n="[><｜]";return e.src_pseudo_letter="(?:(?![><｜]|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|[><｜]|"+e.src_ZPCc+")(?!"+(t["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+n+"|[()[\\]{}.,\"'?!\\-;]).|\\[(?:(?!"+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+'|["]).)+\\"|\\\'(?:(?!'+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(t["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy='(^|[><｜]|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}(t.__opts__),n=t.__tlds__.slice();function a(t){return t.replace("%TLDS%",e.src_tlds)}t.onCompile(),t.__tlds_replaced__||n.push(da),n.push(e.src_xn),e.src_tlds=n.join("|"),e.email_fuzzy=RegExp(a(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(a(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(a(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(a(e.tpl_host_fuzzy_test),"i");const s=[];function i(t,e){throw new Error('(LinkifyIt) Invalid schema "'+t+'": '+e)}t.__compiled__={},Object.keys(t.__schemas__).forEach((function(e){const n=t.__schemas__[e];if(null===n)return;const a={validate:null,link:null};if(t.__compiled__[e]=a,"[object Object]"===ra(n))return!function(t){return"[object RegExp]"===ra(t)}(n.validate)?oa(n.validate)?a.validate=n.validate:i(e,n):a.validate=function(t){return function(e,n){const a=e.slice(n);return t.test(a)?a.match(t)[0].length:0}}(n.validate),void(oa(n.normalize)?a.normalize=n.normalize:n.normalize?i(e,n):a.normalize=function(t,e){e.normalize(t)});!function(t){return"[object String]"===ra(t)}(n)?i(e,n):s.push(e)})),s.forEach((function(e){t.__compiled__[t.__schemas__[e]]&&(t.__compiled__[e].validate=t.__compiled__[t.__schemas__[e]].validate,t.__compiled__[e].normalize=t.__compiled__[t.__schemas__[e]].normalize)})),t.__compiled__[""]={validate:null,normalize:function(t,e){e.normalize(t)}};const r=Object.keys(t.__compiled__).filter((function(e){return e.length>0&&t.__compiled__[e]})).map(la).join("|");t.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+r+")","i"),t.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+r+")","ig"),t.re.schema_at_start=RegExp("^"+t.re.schema_search.source,"i"),t.re.pretest=RegExp("("+t.re.schema_test.source+")|("+t.re.host_fuzzy_test.source+")|@","i"),function(t){t.__index__=-1,t.__text_cache__=""}(t)}function fa(t,e){const n=t.__index__,a=t.__last_index__,s=t.__text_cache__.slice(n,a);this.schema=t.__schema__.toLowerCase(),this.index=n+e,this.lastIndex=a+e,this.raw=s,this.text=s,this.url=s}function ma(t,e){const n=new fa(t,e);return t.__compiled__[n.schema].normalize(n,t),n}function ga(t,e){if(!(this instanceof ga))return new ga(t,e);var n;e||(n=t,Object.keys(n||{}).reduce((function(t,e){return t||ca.hasOwnProperty(e)}),!1)&&(e=t,t={})),this.__opts__=ia({},ca,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=ia({},ua,t),this.__compiled__={},this.__tlds__=ha,this.__tlds_replaced__=!1,this.re={},pa(this)}function ba(t){return document.getElementById(t)}ga.prototype.add=function(t,e){return this.__schemas__[t]=e,pa(this),this},ga.prototype.set=function(t){return this.__opts__=ia(this.__opts__,t),this},ga.prototype.test=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return!1;let e,n,a,s,i,r,o,l,c;if(this.re.schema_test.test(t))for(o=this.re.schema_search,o.lastIndex=0;null!==(e=o.exec(t));)if(s=this.testSchemaAt(t,e[2],o.lastIndex),s){this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+s;break}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(l=t.search(this.re.host_fuzzy_test),l>=0&&(this.__index__<0||l<this.__index__)&&null!==(n=t.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))&&(i=n.index+n[1].length,(this.__index__<0||i<this.__index__)&&(this.__schema__="",this.__index__=i,this.__last_index__=n.index+n[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(c=t.indexOf("@"),c>=0&&null!==(a=t.match(this.re.email_fuzzy))&&(i=a.index+a[1].length,r=a.index+a[0].length,(this.__index__<0||i<this.__index__||i===this.__index__&&r>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=i,this.__last_index__=r))),this.__index__>=0},ga.prototype.pretest=function(t){return this.re.pretest.test(t)},ga.prototype.testSchemaAt=function(t,e,n){return this.__compiled__[e.toLowerCase()]?this.__compiled__[e.toLowerCase()].validate(t,n,this):0},ga.prototype.match=function(t){const e=[];let n=0;this.__index__>=0&&this.__text_cache__===t&&(e.push(ma(this,n)),n=this.__last_index__);let a=n?t.slice(n):t;for(;this.test(a);)e.push(ma(this,n)),a=a.slice(this.__last_index__),n+=this.__last_index__;return e.length?e:null},ga.prototype.matchAtStart=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return null;const e=this.re.schema_at_start.exec(t);if(!e)return null;const n=this.testSchemaAt(t,e[2],e[0].length);return n?(this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+n,ma(this,0)):null},ga.prototype.tlds=function(t,e){return t=Array.isArray(t)?t:[t],e?(this.__tlds__=this.__tlds__.concat(t).sort().filter((function(t,e,n){return t!==n[e-1]})).reverse(),pa(this),this):(this.__tlds__=t.slice(),this.__tlds_replaced__=!0,pa(this),this)},ga.prototype.normalize=function(t){t.schema||(t.url="http://"+t.url),"mailto:"!==t.schema||/^mailto:/i.test(t.url)||(t.url="mailto:"+t.url)},ga.prototype.onCompile=function(){},window.markdownit.linkify=ga(),window.markdownit.linkify.set({fuzzyEmail:!1,"---":!0}),$.fn.extend({geometry:function(t){var e,n;if(this[0]==window)e={left:this.scrollLeft(),top:this.scrollTop()};else{if(1==this.length&&this[0].getBoundingClientRect)return e=$.extend({},this[0].getBoundingClientRect()),(n=window.pageXOffset)&&(e.left+=n,e.right+=n),(n=window.pageYOffset)&&(e.top+=n,e.bottom+=n),"width"in e||(e.width=e.right-e.left,e.height=e.bottom-e.top),e;e=this.offset()}return e&&(e.width=t?this.outerWidth():this.width(),e.height=t?this.outerHeight():this.height(),e.right=e.left+e.width,e.bottom=e.top+e.height),e},scrollIntoView:function(t){t=t||{};for(let e=0;e!==this.length;++e){let n=$(this[e]).geometry(),a=this[e].parentNode;for(;a&&a.tagName&&"visible"===$(a).css("overflow-y");)a=a.parentNode;a=a&&a.tagName?a:window;let s=$(a).geometry();if(n.top<s.top+(t.marginTop||0)||t.atTop){let e=Math.max(n.top-(t.marginTop||0),0);a===window?a.scrollTo(a.scrollX,e):a.scrollTop=e}else if(n.bottom>s.bottom-(t.marginBottom||0)){let e=Math.max(n.bottom+(t.marginBottom||0)-s.height,0);a===window?a.scrollTo(a.scrollX,e):a.scrollTop=e}}return this},serializeWith:function(t){var e=this.serialize();if(null!=e&&t){let n=e.length&&"&"!=e[e.length-1]?"&":"";for(let a in t)null!=t[a]&&(e+=n+encodeURIComponent(a)+"="+encodeURIComponent(t[a]),n="&")}return e}});var _a=function(){var t,e=!1;function n(n,a){var s,r;n&&"string"==typeof n&&(n=ba(n)),n&&e&&(s=new Date(1e3*a),r=i(t?"%A %#e %b %Y %#R your time":"%A %#e %b %Y %#r your time",s),"SPAN"==n.tagName?(n.textContent=" ("+r+")",n.style.display="inline"):(n.textContent=r,n.style.display="block"))}return n.initialize=function(n,a){t=a,e=Math.abs((new Date).getTimezoneOffset()-n)>=60},n}(),va=[];function xa(t){if(t)"string"==typeof t?va.push(xa[t]):va.push(t);else for(var e=0;e<va.length;++e)va[e]()}xa.time=function(t,e){_a.initialize(t,e)};var ya={},wa=1;function ka(t,e,n){var a,s,i,r,o,l;if(t instanceof Array)for(a=0;a<t.length;a++)ka(t[a],e,n);else if("string"==typeof t)o=n,null!=ya[t]&&null!=ya[t][n]&&(o=ya[t][n]),l=o||"",ka(ba("fold"+t)||ba(t),e,o),(s=ba("foldsession."+t+l))?s.src=s.src.replace(/val=.*/,"val="+(e?1:0)+"&u="+wa++):(s=ba("foldsession."+t))&&(s.src=s.src.replace(/val=.*/,"val="+(e?1:0)+"&sub="+(n||l)+"&u="+wa++)),!e&&(s=ba("fold"+t+l+"_d"))&&(s.setSelectionRange&&null==s.hotcrp_ever_focused&&(s.setSelectionRange(s.value.length,s.value.length),s.hotcrp_ever_focused=!0),s.focus());else if(t&&(i="fold"+(l=n||"")+"o",r="fold"+l+"c",null==e&&t.className.indexOf(i)>=0&&(e=!0),t.className=e?t.className.replace(i,r):t.className.replace(r,i),document.recalc))try{t.innerHTML=t.innerHTML+""}catch(t){}return!1}function Ca(t){d(t,"pa-saving");var e=$(t).data("paOutstandingPromise");if(e)e.then(Ca,Aa);else{var n=$(t);n.find(".pa-gradediffers, .pa-save-message").remove(),n.append('<span class="pa-save-message compact"><span class="spinner"></span></span>');var a=ye.closest(t),s={},i={};n.find("input.pa-gradevalue, textarea.pa-gradevalue, select.pa-gradevalue").each((function(){let t,e=a.xentry(this.name);e&&null!=(t=e.value_in(a))&&(i[this.name]=t),"checkbox"!==this.type&&"radio"!==this.type||this.checked?s[this.name]=this.value:"checkbox"===this.type&&(s[this.name]=0)})),n.data("paOutstandingPromise",new Promise((function(e,a){et(q("=api/grade",{psetinfo:n[0]}),{grades:s,oldgrades:i}).then((function(s){var i,r=n.find(".pa-save-message");n.removeData("paOutstandingPromise"),Aa(t),s.ok?(s.answer_timeout&&(i=t.closest(".pa-grade"))&&u(i,"pa-ans")?(r.remove(),r=$('<div class="pa-save-message"><strong class="err">Your exam period has closed.</strong> Your change was saved anyway, but the version used for grading will be selected from within the exam window.</div>').appendTo(n)):r.addClass("compact fadeout").html('<span class="savesuccess"></span>'),ye.store(t.closest(".pa-psetinfo"),s),e(t)):(r.removeClass("compact").html('<strong class="err">'+s.error+"</strong>"),a(t))}))})))}}function Aa(t){h(t,"pa-saving")}function Ea(){h(this,"need-pa-grade");const t=ve.closest(this),e=ye.closest(this);if(t&&e){const n=t.render(e);if(this.parentElement.replaceChild(this,n),e.update_at(n),t.landmark_range&&this.closest(".pa-gradebox")&&t.landmark_grade(this.firstChild),this.hasAttribute("data-pa-landmark-buttons")){const t=JSON.parse(this.getAttribute("data-pa-landmark-buttons"));for(let e=0;e!==t.length;++e)"string"==typeof t[e]?$(n).find(".pa-pv").append(t[e]):t[e].className&&$(n).find(".pa-pv").append('<button type="button" class="btn uic uikd pa-grade-button" data-pa-grade-button="'+t[e].className+'">'+t[e].title+"</button>")}}}function $a(t){return t.getBoundingClientRect().top-window.scrollY}function Na(t,e){queueMicrotask((()=>{const n=t.getBoundingClientRect().top-e;window.scrollBy(0,n-window.scrollY)}))}function Da(t,e){const n=document.createElement("button");return n.className="btn-t ui small need-tooltip "+t,n.setAttribute("aria-label",e),n.append(document.createElement("span")),n.firstChild.className="filter-gray",n}function Sa(t,e){const n=t.entries[e.getAttribute("data-pa-grade")];let a=null;t.user&&u(document.body,"pa-multiuser")&&(a=document.createElement("span"),a.className="pa-fileref-context",a.textContent=t.user+" / ");const s=[];if(t.scores_editable&&t.section_has(n,(t=>t.description))){const t=Da("pa-grade-toggle-description","Toggle description");p(t.firstChild,"filter-gray",u(e,"pa-hide-description")),t.firstChild.textContent="📃",s.push(t)}if(t.scores_editable&&t.section_has(n,(t=>t.answer&&"section"!==t.type))){const t=Da("pa-grade-toggle-answer","Toggle answer editing");t.firstChild.textContent="✍️",s.push(t)}if(!t.answers_editable&&t.section_has(n,(t=>"markdown"===t.type))){const t=Da("pa-grade-toggle-markdown","Toggle Markdown");t.firstChild.className="icon-markdown filter-gray",s.push(t)}let i=e;for(;!i.firstChild||!u(i.firstChild,"pa-p");)i=u(i,"pa-dg")?i.firstChild:i.nextSibling;let r=i.firstChild;if(!u(r,"pa-p-section")){if(!a&&!s.length)return;r=document.createElement("div"),r.className="pa-p pa-p-section";const t=document.createElement("label");t.className="pa-pt",t.textContent="—",r.appendChild(t),i.insertBefore(r,i.firstChild)}if(a&&r.firstChild.insertBefore(a,r.firstChild.firstChild),s.length){const t=document.createElement("div");t.className="btnbox ml-3",t.append(...s),r.firstChild.append(t)}d(i,"pa-with-sticky"),d(r,"pa-sticky");const o=r.firstChild.nextSibling;o&&u(o,"pa-pdesc")&&(d(o,"pa-ptop"),u(r,"pa-p-hidden")&&d(o,"pa-p-hidden"),i.insertBefore(o,r.nextSibling))}function Fa(t,e){for(;e;){const t=e.nextSibling;e.remove(),e=t}for(;!t.firstChild;){const e=t.parentElement;t.remove(),t=e}}function Ma(){h(this,"need-pa-gradelist"),d(this,"pa-gradelist");const t=this.closest(".pa-psetinfo"),e=ye.closest(t);if(!e)return;const n=function(t){const e={};let n=t.firstChild;for(;n;)if(u(n,"pa-grade")&&(e[n.getAttribute("data-pa-grade")]=n),u(n,"pa-dg"))n=n.firstChild;else{for(;!n.nextSibling&&u(n.parentElement,"pa-dg");)n=n.parentElement;n=n.nextSibling}return e}(this),a=e.has((t=>t.description||t.answer||"section"===t.type||"markdown"===t.type&&!1===e.answers_editable)),s=a?function(t,e){const n="pa-dg pa-gsection".concat(e.scores_editable?" pa-hide-description":"",u(t,"is-main")?" is-main":""),a=[];let s=t.firstChild,i=null;for(const r of e.value_order){const o=e.entries[r];if(!(o.concealed&&!e.scores_editable||null!==i&&"section"!==o.type)){for(;s&&!u(s,"pa-dg")&&!u(s,"pa-grade");)s=s.nextSibling;if(!s||!u(s,"pa-gsection")||s.getAttribute("data-pa-grade")!==r){const e=document.createElement("div");e.className=n,e.setAttribute("data-pa-grade",r),t.insertBefore(e,s),s=e,a.push(s)}if(e.section_wants_sidebar(o)&&!u(s,"pa-with-sidebar")){d(s,"pa-with-sidebar");const t=document.createElement("div");t.className="pa-sidebar";const e=document.createElement("div");e.className="pa-dg is-mainsb",s.append(t,e)}i=s,s=s.nextSibling}}return a}(this,e):[];let i=this,r=i.firstChild,o=null,l=null;for(let t=0;t!==e.value_order.length;++t){const s=e.value_order[t],c=e.entries[s];if(!e.scores_editable&&c.concealed)continue;if(a&&i!==this&&"section"===c.type){for(;i!==this;)r=i.nextSibling,i=i.parentElement;o&&(Fa(o,l),o=l=null)}for(;r&&!u(r,"pa-grade");)u(r,"pa-dg")?(i=r,r=r.firstChild):(u(r,"pa-sidebar")&&(o=r),r=r.nextSibling);let d=n[s];if(d&&d===r||(d?c.unmount_at(d):d=c.render(e),i.insertBefore(d,r),e.update_at(d),r=d),delete n[s],o&&!c.answer){if("pa-sidebar"===o.className){if(null===o.firstChild){const t=document.createElement("div");t.className="pa-gradebox pa-ps",o.appendChild(t)}o=o.firstChild,l=o.firstChild}if(l&&l.getAttribute("data-pa-grade")===s)l=l.nextSibling;else{const t=c.render(e);o.insertBefore(t,l),e.update_at(t,{sidebar:!0})}}r=r.nextSibling}o&&Fa(o,l);for(const t in n){const a=n[t];e.entries[a.getAttribute("data-pa-grade")].unmount_at(a)}for(const t of s)Sa(e,t);if(this.classList.contains("want-psetinfo-links")){const t=document.createElement("div");t.className="pa-psetinfo-links btnbox mt-2 mb-2 hidden",this.append(t);for(const e of[!0,!1]){const n=Ta(this,e);n&&(ja(t,e),ja(n.querySelector(".pa-psetinfo-links"),!e))}}}function Ta(t,e){const n=e?"previousSibling":"nextSibling",a=t.closest(".pa-psetinfo");let s=a;for(;s&&(s===a||1!==s.nodeType||!s.classList.contains("pa-psetinfo"));)s=s[n];return s}function ja(t,e){if(t&&!t.querySelector(e?".prev":".next")){t.classList.remove("hidden");const n=document.createElement("button");n.textContent=e?"←":"→",n.className="ui pa-psetinfo-link "+(e?"prev":"next"),n.type="button",t[e?"prepend":"append"](n)}}_.on("js-foldup",(function(t,e){var n,a,s,i=this;if("number"==typeof e?e={n:e}:e||(e={}),"DIV"!==this.tagName||!t||!t.target.closest("a")||e.required){!("n"in e)&&i.hasAttribute("data-fold-target")&&(a=i.getAttribute("data-fold-target").match(/^(\D[^#]*$|.*(?=#)|)#?(\d*)([cou]?)$/))&&(""!==a[1]&&(i=document.getElementById(a[1])),e.n=parseInt(a[2])||0,"f"in e||""===a[3]||("u"===a[3]&&"INPUT"===this.tagName&&"checkbox"===this.type?e.f=this.checked:e.f="c"===a[3]));for(var r="fold"+(e.n||"");i&&(!i.id||"fold"!=i.id.substr(0,4))&&!u(i,"has-fold")&&(null==e.n||!u(i,r+"c")&&!u(i,r+"o"));)i=i.parentNode;if(!i)return!0;if(null==e.n){s=f(i);for(var o=0;o!==s.length;++o)"fold"===s[o].substring(0,4)&&(a=s[o].match(/^fold(\d*)[oc]$/))&&(null==e.n||+a[1]<e.n)&&(e.n=+a[1],r="fold"+(e.n||""))}if(!("f"in e)&&("INPUT"===this.tagName||"SELECT"===this.tagName)){var l=null;if("checkbox"===this.type)e.f=!this.checked;else if("radio"===this.type){if(!this.checked)return!0;l=this.value}else"select-one"===this.type&&(l=this.selectedIndex<0?"":this.options[this.selectedIndex].value);if(null!==l){var c=(i.getAttribute("data-"+r+"-values")||"").split(/\s+/);e.f=c.indexOf(l)<0}}n=!u(i,r+"c"),"f"in e&&!e.f===n||(e.f=n,ka(i,n,e.n||0),$(i).trigger(e.f?"fold":"unfold",e)),this.hasAttribute("aria-expanded")&&this.setAttribute("aria-expanded",n?"false":"true"),t&&"object"==typeof t&&"click"===t.type&&!u(t.target,"uic")&&(t.stopPropagation(),t.preventDefault())}})),_.on("js-hide-error",(function(){d(this,"hidden")})),_.on("js-pset-upload-grades",(function(){$("#upload").removeClass("hidden")})),_.on("pa-signin-radio",(function(){let t;"login"===this.value?(ka("logingroup",!1),ka("logingroup",!1,2),t="Sign in"):"forgot"===this.value?(ka("logingroup",!0),ka("logingroup",!1,2),t="Reset password"):"new"===this.value&&(ka("logingroup",!0),ka("logingroup",!0,2),t="Create account"),document.getElementById("signin").value=t})),_.on("change.pa-gradevalue",(function(){var t,e=this.form,n=this;e&&u(e,"pa-pv")?$(e).submit():"hidden"===n.type&&(t=ve.closest(n))&&queueMicrotask((function(){t.gc.update_edit.call(t,n,+n.value,{})}))})),_.on("click.pa-gradevalue",(function(){"checkbox"!==this.type&&"radio"!==this.type||queueMicrotask((()=>{$(this).trigger("change")}))})),_.on("pa-pv",(function(t){t.preventDefault(),Ca(this)})),_.on("pa-grade-button",(function(t){if("keydown"===t.type){var e,n=F(t);if(t.ctrlKey&&("n"===n||"N"===n||"p"===n||"P"===n||"A"===n)&&(e=this.closest(".pa-grade"))){var a=e.getAttribute("data-pa-grade"),s=$(".pa-grade[data-pa-grade="+a+"] .pa-grade-button[data-pa-grade-button="+this.getAttribute("data-pa-grade-button")+"]").filter(":visible"),i=s.toArray().indexOf(this);if(i>=0){if("n"===n||"N"===n||"p"===n||"P"===n){var r=s[(i+("n"===n||"N"===n?1:s.length-1))%s.length],o=r.closest(".pa-dg");o&&$(o).scrollIntoView({marginTop:24,atTop:!0}),r.focus(),$(r).scrollIntoView()}else s.click();t.preventDefault()}}}else"click"===t.type&&_.trigger.call(this,this.getAttribute("data-pa-grade-button"),t)})),_.on("pa-grade-toggle-description",(function(t){const e=this.closest(".pa-gsection"),n=t.metaKey?$(".pa-gsection"):$(e),a=u(e,"pa-hide-description"),s=$a(this);Et.erase(),n.each((function(){p(this,"pa-hide-description",!a),$(this).find(".pa-grade-toggle-description > span").toggleClass("filter-gray",!a)})),Na(this,s)})),_.on("pa-grade-toggle-markdown",(function(t){const e=this.closest(".pa-gsection"),n=t.metaKey?$(".pa-gsection"):$(e),a=u(this.firstChild,"filter-gray"),s=$a(this);Et.erase(),n.each((function(){const t=ye.closest(this);$(this).find(".pa-grade").each((function(){"markdown"===t.entries[this.getAttribute("data-pa-grade")].type&&u(this,"pa-markdown")!==a&&(p(this,"pa-markdown",a),u(this,"e")||(t.remount_at(this,0),t.update_at(this)))})),$(this).find(".pa-grade-toggle-markdown > span").toggleClass("filter-gray",!a)})),Na(this,s)})),_.on("pa-grade-toggle-answer",(function(t){const e=this.closest(".pa-gsection"),n=t.metaKey?$(".pa-gsection"):$(e),a=u(this.firstChild,"filter-gray")?2:0,s=$a(this);Et.erase(),n.each((function(){const t=ye.closest(this);$(this).find(".pa-grade").each((function(){t.entries[this.getAttribute("data-pa-grade")].answer&&(t.remount_at(this,a),t.update_at(this,{reset:!0}))})),$(this).find(".pa-grade-toggle-answer > span").toggleClass("filter-gray",0===a),$(this).find(".pa-grade-toggle-markdown").toggleClass("hidden",0!==a)})),Na(this,s)})),$((function(){$(".need-pa-grade").each(Ea),$(".need-pa-gradelist").each(Ma)})),_.on("pa-psetinfo-link",(function(){const t=Ta(this,this.classList.contains("prev"));t&&t.id&&(location.hash="#"+t.id)})),_.on("pa-notes-grade",(function(t){if("keydown"===t.type){var e,n=F(t);if(t.ctrlKey&&("n"===n||"N"===n||"p"===n||"P"===n||"A"===n)&&(e=this.closest(".pa-grade"))){var a=e.getAttribute("data-pa-grade"),s=$(".pa-grade[data-pa-grade="+a+"] .pa-notes-grade").filter(":visible"),i=s.toArray().indexOf(this);if(i>=0){if("n"===n||"N"===n||"p"===n||"P"===n){var r=s[(i+("n"===n||"N"===n?1:s.length-1))%s.length],o=r.closest(".pa-dg");o&&$(o).scrollIntoView({marginTop:24,atTop:!0}),r.focus(),$(r).scrollIntoView()}else s.click();t.preventDefault()}}}else if("click"===t.type){var l=$(this).closest(".pa-grade").find(".pa-gradevalue");l.length&&l.val()!=l.attr("data-pa-notes-grade")&&l.val(l.attr("data-pa-notes-grade")).change(),t.preventDefault()}})),_.on("js-runmany-download",(function(){const t=document.getElementById("pa-runmany-form");if(t.elements.jobs&&t.elements.jobs.value){const e=document.createElement("input");e.type="hidden",e.name="download",e.value="1",t.elements.jobs.disabled=!1,t.append(e),t.submit(),t.elements.jobs.disabled=!0,t.removeChild(e)}})),$((function(){document.body.setAttribute("data-time-skew",Math.floor((new Date).getTime()/1e3)-+document.body.getAttribute("data-now"))})),$(".pa-download-timed").each((function(){var t=this,e=setInterval(n,15e3);function n(){const n=+t.getAttribute("data-pa-download-at"),a=+t.getAttribute("data-pa-commit-at"),s=+t.getAttribute("data-pa-download-expiry"),r=(new Date).getTime()/1e3+ +document.body.getAttribute("data-time-skew");let o;o=r>s?i("%Y/%m/%d %H:%M",n):Math.round((r-n)/60)+" min",a>n&&(o+=" · "+Math.round((a-n)/60)+" min before commit"),$(t).find(".pa-download-timer").text(o),r>s&&clearInterval(e)}n()})),_.on("submit.pa-setrepo",(function(t){let e=this;this.classList.remove("has-error","has-warning"),u(this.firstChild,"feedback-list")&&this.removeChild(this.firstChild),this.querySelector("button[type=submit]").disabled=!0,$.ajax(q("=api/repo",{pset:this.getAttribute("data-pa-pset"),u:siteinfo.uservalue}),{type:"POST",cache:!1,data:$(this).serialize(),success:function(t){e.querySelector("button[type=submit]").disabled=!1,t.message_list?e.insertBefore(re(t.message_list),e.firstChild):location.reload()}}),t.preventDefault()})),_.on("submit.pa-setbranch",(function(t){let e=this;this.classList.remove("has-error","has-warning"),u(this.firstChild,"feedback-list")&&this.removeChild(this.firstChild),this.querySelector("button[type=submit]").disabled=!0,$.ajax(q("=api/branch",{pset:this.getAttribute("data-pa-pset"),u:siteinfo.uservalue}),{type:"POST",cache:!1,data:$(this).serialize(),success:function(t){e.querySelector("button[type=submit]").disabled=!1,t.message_list?e.insertBefore(re(t.message_list),e.firstChild):location.reload()}}),t.preventDefault()})),_.on("focusin.pa-branch-datalist",(function(){h(this,"ui-focusin"),!this.hasAttribute("list")&&this.hasAttribute("data-pa-repoid")&&function(t){let e=document.getElementById("branchlist-"+t);return e?Promise.resolve(e):(e=document.createElement("datalist"),e.id="branchlist-"+t,document.body.appendChild(e),new Promise((function(n,a){$.ajax(q("api/branches",{repoid:t}),{type:"GET",cache:!1,success:function(t){if(t.ok){for(const n of t.branches){const t=document.createElement("option");t.value=n,e.appendChild(t)}n(e)}else a(t)}})})))}(this.getAttribute("data-pa-repoid")).then((t=>{this.setAttribute("list",t.id)})).catch((t=>console.log(t)))})),_.on("pa-anonymized-link",(function(t){var e=this.getAttribute("data-pa-link");t&&t.metaKey?window.open(e):window.location=e})),_.on("js-multiresolveflag",(function(){const t=this.closest("form"),e=t.pa__ptconf,n=[];$(t).find(".papsel:checked").each((function(){const t=e.smap[this.closest("tr").getAttribute("data-pa-spos")];n.push({pset:t.pset,uid:t.uid,hash:t.commit,flagid:t.flagid})})),0!==n.length?$.ajax(q("=api/multiresolveflag"),{type:"POST",cache:!1,data:{flags:JSON.stringify(n)}}):window.alert("No flags selected.")})),window.$pa={beforeunload:function(){var t=!0;if($(".pa-gw textarea").each((function(){var e=this.closest(".pa-dl"),n=le.at(e);l(this.value,n.text)||u(e,"pa-save-failed")||(t=!1)})),!t)return event.returnValue="You have unsaved notes. You will lose them if you leave the page now."},checklatest:function(t){var e,n=(new Date).getTime();function a(t){t&&t.commits&&$(".pa-commitcontainer").each((function(){var n=this.getAttribute("data-pa-pset"),a=this.getAttribute("data-pa-checkhash");for(var s of t.commits)if(s.pset==n&&s.hash&&s.hash!==a&&s.snaphash!==a){$(this).find(".pa-pv").append('<div class="pa-inf-error"><span class="pa-inf-alert">Newer commits are available.</span> <a href="'+q("pset",{u:siteinfo.uservalue,pset:n,commit:s.hash})+'">Load them</a></div>'),clearTimeout(e);break}}))}setTimeout((function s(){var i=(new Date).getTime(),r=$(".pa-commitcontainer[data-pa-checkhash]").length>0;e=i-n<=6e4?setTimeout(s,r?1e4:2e3):i-n<=6e5?setTimeout(s,r?2e4:1e4):i-n<=36e5?setTimeout(s,1.25*(i-n)):null,$.ajax(q("=api/latestcommit",{u:siteinfo.uservalue,pset:t}),{type:"GET",cache:!1,dataType:"json",success:a})}),2e3)},decorate_diff_page:Nt.decorate_page,gradeentry_closest:ve.closest,fold:ka,grgraph:function(){const t=this,e=t.getAttribute("data-pa-pset");$.ajax(q("=api/gradestatistics",e?{pset:e}:{}),{type:"GET",cache:!0,dataType:"json",success:function(e){e.series&&e.series.all&&($(t).data("paGradeData",new cn(e)),dn.call(t))}})},hoturl:q,note_near:le.near,on:_.on,onload:xa,loadgrades:function(){if(!u(this,"pa-psetinfo"))throw new Error("bad pa_loadgrades");const t=ye.closest(this);if(!t||!t.value_order)return;$(this).find(".need-pa-grade").each((function(){Ea.call(this,!0)})),$(this).find(".pa-gradelist").each((function(){Ma.call(this,!0)})),$(this).find(".pa-grade").each((function(){t.update_at(this,{reset:!0})}));const e="hidden"===t.total_type?[null,null]:[t.grade_total(),t.grade_maxtotal],n=null===e[0]?"":""+e[0];null!==e[0]&&$(this).find(".pa-gradelist:not(.pa-gradebox)").each((function(){$(this).find(".pa-total").length||$(this).prepend(function(t,e){var n=0,a=0;for(var s in t.entries)t.entries[s].in_total&&(++n,t.entries[s].student_visible(t)&&++a);const i=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div"),l=document.createElement("span"),c=document.createElement("span");return i.className="pa-total pa-p"+(n<=1?" hidden":"")+(a<n?" pa-p-hidden":""),r.className="pa-pt",r.append("subset"===t.total_type?"subtotal":"total"),o.className="pa-pv",l.className="pa-gradevalue pa-gradewidth",c.className="pa-gradedesc",c.append("of "+e[1]),i.append(r,o),o.append(l," ",c),i}(t,e))}));let a=!1;$(this).find(".pa-total").each((function(){p(this,"hidden",""===n);const t=$(this).find(".pa-gradevalue");t.text()!==n&&(t.text(n),a=!0)})),a&&$(this).find(".pa-grgraph").trigger("redrawgraph")},load_runsettings:function(t){var e,n,a=$("#pa-runsettings"),s=a.find(".n");for(n in s.attr("data-outstanding","1"),t){for(e=0;e!=s.length&&$.trim($(s[0]).val())!=n;++e);e==s.length?Je(n,t[n]):$.trim(a.find("[name=v"+e+"]").val())!=t[n]&&(a.find("[name=v"+e+"]").val(t[n]),$(s[e]).removeAttr("data-outstanding"))}for(e=0;e!=s.length;++e)$(s[e]).attr("data-outstanding")&&$("[data-runsetting-num="+$(s[e]).attr("name").substr(1)+"]").remove()},pset_actions:function(){var t=$(this);function e(){var e=t.find("select[name='state']").val();t.find(".pa-if-enabled").toggleClass("hidden","disabled"===e),t.find(".pa-if-visible").toggleClass("hidden","disabled"===e||"invisible"===e)}e(),t.find("select[name='state']").on("change",e),t.find("input, select").on("change",(function(){t.find("[type='submit']").addClass("alert")})),t.removeClass("need-pa-pset-actions")},pset_table:function(t,e,n){const a=new qn(e,n||[]);t.pa__ptconf=a;let s=$(t).find("table.gtable");s.length&&ta.call(s[0],a)},render_text_page:ae.on_page,runmany:function(t){const n=document.getElementById("pa-runmany-form"),a=[];let s;function i(){if(u(n,"pa-run-active"))s||(s=setTimeout(i,2e3));else{const e=function(){const t=n.elements.run,e=t.getAttribute("data-pa-run-category")||t.value,a=document.getElementById("pa-run-"+e),s=a?a.getAttribute("data-pa-timestamp"):null;return e&&s?(a.removeAttribute("data-pa-timestamp"),{u:n.elements.u.value,pset:n.elements.pset.value,run:e,timestamp:+s}):null}();if(e&&n.elements.jobs&&(a.push(e),n.elements.jobs.value=JSON.stringify(a),1===a.length)){const t=document.createElement("button");t.append("Download"),t.className="ui js-runmany-download",r().lastChild.append(t)}$.ajax(q("=api/runchainhead",{chain:t}),{type:"POST",cache:!1,dataType:"json",timeout:3e4,success:o})}}function r(){let t=document.getElementById("pa-runmany-statusui");if(!t){t=document.createElement("div"),t.id="pa-runmany-statusui",t.className="d-flex justify-content-between";const e=document.createElement("div"),a=document.createElement("div");e.className="flex-grow-1",t.append(e,a),$("#run-"+n.elements.run.value).after(t)}return t}function o(t){if(s&&clearTimeout(s),s=null,t&&t.ok&&t.queueid){n.elements.u.value=t.u,n.elements.pset.value=t.pset;let e=$('<a href="'+siteinfo.site_relative+"~"+encodeURIComponent(t.u)+"/pset/"+t.pset+'" class="q ansib ansifg7"></a>');e.text(t.u),Ze(n.elements.run,{noclear:!0,queueid:t.queueid,timestamp:t.timestamp,headline:e[0],done_function:i})}t&&null!=t.njobs&&function(t){let n=document.getElementById("pa-runmany-progress");n||(n=document.createElement("progress"),n.id="pa-runmany-progress",n.className="ml-3 mr-3",r().firstChild.append("Progress: ",n)),n.max=Math.max(n.max,t+1),n.value=n.max-t,n.textContent=e("%d%%",n.value/n.max),0===t&&n.after("Done!")}(t.njobs),t&&0===t.njobs||(s=setTimeout(i,4e3))}n&&!n.hasAttribute("data-pa-runmany-unload")&&($(window).on("beforeunload",(function(){const t=document.getElementById("pa-runmany-progress");if(t&&t.max<t.value)return"Several server requests are outstanding."})),n.setAttribute("data-pa-runmany-unload","")),i()},gradesheet_store:ye.store,text_eq:l}}();
//# sourceMappingURL=pa.min.js.map?version=334cb08b1e5d
